\documentclass[a4paper]{llncs}

\usepackage[lutzsyntax]{virginialake}\aftrianglefalse
\usepackage[urw-garamond]{mathdesign}
\usepackage{hyperref}
%\usepackage{draftwatermark}

\begin{document}

\title{Normalisation Control in Deep Inference\\ via Atomic Flows II}

\author{Alessio Guglielmi\inst{1,2} and Tom Gundersen\inst{1}\thanks{Guglielmi is supported by EPSRC grant EP/E042805/1 \emph{Complexity and Non-determinism in Deep Inference} and by an ANR \emph{Senior Chaire d'Excellence} titled \emph{Identity and Geometric Essence of Proofs}. Gundersen is supported by an \emph{Overseas Research Scholarship} and a \emph{Research Studentship} both of the University of Bath.}}

\institute{University of Bath, Bath BA2 7AY, UK \and INRIA, Nancy-Grand Est, France}


\maketitle

%===============================================================================
\section{Introduction}

%TODO: say something clever at the start of the second sentence

We are interested in the normalisation of deep-inference derivations in propositional classical logic. Cuts are admissible from proofs and, dually, axioms are admissible from contradictions. However, neither are admissible from derivations. We therefore work with \emph{streamlining}, introduced in \cite{GuglGund:07:Normalis:lr}, a new, symmetric, notion of normalisation for derivations, which generalises both cut and axiom elimination.

At the core of our work lie \emph{atomic flows}, which were introduced in \cite{GuglGund:07:Normalis:lr}. Atomic flows are graphs, similar to Buss flow graphs \cite{Buss:91:The-Unde:uq} and proof nets \cite{Gira:87:Linear-L:wm}, obtained from derivations by tracing their atom occurrences and forgetting everything except how atoms are created, copied, contracted and destroyed. Atomic flows are largely syntax independent and bureaucracy free (in the sense of Girard \cite{Gira:89:Geometry:sh}). We have shown how atomic flows are useful in defining new normal forms for derivations and in arguing about normalisation.

In particular, streamlining was defined based on atomic flows. Intuitively, a derivation is streamlined if every path in the associated atomic flow can be extended to reach the top or the bottom of the flow. Seen from the point of view of derivations it means; given an atom occurrence in a streamlined derivation, either all possible ways of tracing the atom upwards will reach the premiss or all possible ways of tracing the atom downwards will reach the conclusion. Since a proof has no atoms in its premiss (only the unit `true'), tracing atom occurrences upwards from a cut can not lead to the premiss. Hence, a streamlined proof is cut free.

In this paper, we present a new streamlining procedure. Similarly to our previous result the procedure is based on a particular way of gluing together pieces of derivation, which is possible due to the symmetries of deep inference. However, the novelties are that no transformation of the original derivation is needed before the pieces are glued together, and much less information about the atomic flow associated with the derivation is used to guide the procedure. In particular, we only need to know which axioms are connected with which cuts. Since we use less information, all the axioms and cuts we are eliminating are indistinguishable, so, unlike the previous procedures, no strategy for streamlining is necessary.

Contrary to what one might expect from cut elimination, the complexity of the procedure is not determined by the number of cuts being eliminated. The complexity is $O(2^n)$, where $n$ is the number of atoms which occur in at least one of the cuts we eliminate. In particular, every step of the procedure eliminate all the cuts where a given atom occurs, making termination a triviality.

We present our streamlining procedure as an operator, called the \emph{normaliser}. The normaliser can be thought of as a `shape' with holes. To produce a weakly streamlined derivation, a derivation is inserted into the holes and the atoms of the derivation are associated with parts of the shape. We can observe that features of the shape are analogous to properties of a normalisation procedure. The fact that the shape is finite gives termination, its size givse the complexity, its asymmetries gives non-determinism, etc.

\newcommand{\SKS}{\mathsf{SKS}}
The results in this paper are presented in the deep-inference formalism the calculus of structures \cite{Gugl:06:A-System:kl}, in particular system $\SKS$ \cite{BrunTiu:01:A-Local-:mz,Brun:04:Deep-Inf:rq}, but we strive at generality and it should not be difficult to adapt our results to any deep-inference formalism and any propositional system as long as we have atomic structural rules and linear logical rules (something we always expect in deep inference and something which is not achievable elsewhere).

In the future, we believe it will be possible to improve on these results by extending them to modal \cite{Brun:07:Deep-Seq:fk,HeinStew:05:Purity-T:tg,StewStou:05:A-System:tg,Stou:06:A-Deep-I:rt} and first order \cite{Brun:04:Deep-Inf:rq,Brun:06:Cut-Elim:cq} logics and by making the procedure quasipolynomial, along the lines of a quasipolynomial cut-elimination procedure we are working on.

%===============================================================================
\section{Background on Deep Inference}
\newcommand{\fff}{\mathsf f}
\newcommand{\ttt}{\mathsf t}
\newcommand{\ot}{\mathbin\shortleftarrow}


\newcommand{\one}{{\mathchoice{\scriptstyle\mathbf1}
                              {\scriptstyle\mathbf1}
                              {\scriptstyle\mathbf1}
                              {\scriptscriptstyle\mathbf1}}}
\newcommand{\two}{{\mathchoice{\scriptstyle\mathbf2}
                              {\scriptstyle\mathbf2}
                              {\scriptstyle\mathbf2}
                              {\scriptscriptstyle\mathbf2}}}
%---------------------------------------
\begin{definition}\label{DefDerivation}
\emph{Inference rules}, $\rho$, have one \emph{premiss} and one \emph{conclusion}, and their \emph{instances} are used in \emph{inference steps} to rewrite inside formulae. A \emph{derivation}, $\Phi$, from $\alpha$ (\emph{premiss}) to $\beta$ (\emph{conclusion}) is a chain of inference steps with $\alpha$ at the top and $\beta$ at the bottom, and is usually indicated by $\vlder{\Phi}{\mathcal S}{\beta}{\alpha}$, where $\mathcal S$ is the name of the deductive system or a set of inference rules; a \emph{proof} is a derivation from $\ttt$; besides $\Phi$, we denote derivations with $\Psi$. We denote with $\xi\{\Phi\}$ the result of including every formula of the derivation $\vlder{\Phi}{}{\beta}{\alpha}$ into the context $\xi\vlhole$. Since we adopt deep inference, $\vlder{\xi\{\Phi\}}{}{\xi\{\beta\}}{\xi\{\alpha\}}$ is a valid derivation. Furthermore, $\xi\left\{\vlder{}{}{\beta_1}{\alpha_1}\right\}\cdots\left\{\vlder{}{}{\beta_n}{\alpha_n}\right\}$ denotes
\[
\vlderivation
{
 \vlin{=}{}{\xi\{\beta_1\}\cdots\{\beta_{n-1}\}\left\{\vlder{}{}{\beta_n}{\alpha_n}\right\}}
 {
  \vlin{=}{}{\vdots}
  {
   \vlin{=}{}{\xi\{\beta_1\}\cdots\{\beta_{i-1}\}\left\{\vlder{}{}{\beta_i}{\alpha_i}\right\}\{\alpha_{i+1}\}\cdots\{\alpha_n\}}
   {
    \vlin{=}{}{\vdots}
    {
     \vlhy{\xi\left\{\vlder{}{}{\beta_1}{\alpha_1}\right\}\{\alpha_2\}\cdots\{\alpha_n\}}
    }
   }
  }
 }
}\quad.
\]
\end{definition}

\newcommand{\KS}{\mathsf{KS}}
Now we define the two standard deductive systems for classical propositional logic in deep inference that are used throughout the paper. $\KS$ is analytic, in the sense that premisses only contain subformulae of conclusions, and $\SKS$ is not \cite{Brun:03:Atomic-C:oz,Brun:06:Cut-Elim:cq,Brun:06:Locality:zh,BrunTiu:01:A-Local-:mz}.

\newcommand{\ai}{\mathsf{ai}}
\newcommand{\aw}{\mathsf{aw}}
\newcommand{\ac}{\mathsf{ac}}
\newcommand{\aid}{{\ai{\downarrow}}}
\newcommand{\awd}{{\aw{\downarrow}}}
\newcommand{\acd}{{\ac{\downarrow}}}
\newcommand{\aiu}{{\ai{\uparrow}}}
\newcommand{\awu}{{\aw{\uparrow}}}
\newcommand{\acu}{{\ac{\uparrow}}}
\newcommand{\swi}{\mathsf{s}}
\newcommand{\med}{\mathsf{m}}
%---------------------------------------
\begin{definition}
System $\SKS$ in the calculus of structures is defined by the following \emph{structural} rules:
\[
\begin{array}{@{}c@{}c@{}c@{}}
      \vlinf{\aid}{}{\vls[a.{\bar a}]}{\ttt}&
\qquad\vlinf{\awd}{}a\fff&
\qquad\vlinf{\acd}{}a{\vls[a.a]}\\
\noalign{\smallskip}
      \emph{interaction}&
\qquad\emph{weakening}&
\qquad\emph{contraction}\\
\noalign{\bigskip}
      \vlinf{\aiu}{}\fff{\vls(a.{\bar a})}&
\qquad\vlinf{\awu}{}\ttt a&
\qquad\vlinf{\acu}{}{\vls (a.a)}a\\
\noalign{\smallskip}
      \emph{cointeraction}&
\qquad\emph{coweakening}&
\qquad\emph{cocontraction}\\
\end{array}\quad,
\]
and by the two \emph{logical} rules:
\[
\begin{array}{@{}c@{}c@{}}
\vlinf{\swi}{}{\vls[(\alpha.\beta).\gamma]}{\vls(\alpha.[\beta.\gamma])}&\qquad
\vlinf{\med}{}{\vls([\alpha.\gamma].[\beta.\delta])}
              {\vls[(\alpha.\beta).(\gamma.\delta)]}\\
\noalign{\smallskip}
\emph{switch}&\qquad\emph{medial}\\
\end{array}\quad.
\]
The rule cointeraction is also called an (\emph{atomic}) \emph{cut}. In addition to the rules shown, there is a rule $\vldownsmash{\vlinf={}\delta\gamma}$, such that $\gamma$ and $\delta$ are opposite sides in one of the following equations:
%TODO: make this alignment work with the LNCS style
\vlstore{
\vls[\alpha.\beta]         &=\vls[\beta.\alpha]         \quad,&
\vls[\alpha.\fff]          &=\vls[\alpha]               \quad,\\
\vls(\alpha.\beta)         &=\vls(\beta.\alpha)         \quad,&
\vls(\alpha.\ttt)          &=\vls(\alpha)               \quad,\\
\vls[[\alpha.\beta].\gamma]&=\vls[\alpha.[\beta.\gamma]]\quad,&
\vls[\ttt.\ttt]            &=\vls[\ttt]                 \quad,\\
\vls((\alpha.\beta).\gamma)&=\vls(\alpha.(\beta.\gamma))\quad,&
\vls(\fff.\fff)            &=\vls(\fff)                 \quad\vldot}
%\begin{align}
%\vlread
%\end{align}
We do not always show the instances of rule $=$, and when we do show them, we gather several contiguous instances into one. System $\KS$ is the same as $\SKS$, but without the rules $\aiu$, $\awu$ and $\acu$. A \emph{cut-free} derivation is a derivation where $\aiu$ is not used. All derivations in this paper are in $\SKS$, unless indicated otherwise.
\end{definition}

\begin{remark}
The representations of $\SKS$ derivations in this paper are sometimes ambiguous. This is not a problem, as the derivations themselves are well defined and we can always get a more detailed representation should we need to, for instance when extracting atomic flows from derivations. The ambiguity arises because we omit or collapse equations and because we do not distinguish the different equation rules. In particular we need to know if
\[
\vlinf{=}{}{\vls((a.a).a)}{\vls(a.(a.a))}\quad,
\]
is an application of associativity $\left(\vlinf{=}{}{\vls((a.b).c)}{\vls(a.(b.c))}\right)$ or commutativity $\left(\vlinf{=}{}{\vls((b.c).a)}{\vls(a.(b.c))}\right)$ to be able to map atom occurrences in the premiss to atom occurrences in the conclusion.
\end{remark}

% TODO: find the right place for this example

\begin{example}\label{ExaFormalismA}
Consider the $\SKS$ derivation
\[
\vls[\vlinf{\acd}{}{a}{\vls[a.a]}.\vlinf{\aiu}{}{\fff}{\vls(\vlinf{\acd}{}{b}{\vls[b.b]}.\bar b)}]\quad,
\]
which is a shorthand for
\[
\vlderivation
{
 \vlin{\aiu}{}{a}
 {
  \vlin{\acd}{}{\vls[a.(b.\bar b)]}
  {
   \vlin{\acd}{}{\vls[a.([b.b].\bar b)]}
   {
    \vlhy{\vls[a.a.([b.b].\bar b)]}
   }
  }
 }
}.
\]
It is implicit in Definition~\ref{DefFormulae} that the ordering of holes in a formula context with multiple holes is given. This decides the order in which we `sequentialise' the short-hand representation of a derivation in Definition~\ref{DefDerivation}. In this example we used a left-to-right ordering, but we could just as well have used a right-to-left ordering:
\[
\vlderivation
{
 \vlin{\acd}{}{a}
 {
  \vlin{\aiu}{}{\vls[a.a]}
  {
   \vlin{\acd}{}{\vls[a.a.(b.\bar b)]}
   {
    \vlhy{\vls[a.a.([b.b].\bar b)]}
   }
  }
 }
}.
\]
In Formalism A, a new deep-inference formalism currently under development, the above shorthand is a representative of the equivalence class containing both the left-to-right and the right-to-left orderings, in addition to the intermediate:
\[
\vlderivation
{
 \vlin{\aiu}{}{a}
 {
  \vlin{\acd}{}{\vls[a.(b.\bar b)]}
  {
   \vlin{\acd}{}{\vls[a.a.(b.\bar b)]}
   {
    \vlhy{\vls[a.a.([b.b].\bar b)]}
   }
  }
 }
}.
\]
For the purposes of this paper, which of these three derivations we use is inessential, as the atomic flows associated with each of them are are the same. For simplicity we let the shorthand above refer to one unique derivation, but we could just as well have worked in Formalism A.
\end{example}
%===============================================================================

\section{Background on Atomic Flows}\label{SectAtomicFlows}

\newbox\contrup\setbox\contrup=\hbox{$
   \divide\atflowunit by5\multiply\atflowunit by3\afsetunits
   \atomicflow{(0,0)*{\afacu{}{}{}{}{}{}}}$}
\newbox\contrdown\setbox\contrdown=\hbox{$
   \divide\atflowunit by5\multiply\atflowunit by3\afsetunits
   \atomicflow{(0,0)*{\afacd{}{}{}{}{}{}}}$}
\newbox\interdown\setbox\interdown=\hbox{$
   \divide\atflowunit by5\multiply\atflowunit by3\afsetunits
   \atomicflow{(0,0)*{\afaid{}{}{}{}{}{}}}$}
\newbox\interup\setbox\interup=\hbox{$
   \divide\atflowunit by5\multiply\atflowunit by3\afsetunits
   \atomicflow{(0,0)*{\afaiu{}{}{}{}{}{}}}$}
\newbox\weakdown\setbox\weakdown=\hbox{$
   \divide\atflowunit by5\multiply\atflowunit by3\afsetunits
   \atomicflow{(0,0)*{\afawd{}{}{}{}{}{}}}$}
\newbox\weakup\setbox\weakup=\hbox{$
   \divide\atflowunit by5\multiply\atflowunit by3\afsetunits
   \atomicflow{(0,0)*{\afawu{}{}{}{}{}{}}}$}
%===============================================================================
\section{Streamlining}\label{SectStreamlining}

%TODO: make sure we know what atomic flows are

Since the cut is only admissible from derivations without premiss, cut elimination is asymmetric. However, deep-inference derivations are up-down symmetric so it would be natural to have a symmetric normal form. This motivated the notion of \emph{streamlining}. Any derivation can be streamlined and it generalises cut elimination (and its dual, axiom elimination) in the sense that a streamlined proof is cut free (and a streamlined contradiction is axiom free).

Intuitively a derivation is streamlined if every path in its associated atomic flow can be extended to reach either the top or the bottom of the flow. We recall the definition from \cite{GuglGund:07:Normalis:lr}:

%TODO: what does the representation mean

%---------------------------------------
\begin{definition}
An $\SKS$ derivation is \emph{streamlined} if its associated atomic flow can be represented as follows:
\[
\atomicflow{
(-10,11)*{\afvjm4};
%---
(-15, 5)*{\copy\contrup};
(-10, 5)*{\affr{28}8};
( -5, 5)*{\copy\contrdown};
( 10, 5)*{\copy\interdown};
( 10, 5)*{\affr88};
( 20, 5)*{\copy\weakdown};
( 20, 5)*{\affr88};
%---
(-20, 0)*{\afvjm2};
(-10, 0)*{\afvjm2};
(  0, 0)*{\afvjm2};
( 10, 0)*{\afvjm2};
( 20, 0)*{\afvjm2};
%---
(-20,-5)*{\copy\weakup};
(-20,-5)*{\affr88};
(-10,-5)*{\copy\interup};
(-10,-5)*{\affr88};
(  5,-5)*{\copy\contrup};
( 10,-5)*{\affr{28}8};
( 15,-5)*{\copy\contrdown};
%---
(  10,-11)*{\afvjm4};
}\quad.
\]
\end{definition}

%TODO: what is a path?

Note that an atomic flow associated with a proof has no upper edges, so the top left and the two bottom left boxes in the above atomic flow would be empty. Hence, a streamlined proof is cut-free.

The main challenge in streamlining a derivation is to make sure there are no paths from axioms to cuts. Once this is achieved it is straightforward, as shown in \cite{GuglGund:07:Normalis:lr}, to use (confluent and strongly normalising) weakening reductions to obtain (in linear time) a streamlined derivation. This motivates the following definition:

%---------------------------------------
\begin{definition}
An $\SKS$ derivation is \emph{weakly streamlined} if its associated atomic flow can be represented as follows:
\[
\atomicflow{
(-5, 11)*{\afvjm4};
%---
( -5, 5)*{\affr{18}8};
(-10, 5)*{\copy\contrup};
( -5, 5)*{\copy\weakdown};
(  0, 5)*{\copy\contrdown};
( 10, 5)*{\affr88};
( 10, 5)*{\copy\interdown};
%---
(-10, 0)*{\afvjm2};
(  0, 0)*{\afvjm2};
( 10, 0)*{\afvjm2};
%---
(-10,-5)*{\affr88};
(-10,-5)*{\copy\interup};
(  5,-5)*{\affr{18}8};
(  0,-5)*{\copy\contrup};
(  5,-5)*{\copy\weakup};
( 10,-5)*{\copy\contrdown};
%---
(  5,-11)*{\afvjm4};
}\quad.
\]
\end{definition}

We will now show how to weakly streamline a derivation. This is done in two steps. First we extract the \emph{core} of the derivation, then we construct the \emph{normaliser}. A weakly streamlined derivation is obtained by plugging the core into the normaliser.

\subsection{The Core}

In this subsection we wish to find a way to modify a derivation to make it weakly streamlined. Since weak streamlining is defined in terms of atomic flows, we will define what we do to atomic flows first and then show that an analogous transformation  can be done to derivations later. The \emph{core of an atomic flow} is obtained by removing each connected pair of axiom and cut vertices. As can be seen in Definition~\ref{DefFlowCore} below this leaves most of the atomic flow untouched and the result is weakly streamlined. The definition of the \emph{core of a derivation} follows naturally.

Notice that the core of a derivation does not preserve the premiss and conclusion. In the next subsection we will see how we can glue several cores together to obtain a weakly streamlined derivation with the same premiss and conclusion as the original.

We now define the core of an atomic flow:

\newcommand{\Core}{\mathsf{Core}}

\begin{definition}\label{DefFlowCore}
Given an atomic flow
\[
\phi=\atomicflow
{
(-20, 8.5)*{\afvjm{9}};
(-13, 8)*{\afaidm{}{}{}{}{}{}};
( -6, 8.5)*{\afvjm{9}};
(-18, 0)*{\affr{8}{8}};
(-16, 2)*{\phi_1};
( -8, 0)*{\affr{8}{8}};
( -6, 2)*{\phi'_1};
( -6,-8.5)*{\afvjm{9}};
(-13,-8)*{\afaium{}{}{}{}{}{}};
(-20,-8.5)*{\afvjm{9}};
%------------
(0,0)*{\cdots};
%------------
(20, 8.5)*{\afvjm{9}};
(13, 8)*{\afaidm{}{}{}{}{}{}};
( 6, 8.5)*{\afvjm{9}};
( 8, 0)*{\affr{8}{8}};
(10, 2)*{\phi_n};
(18, 0)*{\affr{8}{8}};
(20, 2)*{\phi'_n};
( 6,-8.5)*{\afvjm{9}};
(13,-8)*{\afaium{}{}{}{}{}{}};
(20,-8.5)*{\afvjm{9}};
%------------
(35, 11)*{\afvjm4};
%---
( 35, 5)*{\affr{18}8};
( 42.8, 7)*{\psi_1};
( 30, 5)*{\copy\contrup};
( 35, 5)*{\copy\weakdown};
( 40, 5)*{\copy\contrdown};
( 50, 5)*{\affr88};
( 52.8, 7)*{\psi_2};
( 50, 5)*{\copy\interdown};
%---
( 30, 0)*{\afvjm2};
( 40, 0)*{\afvjm2};
( 50, 0)*{\afvjm2};
%---
( 30,-5)*{\affr88};
( 32.8,-3)*{\psi_3};
( 30,-5)*{\copy\interup};
( 45,-5)*{\affr{18}8};
( 52.8,-3)*{\psi_4};
( 40,-5)*{\copy\contrup};
( 45,-5)*{\copy\weakup};
( 50,-5)*{\copy\contrdown};
%---
( 45,-11)*{\afvjm4};
}\quad,
\]
where, for $1\leq i\leq n$, $\phi_i$ is connected and contains no (co)interaction vertices, the \emph{core of $\phi$} is defined to be
\[
\Core(\phi)=
\atomicflow
{
(-21,10)*{\afvjm{12}};
(-17,15)*{\afvj2};
(-17,10)*{\affr{6}{8}};
(-17,10)*{\copy\contrup};
(-17, 5)*{\afvjm{2}};
(-18, 0)*{\affr{8}{8}};
(-16, 2)*{\phi_1};
(-21,-10)*{\afvjm{12}};
(-17,-15)*{\afvj2};
(-17,-10)*{\affr{6}{8}};
(-17,-10)*{\copy\contrdown};
(-17, -5)*{\afvjm{2}};
%
( -9,15)*{\afvj2};
( -9,10)*{\affr{6}{8}};
( -9,10)*{\copy\contrup};
( -9, 5)*{\afvjm{2}};
( -5,10)*{\afvjm{12}};
( -8, 0)*{\affr{8}{8}};
( -6, 2)*{\phi'_1};
( -9,-15)*{\afvj2};
( -9,-10)*{\affr{6}{8}};
( -9,-10)*{\copy\contrdown};
( -9, -5)*{\afvjm{2}};
( -5,-10)*{\afvjm{12}};
( -8, 0)*{\affr{8}{8}};
%------------
(0,0)*{\cdots};
%------------
( 9,15)*{\afvj2};
( 9,10)*{\affr{6}{8}};
( 9,10)*{\copy\contrup};
( 9, 5)*{\afvjm{2}};
( 5,10)*{\afvjm{12}};
( 8, 0)*{\affr{8}{8}};
(10, 2)*{\phi_n};
( 9,-15)*{\afvj2};
( 9,-10)*{\affr{6}{8}};
( 9,-10)*{\copy\contrdown};
( 9, -5)*{\afvjm{2}};
( 5,-10)*{\afvjm{12}};
( 8, 0)*{\affr{8}{8}};
%
(21,10)*{\afvjm{12}};
(17,15)*{\afvj2};
(17,10)*{\affr{6}{8}};
(17,10)*{\copy\contrup};
(17, 5)*{\afvjm{2}};
(18, 0)*{\affr{8}{8}};
(20, 2)*{\phi'_n};
(21,-10)*{\afvjm{12}};
(17,-15)*{\afvj2};
(17,-10)*{\affr{6}{8}};
(17,-10)*{\copy\contrdown};
(17, -5)*{\afvjm{2}};
%---------
(35, 11)*{\afvjm4};
%---
( 35, 5)*{\affr{18}8};
( 42.8, 7)*{\psi_1};
( 30, 5)*{\copy\contrup};
( 35, 5)*{\copy\weakdown};
( 40, 5)*{\copy\contrdown};
( 50, 5)*{\affr88};
( 52.8, 7)*{\psi_2};
( 50, 5)*{\copy\interdown};
%---
( 30, 0)*{\afvjm2};
( 40, 0)*{\afvjm2};
( 50, 0)*{\afvjm2};
%---
( 30,-5)*{\affr88};
( 32.8,-3)*{\psi_3};
( 30,-5)*{\copy\interup};
( 45,-5)*{\affr{18}8};
( 52.8,-3)*{\psi_4};
( 40,-5)*{\copy\contrup};
( 45,-5)*{\copy\weakup};
( 50,-5)*{\copy\contrdown};
%---
( 45,-11)*{\afvjm4};
}\quad.
\]
\end{definition}

The core of a derivation is now defined based on the core of its atomic flow:

\begin{definition}\label{DefCore}
Given a derivation $\vlder{\Phi}{}{\beta}{\alpha}$ with associated atomic flow $\phi$, a \emph{core of\/ $\Phi$} is defined to be a derivation $\vlder{}{}{\vls[\beta.(a_n.{\bar a_n}).\cdots.(a_1.{\bar a_1})]}{\vls([a_1.{\bar a_1}].\cdots.[a_n.{\bar a_n}].\alpha)}$ with associated atomic flow $\Core(\phi)$.
\end{definition}

The reason for defining the core was to get a weakly streamlined derivation. The following proposition shows that we have done this. It can easily be verified by studying the core of the atomic flow above.

\begin{proposition}\label{PropStreamlinedCore}
A core of a derivation $\Phi$ is weakly streamlined and every atom which maps to a path from an interaction to a cointeraction vertex in the atomic flow associated with $\Phi$ does not occur in an interaction or cointeraction instance in a core of $\Phi$.
\end{proposition}

Notice that a core of a derivation is not necessarily unique. However, we will now show how a core can be extracted, and we will single out the core obtained in this way and refer to it as \emph{the core}.

To be able to remove axioms and cuts from a derivation, they must first be extracted to the premiss and conclusion respectively. The following lemma shows how switches can be used to extract a subformula to the outside, both going up and going down.

\begin{lemma}\label{LemSuperSwitch}
Given a context $\xi\vlhole$ and a formula $\alpha$ there exist derivations $\vlder{}{\{\swi\}}{\xi\{\alpha\}}{\vls(\alpha.\xi\{\ttt\})}$ and $\vlder{}{\{\swi\}}{\vls[\xi\{\fff\}.\alpha]}{\xi\{\alpha\}}$.
\end{lemma}

\begin{proof}
We show how to construct the first derivation, the second one can be done by symmetry. We argue by induction on the number of atoms in $\xi\vlhole$. The base case, $\xi\vlhole=\vlhole$, is trivial and the inductive cases are:

\[
\vlderivation
{
 \vlin{=}{}{\xi\{\alpha\}}
 {
  \vlin{=}{}{\vls[\vlder{\Psi}{\{\swi\}}{\xi'\{\alpha\}}{\vls(\alpha.\xi'\{\ttt\})}.\beta]}
  {
  \vlin{\swi}{}{\vls[(\alpha.\xi'\{\ttt\}).\beta]}
   {
    \vlin{=}{}{\vls(\alpha.[\xi'\{\ttt\}.\beta])}
    {
     \vlhy{\vls(\alpha.\xi\{\ttt\})}
    }
   }
  }
 }
}\qquad\mbox{and}\qquad
\vlderivation
{
 \vlin{=}{}{\xi\{\alpha\}}
 {
  \vlin{=}{}{\vls(\vlder{\Psi'}{\{\swi\}}{\xi'\{\alpha\}}{\vls(\alpha.\xi'\{\ttt\})}.\beta)}
  {
   \vlhy{\vls(\alpha.\xi\{\ttt\})}
  }
 }
}\quad,
\]
for some $\xi'\vlhole$ and $\beta$ where $\beta$ is not a unit and $\Psi$ and $\Psi'$ exist by the inductive hypothesis.
\end{proof}

We now show how the previous lemma can be used to pull axioms out and up and cuts out and down, without disturbing the atomic flow.

\begin{lemma}\label{LemDecompInt}
Given a derivation $\vlder{}{}{\beta}{\alpha}$ with associated atomic flow $\phi$, there exists a derivation
\[
\vlderivation
{
 \vlin{=}{}{\beta}
 {
  \vlin{=}{}{\vls[\beta.\vlinf{}{}{\fff}{\vls(b_m.\bar b_m)}.\cdots.\vlinf{}{}{\fff}{\vls(b_1.\bar b_1)}]}
  {
   \vlde{}{\SKS\setminus\{\aid,\aiu\}}{\vls[\beta.(b_m.\bar b_m).\cdots.(b_1.\bar b_1)]}
   {
    \vlin{=}{}{\vls([a_1.\bar a_1].\cdots.[a_n.\bar a_n].\alpha)}
    {
     \vlin{=}{}{\vls(\vlinf{}{}{\vls[a_1.\bar a_1]}{\ttt}.\cdots.\vlinf{}{}{\vls[a_n.\bar a_n]}{\ttt}.\alpha)}
     {
      \vlhy{\alpha}
     }
    }
   }
  }
 }
}
\]
with associated atomic flow $\phi$, for some atoms $a_1,\dots,a_n,b_1,\dots,b_m$.
\end{lemma}

\begin{proof}
Using Lemma~\ref{LemSuperSwitch} apply the following transformations to each of the (co)interaction instances in $\Phi$:
\[
\vlderivation
{
 \vlde{\Psi'}{}{\delta}
 {
  \vlin{\aid}{}{\xi\vlsbr[a.{\bar a}]}
  {
   \vlde{\Psi}{}{\xi\{\ttt\}}
   {
    \vlhy{\gamma}
   }
  }
 }
}\quad\rightarrow\quad
\vlderivation
{
 \vlde{\Psi'}{}{\delta}
 {
  \vlde{}{\{\swi\}}{\xi\vlsbr[a.{\bar a}]}
  {
   \vlhy{\vlsbr(\vlinf{\aid}{}{\vls[a.{\bar a}]}{\ttt}.\vlder{\Psi}{}{\xi\{\ttt\}}{\gamma})}
  }
 }
}\qquad\mbox{and}\qquad
\vlderivation
{
 \vlde{\Psi'}{}{\delta}
 {
  \vlin{\aid}{}{\xi\{\fff\}}
  {
   \vlde{\Psi}{}{\xi\vlsbr(a.{\bar a})}
   {
    \vlhy{\gamma}
   }
  }
 }
}\quad\rightarrow\quad
\vlderivation
{
 \vlde{}{\{\swi\}}{\vlsbr[\vlder{\Psi'}{}{\delta}{\xi\{\fff\}}.\vlinf{\aiu}{}{\fff}{\vls(a.{\bar a})}]}
 {
  \vlde{\Psi}{}{\xi\vlsbr(a.{\bar a})}
  {
   \vlhy{\gamma}
  }
 }
}\quad.
\]
\end{proof}

The way the normaliser in the next section works is by stitching together atoms from the conclusion in one copy of the core with atoms from the premiss of another copy of the core. It is therefore convenient that the number of occurrences of each atom is the same in the premiss and in the conclusion. We use (co)contractions to make sure we have exactly one occurrence of every atom.

\begin{lemma}\label{LemGenericContraction}
Given a formula $\alpha$ and a positive integer $n$, there exist derivations $\vlder{}{\{\acd,\med\}}{\alpha}{\bigvee_{i=1}^{n}\alpha}$ and $\vlder{}{\{\acu,\med\}}{\bigwedge_{i=1}^{n}\alpha}{\alpha}$.
\end{lemma}

\begin{proof}
%TODO
\end{proof}


\newcommand{\contr}{\mathsf{c}}
\newcommand{\cod}{{\contr{\downarrow}}}
\newcommand{\cou}{{\contr{\uparrow}}}

\begin{remark}
In the non-atomic version of system $\SKS$ the derivations shown in Lemma~\ref{LemGenericContraction} correspond to repeated applications of (co)contractions. For this reason we sometimes write the inference rules $\vlinf{\cod}{}{\alpha}{\vls[\alpha.\alpha]}$ and $\vlinf{\cou}{}{\vls(\alpha.\alpha)}{\alpha}$ instead of the derivations $\vlder{}{\{\acd,\med\}}{\alpha}{\vls[\alpha.\alpha]}$ and $\vlder{}{\{\acu,\med\}}{\vls(\alpha.\alpha)}{\alpha}$.
\end{remark}

\begin{theorem}\label{ThmExistCore}
Given a derivation $\vlder{\Phi}{}{\beta}{\alpha}$, a core of $\Phi$ exists.
\end{theorem}

\begin{proof}
We build a core of $\Phi$ as follows:
\[
\vlderivation
{
 \vlde{\Psi_2}{\{\acd,\med\}}{\vls[\beta.(a_n.{\bar a_n}).\cdots.(a_1.{\bar a_1})]}
 {
  \vlin{=}{}{\vls[\beta.(a_n.\bar a_n).\cdots.(a_n.\bar a_n).\cdots.(a_1.\bar a_1).\cdots.(a_1.\bar a_1)]}
  {
   \vlin{=}{}{\vls[\beta.\vlinf{}{}{\fff}{\vls(c_l.\bar c_l)}.\cdots.\vlinf{}{}{\fff}{\vls(c_1.\bar c_1)}.(a_n.\bar a_n).\cdots.(a_n.\bar a_n).\cdots.(a_1.\bar a_1).\cdots.(a_1.\bar a_1)]}
   {
    \vlde{\Phi'}{\SKS\setminus\{\aid,\aiu\}}{\vls[\beta.(c_l.\bar c_l).\cdots.(c_1.\bar c_1).(a_n.\bar a_n).\cdots.(a_n.\bar a_n).\cdots.(a_1.\bar a_1).\cdots.(a_1.\bar a_1)]}
    {
     \vlin{=}{}{\vls([a_1.\bar a_1].\cdots.[a_1.\bar a_1].\cdots.[a_n.\bar a_n].\cdots.[a_n.\bar a_n].[b_1.\bar b_1].\cdots.[b_k.\bar b_k].\alpha)}
     {
      \vlin{=}{}{\vls([a_1.\bar a_1].\cdots.[a_1.\bar a_1].\cdots.[a_n.\bar a_n].\cdots.[a_n.\bar a_n].\vlinf{}{}{\vls[b_1.\bar b_1]}{\ttt}.\cdots.\vlinf{}{}{\vls[b_k.\bar b_k]}{\ttt}.\alpha)}
      {
       \vlde{\Psi_1}{\{\acu,\med\}}{\vls([a_1.\bar a_1].\cdots.[a_1.\bar a_1].\cdots.[a_n.\bar a_n].\cdots.[a_n.\bar a_n].\alpha)}
       {
        \vlhy{\vls([a_1.{\bar a_1}].\cdots.[a_n.{\bar a_n}].\alpha)}
       }
      }
     }
    }
   }
  }
 }
}\quad,
\]
where $a_1,\dots,a_n$ are distinct and pairwise non-dual atoms and there are no atoms in common between $b_1,\dots,b_k$ and their duals and $c_1,\dots,c_l$ and their duals, $\Phi'$ exists by Lemma~\ref{LemDecompInt} and $\Psi_1$ and $\Psi_2$ exist by Lemma~\ref{LemGenericContraction}. By studying the proofs of Lemma~\ref{LemDecompInt} and Lemma~\ref{LemGenericContraction}, we can observe that the derivation has the desired atomic flow.
\end{proof}

\begin{definition}
Given a derivation $\Phi$, a core of $\Phi$ obtained as described in the proofs of Lemma~\ref{LemDecompInt}, Lemma~\ref{LemGenericContraction} and Theorem~\ref{ThmExistCore} is called \emph{the core of $\Phi$}, denoted $\Core(\Phi)$.
\end{definition}

\subsection{The Normaliser}

We now present the main result of our work, a family of operators called the \emph{normalisers}. Each normaliser can be thought of as a shape with holes where a derivation can be plugged. The effect of plugging a derivation into a normaliser is the same as adding axioms and cuts to the premiss and conclusion of the derivation, respectively. However, it is done in such a way as not to create any paths between the axioms and cuts we add. It should now be clear how our normalisation works: the core is obtained by removing axioms and cuts, then the normaliser adds the axioms and cuts back, in a way which preserves weak streamlining.

The novelty of the normalisers is that each of them is built completely independently from the derivation we later plug into it. Which normaliser to plug a derivation into is decided by the number of atoms we want to eliminate from the premiss and conclusion of the derivation.

\newcommand{\Norm}{\mathsf{Norm}}
\begin{definition}
For every $n\geq 0$ the \emph{normaliser}, $\Norm_n(\Phi,a_1,\dots,a_n)$, is an operator taking as input a sequence of atoms and a derivation of the form
\[
\vlder{\Phi}{}{\vls[\beta.(a_n.{\bar a_n}).\cdots.(a_1.{\bar a_1})]}{\vls([a_1.{\bar a_1}].\cdots.[a_n.{\bar a_n}].\alpha)}\quad,
\]
where $\alpha$ and $\beta$ are formulae and returning a derivation of the form
\[
\vlder{\Norm_n(\Phi,a_1,\dots,a_n)}{}{\beta}{\alpha}\quad.
\]

%TODO: spacing
We define $\Norm_n$ inductively on $n$. Let $\Norm_0(\Phi)=\Phi$ and for $n>0$ let $\Norm_n(\Phi,a_1,\dots,a_n)$ be
\newbox\DeltaTopK
\setbox\DeltaTopK=
\hbox{$
\vlderivation
{
 \vlde{\Norm_{n-1}(\Phi,a_1,\dots,a_{n-1})}{}{\vlsbr[\beta.(\vlinf{}{}{\ttt}{a_n}.\bar a_n)]}
 {
  \vlhy{\vlsbr(\vlinf{}{}{\vls[a_n.\bar a_n]}{\ttt}.\alpha)}
 }
}$
}
\newbox\DeltaBotK
\setbox\DeltaBotK=
\hbox{
$\vlderivation
{
 \vlde{\Norm_{n-1}(\Phi,a_1,\dots,a_{n-1})}{}{\vlsbr[\beta.\vlinf{}{}{\fff}{\vls(a_n.\bar a_n)}]}
 {
  \vlhy{\vlsbr([a_n.\vlinf{}{}{\bar a_n}{\fff}].\alpha)}
 }
}$
}
\newbox\DeltaK
\setbox\DeltaK=
\hbox{$
\vlderivation
{
 \vlde{\Norm_{n-1}(\Phi,a_1,\dots,a_{n-1})}{}{\vlsbr[\beta.(a_n.\vlinf{}{}{\ttt}{\bar a_n})]}
 {
  \vlhy{\vlsbr([\vlinf{}{}{a_n}{\fff}.\bar a_n].\alpha)}
 }
}$
}
\[
\vlderivation
{
 \vlin{\cod}{}{\beta}
 {
 \vlin{=}{}{\vls[\beta.\beta]}
  {
   \vlin{=}{}{\vlsbr[\vlinf{\cod}{}{\beta}{\vls[\beta.\beta]}.\box\DeltaBotK]}
   {
    \vlin{\swi}{}{\vls[[\beta.\beta].(a_n.\alpha)]}
    {
     \vlin{=}{}{\vls([[\beta.\beta].a_n].\alpha)}
     {
      \vlin{=}{}{\vls([\beta.\box\DeltaK].\alpha)}
      {
       \vlin{\swi}{}{\vls([\beta.(\bar a_n.\alpha)].\alpha)}
       {
        \vlin{=}{}{\vls(([\beta.\bar a_n].\alpha).\alpha)}
        {
         \vlin{=}{}{\vlsbr(\box\DeltaTopK.\vlinf{\cou}{}{\vls(\alpha.\alpha)}{\alpha})}
         {
          \vlin{\cou}{}{\vls(\alpha.\alpha)}
          {
           \vlhy{\alpha}
          }
         }
        }
       }
      }
     }
    }
   }
  }
 }
}\quad.
\]
\end{definition}

\begin{remark}\label{RemFlowNorm}
If the atomic flow of $\vlder{\Norm_{n-1}(\Phi,a_1,\dots,a_{n-1})}{}{\vls[\beta.(a_n.\bar a_n)]}{\vls([a_n.\bar a_n].\alpha)}$ is
\[
\atomicflow
{
(-8, 6)*{\afvjm{4}};
(-2, 6)*{\afvju{4}{a_n}{}};
( 2, 6)*{\afvju{4}{}{\bar a_n}};
( 8, 6)*{\afvjm{4}};
(-5, 0)*{\affr{8}{8}};
(-3, 2)*{\phi};
( 5, 0)*{\affr{8}{8}};
( 7, 2)*{\psi};
( 8,-6)*{\afvjm{4}};
(-2,-6)*{\afvjd{4}{a_n}{}};
( 2,-6)*{\afvjd{4}{}{\bar a_n}};
(-8,-6)*{\afvjm{4}};
}\quad,
\]
then the atomic flow of $\vlder{\Norm_n(\Phi,a_1,\dots,a_n)}{}{\beta}{\alpha}$ is
\[
\atomicflow
{
% cocontractions
%  outer
(-13.5,36.5)*{\afacumexsqcol{}{}{}{}{}{}{33}{4}{}{Green}{Green}};
(  2.5,36.5)*{\afacumexsqcol{}{}{}{}{}{}{33}{4}{}{Green}{Green}};
%  inner
( -8, 13)*{\afvjmcol{18}{Green}};
( 14,  0)*{\afvjmcol{44}{Green}};
(  3, 26)*{\afacumnwexsqcol{}{}{}{}{11}{2}{Green}{Green}};
(  8, 13)*{\afvjm{18}};
( 30, 0)*{\afvjmcol{44}{Green}};
( 19, 26)*{\afacumnwexsqcol{}{}{}{}{11}{2}{}{Green}};
% top boxes
(-22, 34)*{\afaidcol{}{}{}{}{}{}{Red}{Red}};
(-27, 26)*{\affr{8}{8}};
(-25, 28)*{\phi_1};
(-17, 26)*{\affr{8}{8}};
(-15, 28)*{\psi_1};
(-24, 18)*{\afawucol{}{}{}{}{}{Red}};
( -9, 13)*{\afcjlcol{22}{18}{Red}};
% middle boxes
( -2,  8)*{\afawdcol{}{}{}{}{}{Green}};
(-5, 0)*{\affr{8}{8}};
(-3, 2)*{\phi_2};
( 5, 0)*{\affr{8}{8}};
( 7, 2)*{\psi_2};
(  2, -8)*{\afawucol{}{}{}{}{}{Red}};
% bottom boxes
( 22,-34)*{\afaiucol{}{}{}{}{}{}{Green}{Green}};
( 17,-26)*{\affr{8}{8}};
( 19,-24)*{\phi_3};
( 27,-26)*{\affr{8}{8}};
( 29,-24)*{\psi_3};
( 24,-18)*{\afawdcol{}{}{}{}{}{Green}};
(  9,-13)*{\afcjlcol{22}{18}{Green}};
% contractions
%  inner
( -8,-12.75)*{\afvjm{17.5}};
(-30,0.25)*{\afvjmcol{43.5}{Red}};
(-19,-27.5)*{\afacdmnwexsqcol{}{}{}{}{11}{2}{Red}{}};
(  8,-12.75)*{\afvjmcol{17.5}{Red}};		
(-14,0.25)*{\afvjmcol{43.5}{Red}};
( -3,-27.5)*{\afacdmnwexsqcol{}{}{}{}{11}{2}{Red}{Red}};
%  outer
( 13.5,-36)*{\afacdmexsqcol{}{}{}{}{}{}{33}{4}{Red}{}{Red}};
( -2.5,-36)*{\afacdmexsqcol{}{}{}{}{}{}{33}{4}{Red}{}{Red}};
}\quad,
\]
where $\phi_1$, $\phi_2$, $\phi_3$ are isomorphic to $\phi$ and $\psi_1$, $\psi_2$, $\psi_3$ are isomorphic to $\psi$ and all the edges that might be in paths from the evidenced interaction vertex are colored in red and all the edges that might be in paths from the evidenced cointeraction vertex are colored in green.
\end{remark}

By studying Definition~\ref{DefFlowCore} and Remark~\ref{RemFlowNorm} we can see how a weakly streamlined derivation can be built.

\begin{lemma}\label{LemStreamlinedNorm}
Given a derivation $\Phi$ containing the atoms $a_1,\dots,a_n$ such that\/ $\Norm_{k-1}(\Phi,a_1,\dots,a_{k-1})$ and\/ $\Norm_k(\Phi,a_1,\dots,a_k)$ exist for some $0<k\leq n$, if\/ $\Norm_{k-1}(\Phi,a_1,\dots,a_{k-1})$ is weakly streamlined and none of the atoms $a_k,\dots,a_n$ occur in interaction nor cointeraction instances in\/ $\Norm_{k-1}(\Phi,a_1,\dots,a_{k-1})$ then
\begin{itemize}
 \item none of the atoms $a_{k+1},\dots,a_n$ occur in interaction nor cointeraction instances in $\Norm_k(\Phi,a_1,\dots,a_k)$ and
 \item $\Norm_k(\Phi,a_1,\dots,a_k)$ is weakly streamlined.
\end{itemize}
\end{lemma}

\begin{proof}
Refer to the atomic flow in Remark~\ref{RemFlowNorm} to observe the following:
\begin{itemize}
 \item The only atoms which occur in (co)interaction instances in $\Norm_k(\Phi,a_1,\dots,a_k)$ which did not in $\Norm_{k-1}(\Phi,a_1,\dots,a_{k-1})$ are $a_k$ and $\bar a_k$.
 \item The only interaction and cointeraction vertices mapped to by $a_k$ in the atomic flow associated with $\Norm_k(\Phi,a_1,\dots,a_k)$ are the once that are evidenced; and since the red and the green edges never coincide there can be no path between them. Furthermore, since $\Norm_{k-1}(\Phi,a_1,\dots,a_{k-1})$ is weakly streamlined a path from an interaction to a cointeraction vertex in the atomic flow associated with $\Norm_k(\Phi,a_1,\dots,a_k)$ must contain the red edge between $\psi_1$ and $\psi_2$ or the green edge between $\phi_2$ and $\phi_3$. However, $a_k$ and $\bar a_k$ map to these edges so there can be no path from an interaction to a cointeraction vertex.
\end{itemize}
\end{proof}

\begin{theorem}
Given a derivation $\vlder{\Phi}{}{\beta}{\alpha}$, there are atoms $a_1,\dots,a_n$ in $\Phi$ such that $\vlder{\Norm_n(\Core(\Phi),a_1,\dots,a_n)}{}{\beta}{\alpha}$ is weakly streamlined.
\end{theorem}

\begin{proof}
Choose $a_1,\dots,a_n$ such that no atoms except for $a_1,\dots,a_n$ and their duals map to a path from an interaction to a cointeraction vertex in the atomic flow associated with $\Phi$, then the result follows by Proposition~\ref{PropStreamlinedCore} and Lemma~\ref{LemStreamlinedNorm}.
\end{proof}

%===========================================
\section{Conclusion}

\bibliographystyle{alpha}
\bibliography{biblio}

\end{document}