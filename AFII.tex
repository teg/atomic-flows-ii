\documentclass[a4paper]{amsart}

%                  Trash .aux file after toggling
\usepackage{stmaryrd}
\usepackage{graphicx}
\usepackage[margin=1in]{geometry}
\usepackage[lutzsyntax]{virginialake}\aftrianglefalse
\usepackage[pdfborder={0 0 0}]{hyperref}
\usepackage[urw-garamond]{mathdesign}

%--------- Theorem etc
\newtheorem{thm}{Theorem}[section]
\newtheorem{cor}[thm]{Corollary}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{pro}[thm]{Proposition}

\theoremstyle{remark}
\newtheorem{rem}[thm]{Remark}
\newtheorem{exa}[thm]{Example}

\theoremstyle{definition}
\newtheorem{defi}[thm]{Definition}
%---------

\begin{document}

\title[Normalisation Control in Deep Inference   via Atomic Flows II]
      {Normalisation Control in Deep Inference\\ via Atomic Flows II}

\author{Alessio Guglielmi and Tom Gundersen}
%\address{University of Bath, Bath BA2 7AY, UK}

\thanks{This work was in part funded by an Overseas Research Scholarship and a Research Studentship, both from the University of Bath, and by the British Council Alliance Programme.}

\keywords{Normalisation, deep inference, cut elimination, atomic flows}

\subjclass{F.4.1 Mathematical Logic---Proof theory}

% \begin{abstract}
% \end{abstract}

\maketitle

%===============================================================================
\section{Introduction}


%===============================================================================
\section{Background on Deep Inference}

\newcommand{\fff}{\mathsf f}
\newcommand{\ttt}{\mathsf t}
\newcommand{\ot}{\mathbin\shortleftarrow}

% TODO: check that we only every use the variable names in the following definition

%---------------------------------------
\begin{defi}\label{DefFormulae}
\emph{Formulae}, $\alpha$, $\beta$, $\gamma$, $\delta$ are freely built from: \emph{units}, $\fff$ (false), $\ttt$ (true); \emph{atoms}, $a$, $b$, $c$, $d$; \emph{disjunction} and \emph{conjunction}, ${\vlsbr[\alpha.\beta]}$ and $\vlsbr(\alpha.\beta)$. On the set of atoms a (non-identical) involution $\bar\cdot$ is defined, and dual atom occurrences, as $a$ and $\bar a$, can appear in formulae. We denote \emph{contexts}, \emph{i.e.}, formulae with a hole, by $\xi\vlhole$ and $\zeta\vlhole$; we also use \emph{multiple} contexts, $\xi\vlhole\cdots\vlhole$, \emph{i.e.}, formulae with many holes; for example, if $\xi\{a\}$ is $\vls(b.[a.c])$, then $\xi\vlhole$ is $\vls(b.[\vlhole.c])$, $\xi\{b\}$ is $\vls(b.[b.c])$ and $\xi\vlscn(a.d)$ is $\vls(b.[(a.d).c])$; if $\xi\{a\}\{b\}\{c\}$ is $\vls(b.[(a.d).c])$ then $\xi\{b\}\{c\}\{a\}$ is $\vls(c.[(b.d).a])$.
\end{defi}

%---------------------------------------
\begin{rem}
Negation is only defined for atoms, which is not a limitation thanks to De Morgan laws.
\end{rem}

\newcommand{\one}{{\mathchoice{\scriptstyle\mathbf1}
                              {\scriptstyle\mathbf1}
                              {\scriptstyle\mathbf1}
                              {\scriptscriptstyle\mathbf1}}}
\newcommand{\two}{{\mathchoice{\scriptstyle\mathbf2}
                              {\scriptstyle\mathbf2}
                              {\scriptstyle\mathbf2}
                              {\scriptscriptstyle\mathbf2}}}
%---------------------------------------
\begin{defi}\label{DefDerivation}
\emph{Inference rules}, $\rho$, have one \emph{premiss} and one \emph{conclusion}, and their \emph{instances} are used in \emph{inference steps} to rewrite inside formulae. A \emph{derivation}, $\Phi$, from $\alpha$ (\emph{premiss}) to $\beta$ (\emph{conclusion}) is a chain of inference steps with $\alpha$ at the top and $\beta$ at the bottom, and is usually indicated by $\vlder{\Phi}{\mathcal S}{\beta}{\alpha}$, where $\mathcal S$ is the name of the deductive system or a set of inference rules; a \emph{proof} is a derivation from $\ttt$; besides $\Phi$, we denote derivations with $\Psi$. We denote with $\xi\{\Phi\}$ the result of including every formula of the derivation $\vlder{\Phi}{}{\beta}{\alpha}$ into the context $\xi\vlhole$. Since we adopt deep inference, $\vlder{\xi\{\Phi\}}{}{\xi\{\beta\}}{\xi\{\alpha\}}$ is a valid derivation. Furthermore, $\xi\left\{\vlder{}{}{\beta_1}{\alpha_1}\right\}\cdots\left\{\vlder{}{}{\beta_n}{\alpha_n}\right\}$ denotes
\[
\vlderivation
{
 \vlin{=}{}{\xi\{\beta_1\}\cdots\{\beta_{n-1}\}\left\{\vlder{}{}{\beta_n}{\alpha_n}\right\}}
 {
  \vlin{=}{}{\vdots}
  {
   \vlin{=}{}{\xi\{\beta_1\}\cdots\{\beta_{i-1}\}\left\{\vlder{}{}{\beta_i}{\alpha_i}\right\}\{\alpha_{i+1}\}\cdots\{\alpha_n\}}
   {
    \vlin{=}{}{\vdots}
    {
     \vlhy{\xi\left\{\vlder{}{}{\beta_1}{\alpha_1}\right\}\{\alpha_2\}\cdots\{\alpha_n\}}
    }
   }
  }
 }
}\quad.
\]
\end{defi}

\newcommand{\KS}{\mathsf{KS}}
\newcommand{\SKS}{\mathsf{SKS}}

\newcommand{\ai}{\mathsf{ai}}
\newcommand{\aw}{\mathsf{aw}}
\newcommand{\ac}{\mathsf{ac}}
\newcommand{\aid}{{\ai{\downarrow}}}
\newcommand{\awd}{{\aw{\downarrow}}}
\newcommand{\acd}{{\ac{\downarrow}}}
\newcommand{\aiu}{{\ai{\uparrow}}}
\newcommand{\awu}{{\aw{\uparrow}}}
\newcommand{\acu}{{\ac{\uparrow}}}
\newcommand{\swi}{\mathsf{s}}
\newcommand{\med}{\mathsf{m}}
%---------------------------------------
\begin{defi}
System $\SKS$ in the calculus of structures is defined by the following \emph{structural} rules:
\[
\begin{array}{@{}c@{}c@{}c@{}}
      \vlinf{\aid}{}{\vls[a.{\bar a}]}{\ttt}&
\qquad\vlinf{\awd}{}a\fff&
\qquad\vlinf{\acd}{}a{\vls[a.a]}\\
\noalign{\smallskip}
      \emph{interaction}&
\qquad\emph{weakening}&
\qquad\emph{contraction}\\
\noalign{\bigskip}
      \vlinf{\aiu}{}\fff{\vls(a.{\bar a})}&
\qquad\vlinf{\awu}{}\ttt a&
\qquad\vlinf{\acu}{}{\vls (a.a)}a\\
\noalign{\smallskip}
      \emph{cointeraction}&
\qquad\emph{coweakening}&
\qquad\emph{cocontraction}\\
\end{array}\quad,
\]
and by the two \emph{logical} rules:
\[
\begin{array}{@{}c@{}c@{}}
\vlinf{\swi}{}{\vls[(\alpha.\beta).\gamma]}{\vls(\alpha.[\beta.\gamma])}&\qquad
\vlinf{\med}{}{\vls([\alpha.\gamma].[\beta.\delta])}
              {\vls[(\alpha.\beta).(\gamma.\delta)]}\\
\noalign{\smallskip}
\emph{switch}&\qquad\emph{medial}\\
\end{array}\quad.
\]
The rule cointeraction is also called an (\emph{atomic}) \emph{cut}. In addition to the rules shown, there is a rule $\vldownsmash{\vlinf={}\delta\gamma}$, such that $\gamma$ and $\delta$ are opposite sides in one of the following equations:
\vlstore{
\vls[\alpha.\beta]         &=\vls[\beta.\alpha]         \quad,&
\vls[\alpha.\fff]          &=\vls[\alpha]               \quad,\\
\vls(\alpha.\beta)         &=\vls(\beta.\alpha)         \quad,&
\vls(\alpha.\ttt)          &=\vls(\alpha)               \quad,\\
\vls[[\alpha.\beta].\gamma]&=\vls[\alpha.[\beta.\gamma]]\quad,&
\vls[\ttt.\ttt]            &=\vls[\ttt]                 \quad,\\
\vls((\alpha.\beta).\gamma)&=\vls(\alpha.(\beta.\gamma))\quad,&
\vls(\fff.\fff)            &=\vls(\fff)                 \quad\vldot}
\begin{align*}
\vlread
\end{align*}
We do not always show the instances of rule $=$, and when we do show them, we gather several contiguous instances into one. System $\KS$ is the same as $\SKS$, but without the rules $\aiu$, $\awu$ and $\acu$. A \emph{cut-free} derivation is a derivation where $\aiu$ is not used. All derivations in this paper are in $\SKS$, unless indicated otherwise.
\end{defi}

\begin{rem}
The representations of $\SKS$ derivations in this paper are sometimes ambiguous. This is not a problem, as the derivations themselves are well defined and we can always get a more detailed representation should we need to, for instance when extracting atomic flows from derivations. The ambiguity arises because we omit or collapse equations and because we do not distinguish the different equation rules. In particular we need to know if
\[
\vlinf{=}{}{\vls((a.a).a)}{\vls(a.(a.a))}\quad,
\]
is an application of associativity $\left(\vlinf{=}{}{\vls((a.b).c)}{\vls(a.(b.c))}\right)$ or commutativity $\left(\vlinf{=}{}{\vls((b.c).a)}{\vls(a.(b.c))}\right)$ to be able to map atom occurrences in the premiss to atom occurrences in the conclusion.
\end{rem}

% TODO: find the right place for this example

\begin{exa}\label{ExaFormalismA}
Consider the $\SKS$ derivation
\[
\vls[\vlinf{\acd}{}{a}{\vls[a.a]}.\vlinf{\aiu}{}{\fff}{\vls(\vlinf{\acd}{}{b}{\vls[b.b]}.\bar b)}]\quad,
\]
which is a shorthand for
\[
\vlderivation
{
 \vlin{\aiu}{}{a}
 {
  \vlin{\acd}{}{\vls[a.(b.\bar b)]}
  {
   \vlin{\acd}{}{\vls[a.([b.b].\bar b)]}
   {
    \vlhy{\vls[a.a.([b.b].\bar b)]}
   }
  }
 }
}.
\]
It is implicit in Definition~\ref{DefFormulae} that the ordering of holes in a formula context with multiple holes is given. This decides the order in which we `sequentialise' the short-hand representation of a derivation in Definition~\ref{DefDerivation}. In this example we used a left-to-right ordering, but we could just as well have used a right-to-left ordering:
\[
\vlderivation
{
 \vlin{\acd}{}{a}
 {
  \vlin{\aiu}{}{\vls[a.a]}
  {
   \vlin{\acd}{}{\vls[a.a.(b.\bar b)]}
   {
    \vlhy{\vls[a.a.([b.b].\bar b)]}
   }
  }
 }
}.
\]
In Formalism A, a new deep-inference formalism currently under development, the above shorthand is a representative of the equivalence class containing both the left-to-right and the right-to-left orderings, in addition to the intermediate:
\[
\vlderivation
{
 \vlin{\aiu}{}{a}
 {
  \vlin{\acd}{}{\vls[a.(b.\bar b)]}
  {
   \vlin{\acd}{}{\vls[a.a.(b.\bar b)]}
   {
    \vlhy{\vls[a.a.([b.b].\bar b)]}
   }
  }
 }
}.
\]
For the purposes of this paper, which of these three derivations we use is inessential, as the atomic flows associated with each of them are are the same. For simplicity we let the shorthand above refer to one unique derivation, but we could just as well have worked in Formalism A.
\end{exa}

We now present some results needed later on for manipulating derivations. The main idea in this paper is to normalise proofs or derivations by making many copies, manipulating the copies and gluing them together. We first show how we can copy derivations, which means copying their premiss and conclusion:

\newcommand{\contr}{\mathsf{c}}
\newcommand{\cod}{{\contr{\downarrow}}}
\newcommand{\cou}{{\contr{\uparrow}}}

\begin{lem}\label{LemGenericContraction}
Given a formula $\alpha$ and a positive integer $n$, there exist derivations $\vlder{}{\{\acd,\med\}}{\alpha}{\bigvee_{i=1}^{n}\alpha}$ and $\vlder{}{\{\acu,\med\}}{\bigwedge_{i=1}^{n}\alpha}{\alpha}$.
\end{lem}

\begin{rem}
In the non-atomic version of system $\SKS$ the above derivations correspond to repeated applications of (co)contractions. For this reason we sometimes write the inference rules $\vlinf{\cod}{}{\alpha}{\vls[\alpha.\alpha]}$ and $\vlinf{\cou}{}{\vls(\alpha.\alpha)}{\alpha}$ instead of the derivations $\vlder{}{\{\acd,\med\}}{\alpha}{\vls[\alpha.\alpha]}$ and $\vlder{}{\{\acu,\med\}}{\vls(\alpha.\alpha)}{\alpha}$.
\end{rem}

To make our normalisation procedures work, it is not enough to manipulate the derivations separately, we need to make them interact. That is to say, we need to extract a subformula from one derivation and insert it into another one, or we need to extract subformulae from several derivation and have them interact.

\begin{lem}\label{LemSuperSwitch}
Given a context $\xi\vlhole$ and a formula $\alpha$ there exist derivations $\vlder{}{\{\swi\}}{\xi\{\alpha\}}{\vls(\alpha.\xi\{\ttt\})}$ and $\vlder{}{\{\swi\}}{\vls[\xi\{\fff\}.\alpha]}{\xi\{\alpha\}}$.
\end{lem}

\begin{proof}
We show how to construct the first derivation, the second one can be done by symmetry. We argue by induction on the number of atoms in $\xi\vlhole$. The base case, $\xi\vlhole=\vlhole$, is trivial and the inductive cases are:

\[
\vlderivation
{
 \vlin{=}{}{\xi\{\alpha\}}
 {
  \vlin{\swi}{}{\vls[\vlder{\Psi}{\{\swi\}}{\xi'\{\alpha\}}{\vls(\alpha.\xi'\{\ttt\})}.\beta]}
  {
   \vlin{=}{}{\vls(\alpha.[\xi'\{\ttt\}.\beta])}
   {
    \vlhy{\vls(\alpha.\xi\{\ttt\})}
   }
  }
 }
}\qquad\mbox{and}\qquad
\vlderivation
{
 \vlin{=}{}{\xi\{\alpha\}}
 {
  \vlin{=}{}{\vls(\vlder{\Psi'}{\{\swi\}}{\xi'\{\alpha\}}{\vls(\alpha.\xi'\{\ttt\})}.\beta)}
  {
   \vlhy{\vls(\alpha.\xi\{\ttt\})}
  }
 }
}\quad,
\]
for some $\xi'\vlhole$ and $\beta$ where $\beta$ is not a unit and $\Psi$ and $\Psi'$ exist by the inductive hypothesis.
\end{proof}

The application of this `extraction' is going to be to extract axioms and cuts so that they can be eliminated. It is a fortunate consequence of having atomic inference rules that we can trivially transform a derivation into one where all the axioms are at the top and all the cuts at the bottom of the derivation. Note that this transformation does not affect the atomic flow since we are only adding linear inference rules and leaving the structural ones alone.

% TODO: give a name to this thing

\begin{lem}\label{LemDecompInt}
Given a derivation $\vlder{\Phi}{}{\beta}{\alpha}$, there exists a derivation
\[\hat\Phi=
\vlder{}{\SKS\setminus\{\aid,\aiu\}}{\vls[\beta.\vlinf{\aiu}{}{\fff}{\vls(b_m.\bar b_m)}.\cdots.\vlinf{\aiu}{}{\fff}{\vls(b_1.\bar b_1)}]}{\vls(\vlinf{\aid}{}{\vls[a_1.\bar a_1]}{\ttt}.\cdots.\vlinf{\aid}{}{\vls[a_n.\bar a_n]}{\ttt}.\alpha)}\quad,
\]
for some atoms $a_1,\dots,a_n,b_1,\dots,b_m$.
\end{lem}

\begin{proof}
Using Lemma~\ref{LemSuperSwitch} apply the following transformations to each of the (co)interaction instances in $\Phi$:
\[
\vlderivation
{
 \vlde{\Psi'}{}{\delta}
 {
  \vlin{\aid}{}{\xi\vlsbr[a.{\bar a}]}
  {
   \vlde{\Psi}{}{\xi\{\ttt\}}
   {
    \vlhy{\gamma}
   }
  }
 }
}\quad\rightarrow\quad
\vlderivation
{
 \vlde{\Psi'}{}{\delta}
 {
  \vlde{}{\{\swi\}}{\xi\vlsbr[a.{\bar a}]}
  {
   \vlhy{\vlsbr(\vlinf{\aid}{}{\vls[a.{\bar a}]}{\ttt}.\vlder{\Psi}{}{\xi\{\ttt\}}{\gamma})}
  }
 }
}\qquad\mbox{and}\qquad
\vlderivation
{
 \vlde{\Psi'}{}{\delta}
 {
  \vlin{\aid}{}{\xi\{\fff\}}
  {
   \vlde{\Psi}{}{\xi\vlsbr(a.{\bar a})}
   {
    \vlhy{\gamma}
   }
  }
 }
}\quad\rightarrow\quad
\vlderivation
{
 \vlde{}{\{\swi\}}{\vlsbr[\vlder{\Psi'}{}{\delta}{\xi\{\fff\}}.\vlinf{\aiu}{}{\fff}{\vls(a.{\bar a})}]}
 {
  \vlde{\Psi}{}{\xi\vlsbr(a.{\bar a})}
  {
   \vlhy{\gamma}
  }
 }
}\quad.
\]
\end{proof}

%===============================================================================

\section{Background on Atomic Flows}

%---------------------------------------
\begin{defi}
We call the following six diagrams (\emph{atomic-flow}) \emph{labels}:
\[
\begin{array}{@{}c@{}c@{}c@{}}
      \vcenter{\afaid{}{}{}{}{}{}}&
\qquad\vcenter{\afawd{}{}{}{}}&
\qquad\vcenter{\afacd{}{}{}{}{}{}}\\
\noalign{\smallskip}
      \mbox{$\aid$ or \emph{interaction}}&
\qquad\mbox{$\awd$ or \emph{weakening}}&
\qquad\mbox{$\acd$ or \emph{contraction}}\\
\noalign{\bigskip}
      \vcenter{\afaiu{}{}{}{}{}{}}&
\qquad\vcenter{\afawu{}{}{}{}}&
\qquad\vcenter{\afacu{}{}{}{}{}{}}\\
\noalign{\smallskip}
      \mbox{$\aiu$ or \emph{cointeraction}}&
\qquad\mbox{$\awu$ or \emph{coweakening}}&
\qquad\mbox{$\acu$ or \emph{cocontraction}}\\
\end{array}\quad.
\]
Cointeraction is also called \emph{cut}.
\end{defi}


\newbox\contrup\setbox\contrup=\hbox{$
   \divide\atflowunit by5\multiply\atflowunit by3\afsetunits
   \atomicflow{(0,0)*{\afacu{}{}{}{}{}{}}}$}
\newbox\contrdown\setbox\contrdown=\hbox{$
   \divide\atflowunit by5\multiply\atflowunit by3\afsetunits
   \atomicflow{(0,0)*{\afacd{}{}{}{}{}{}}}$}
\newbox\interdown\setbox\interdown=\hbox{$
   \divide\atflowunit by5\multiply\atflowunit by3\afsetunits
   \atomicflow{(0,0)*{\afaid{}{}{}{}{}{}}}$}
\newbox\interup\setbox\interup=\hbox{$
   \divide\atflowunit by5\multiply\atflowunit by3\afsetunits
   \atomicflow{(0,0)*{\afaiu{}{}{}{}{}{}}}$}
\newbox\weakdown\setbox\weakdown=\hbox{$
   \divide\atflowunit by5\multiply\atflowunit by3\afsetunits
   \atomicflow{(0,0)*{\afawd{}{}{}{}{}{}}}$}
\newbox\weakup\setbox\weakup=\hbox{$
   \divide\atflowunit by5\multiply\atflowunit by3\afsetunits
   \atomicflow{(0,0)*{\afawu{}{}{}{}{}{}}}$}

\newcommand{\ppl  }{{\mathchoice{\scriptstyle+}
                                {\scriptstyle+}
                                {\scriptstyle+}
                                {\scriptscriptstyle+}}}
\newcommand{\pmi  }{{\mathchoice{\scriptstyle-}
                                {\scriptstyle-}
                                {\scriptstyle-}
                                {\scriptscriptstyle-}}}
\newcommand{\three}{{\mathchoice{\scriptstyle\mathbf3}
                                {\scriptstyle\mathbf3}
                                {\scriptstyle\mathbf3}
                                {\scriptscriptstyle\mathbf3}}}
\newcommand{\four }{{\mathchoice{\scriptstyle\mathbf4}
                                {\scriptstyle\mathbf4}
                                {\scriptstyle\mathbf4}
                                {\scriptscriptstyle\mathbf4}}}
\newcommand{\five }{{\mathchoice{\scriptstyle\mathbf5}
                                {\scriptstyle\mathbf5}
                                {\scriptstyle\mathbf5}
                                {\scriptscriptstyle\mathbf5}}}
\newcommand{\six  }{{\mathchoice{\scriptstyle\mathbf6}
                                {\scriptstyle\mathbf6}
                                {\scriptstyle\mathbf6}
                                {\scriptscriptstyle\mathbf6}}}
\newcommand{\seven}{{\mathchoice{\scriptstyle\mathbf7}
                                {\scriptstyle\mathbf7}
                                {\scriptstyle\mathbf7}
                                {\scriptscriptstyle\mathbf7}}}
\newcommand{\eight}{{\mathchoice{\scriptstyle\mathbf8}
                                {\scriptstyle\mathbf8}
                                {\scriptstyle\mathbf8}
                                {\scriptscriptstyle\mathbf8}}}
\newcommand{\nine }{{\mathchoice{\scriptstyle\mathbf9}
                                {\scriptstyle\mathbf9}
                                {\scriptstyle\mathbf9}
                                {\scriptscriptstyle\mathbf9}}}
\newcommand{\card}[1]{\mathord\vert #1\mathord\vert}
\newcommand{\up}{{\mathit up}}
\newcommand{\lo}{{\mathit lo}}
%---------------------------------------
\begin{defi}
An (\emph{atomic}) \emph{flow} is a tuple $(V,E,\eta,\up,\lo)$ such that:
\begin{enumerate}
%-------------------
\item $V$ is a finite set of \emph{vertices}, denoted by $\nu$;
%-------------------
\item $E$ is a finite set of \emph{edges}, denoted by $\epsilon$;
%-------------------
\item $\eta\colon V\to\{\aid,\aiu,\awd,\awu,\acd,\acu\}$ maps vertices to their \emph{labels};
%-------------------
\item $\up\colon E\to V\cup\{\top\}$ and $\lo\colon E\to V\cup\{\bot\}$ are, respectively, the \emph{upper} and \emph{lower} maps, and $\top$ and $\bot$ are special vertices not belonging to $V$; we define, for every $\nu\in V\cup\{\top,\bot\}$, the set $L_\nu=\{\,\epsilon\mid\up(\epsilon)=\nu\,\}$ of \emph{lower edges of $\nu$}, the set $U_\nu=\{\,\epsilon\mid\lo(\epsilon)=\nu\,\}$ of \emph{upper edges of $\nu$}, and the set $E_\nu=L_\nu\cup U_\nu$ of \emph{edges of $\nu$};
%-------------------
\item if $\card S$ denotes the cardinality of set $S$, we have that
\begin{align*}
\mbox{if $\eta(\nu)=\aid$ then $\card{L_\nu}=2$ and $\card{U_\nu}=0$,}&\\
\mbox{if $\eta(\nu)=\aiu$ then $\card{L_\nu}=0$ and $\card{U_\nu}=2$,}&\\
\mbox{if $\eta(\nu)=\awd$ then $\card{L_\nu}=1$ and $\card{U_\nu}=0$,}&\\
\mbox{if $\eta(\nu)=\awu$ then $\card{L_\nu}=0$ and $\card{U_\nu}=1$,}&\\
\mbox{if $\eta(\nu)=\acd$ then $\card{L_\nu}=1$ and $\card{U_\nu}=2$,}&\\
\mbox{if $\eta(\nu)=\acu$ then $\card{L_\nu}=2$ and $\card{U_\nu}=1$;}&
\end{align*}
%-------------------
\item\label{ItAcycl} there is no sequence $\epsilon_1,\dots,\epsilon_h$ of edges of $V$ such that $\up(\epsilon_i)=\lo(\epsilon_{i+1\pmod h})$, for $1\le i\le h$;
%-------------------
\item\label{ItPol} there is a \emph{polarity assignment} $\pi\colon E\to\{\pmi,\ppl\}$ such that, for every $\nu\in V$,
\begin{enumerate}
%---------
\item if $\eta(\nu)\in\{\acd,\acu\}$ then $\pi(E_\nu)=\{\pmi\}$ or $\pi(E_\nu)=\{\ppl\}$;
%---------
\item if $\eta(\nu)\in\{\aid,\aiu\}$ then $\pi(E_\nu)=\{\pmi,\ppl\}$.
\end{enumerate}
\end{enumerate}
Besides $\epsilon$, we use small numerals $\one$, $\two$, \dots\ to denote edges. Atomic flows are denoted with $A$, $B$. Given an atomic flow $A$, we say that the sets $L_\top=\{\epsilon_1,\dots,\epsilon_h\}$ and $U_\bot=\{\epsilon'_1,\dots,\epsilon'_k\}$ contain, respectively, the \emph{upper} and \emph{lower edges of $A$}; in such a case, we can represent $A$ as
\[
\atomicflow{
(-4,0)*{\invisiblemark};
( 0,6)*{\afvjum4{\epsilon_1}{\epsilon_h}};
( 0,0)*{\affr88};
( 2,2)*{A};
( 0,-6)*{\afvjdm4{\epsilon'_1}{\epsilon'_k}};
( 4,0)*{\invisiblemark}}
\quad,
\]
where the labels $\epsilon_1, \epsilon_h, \epsilon'_1, \epsilon'_k$ may be omitted if they are irrelevant or clear from the context.

We sometimes label an atomic flow by the image of the labeling function, $\eta(V)$, \emph{e.g.}
\[
\atomicflow{
(-4,8)*{\invisiblemark};
( 0,0)*{\affr88};
( 0,0)*{\copy\interdown};
( 0,-6)*{\afvjm4};
( 4,0)*{\invisiblemark}
}\quad,\quad
\atomicflow{
(-6,0)*{\invisiblemark};
( 0,6)*{\afvjm4};
( 0,0)*{\affr{12}8};
(-3,0)*{\copy\contrdown};
( 3,0)*{\copy\contrup};
( 0,-6)*{\afvjm4};
( 6,0)*{\invisiblemark}
}\quad.
\]

In general, we represent atomic flows as directed-graph diagrams, except that the special vertices $\top$ and $\bot$ are not shown, and the labels of the vertices are explicitly shown as graphical elements. When we refer to the vertices of an atomic flow, we do not include $\top$ and $\bot$. Sometimes we identify vertices with their labels. 
\end{defi}

%---------------------------------------
\begin{exa}
Consider the atomic flow
\begin{align*}
A=(&\{\;\nu_1\;,\;\nu_2\;,\;\nu_3\;\},\\
   &\{\;\one\;,\;\two\;,\;\three\;,\;\four\;,\;\five\;\},\\
   &\{\;\nu_1\mapsto\aiu\;,\;\nu_2\mapsto\acu\;,\;\nu_3\mapsto\aiu\;\},\\
   &\{\;\one\mapsto\top\;,\;\two\mapsto\top\;,\;\three\mapsto\nu_2\;,\;
        \four\mapsto\nu_2\;,\;\five\mapsto\top\;\},\\
   &\{\;\one\mapsto\nu_1\;,\;\two\mapsto\nu_2\;,\;\three\mapsto\nu_1\;,\;
        \four\mapsto\nu_3\;,\;\five\mapsto\nu_3\;\})
\quad;
\end{align*}
the following are three of its possible representations:
\[
\atomicflow{
(10,8)*{\afacu\four{}{}{}{}\two};
( 0,8)*{\afvjd8\one{}};
( 4,8)*{\afvjd8{}\five};
( 6,2)*{\afaiunw{}{}};
( 6,0)*{\afaiuex{}{}{}\three{}{}31}}
\quad,\qquad
\aflower{\atomicflow{
( 0  ,6)*{\afvjd{8}\one\ppl};
( 6  ,6)*{\afacu\three{}{}\four\two\pmi};
(12  ,6)*{\afvjd{8}\ppl\five};
(10  ,0)*{\afaiunw{}{}};
( 2  ,0)*{\afaiunw{}{}};
(-1.5,0)*{\invisiblemark};
(13.5,0)*{\invisiblemark}}}
\qquad\hbox{and}\qquad
\atomicflow{
( 8  ,10)*{\afacu{}\three{}\four\two\ppl};
( 0  , 8)*{\afvjd{12}\one\pmi};
( 4  ,10)*{\afvjd{8}\five\pmi};
( 5  , 4)*{\afex24};
(10  , 4)*{\afvj4};
( 2  , 0)*{\afaiunw{}{}};
( 8  , 0)*{\afaiunw{}{}};
(-1.5, 0)*{\invisiblemark};
(11.5, 0)*{\invisiblemark}}
\quad;
\]
\afnegspace
in the last two diagrams, we also indicated each of the two possible polarity assignments. This flow has one cocontraction and two cointeraction vertices; it has three upper edges, $\one$, $\two$ and $\five$, and no lower edges.
\end{exa}

%---------------------------------------
\afnegspace
\begin{exa}
The graph
$\atomicflow{
(0,4)*{\afaidnw{}{}};
(0,0)*{\afacd{}{}{}{}{}{}}}$
is not an atomic flow, for lack of a polarity assignment.
\end{exa}

%---------------------------------------
\begin{pro}\label{PropUnFl}
Given an\/ $\SKS$ derivation\/ $\Phi$, there is a unique atomic flow $A$ (modulo isomorphisms) such that:
\begin{enumerate}
%-------------------
\item there is a surjective map between the set of atom occurrences of\/ $\Phi$ and the set of edges of $A$;
%-------------------
\item for each inference step $\vlsmash{\vlinf{\rho}{}{\xi\{\beta\}}{\xi\{\alpha\}}}$ of\/ $\Phi$, where $\rho\in\{\aid,\aiu,\awd,\awu,\acd,\acu\}$ and $\vlinf{\rho}{}{\beta}{\alpha}$ is a rule instance, all atom occurrences in $\xi\vlhole$ in the premiss are respectively mapped to the same edges of $A$ as the atom occurrences in $\xi\vlhole$ in the conclusion; the atom occurrences in $\vlinf{\rho}{}{\beta}{\alpha}$ are mapped to edges of $A$ such that the edges are related with vertices as indicated below, for each possible case of the inference step:
\[
\begin{array}{@{}ccc@{}ccc@{}}
\vlinf{\aid}{}{\vls[a^\one.{\bar a^\two}]}{\ttt}&\mbox{to\/}&
\vcenter{\afaid\one{}{}\two{}{}}
\quad,&\qquad
\vlinf{\aiu}{}{\fff}{\vls(a^\one.{\bar a^\two})}&\mbox{to\/}&
\vcenter{\afaiu\one{}{}\two{}{}}
\quad,\\
\noalign{\medskip}
\vlinf{\awd}{}{a^\one}{\fff}                    &\mbox{to\/}&
\vcenter{\afawd{}{}{}\one{}} 
\quad,&\qquad
\vlinf{\awu}{}{\ttt}{a^\one}                    &\mbox{to\/}&
\vcenter{\afawu{}{}{}\one{}}
\quad,\\
\noalign{\medskip}
\vlinf{\acd}{}{a^\three}{\vls[a^\one.a^\two]}   &\mbox{to\/}&
\vcenter{\afacd\one{}{}\two{}\three}
\quad,&\qquad
\vlinf{\acu}{}{\vls(a^\two.a^\three)}{a^\one}   &\mbox{to\/}&
\vcenter{\afacu\two{}{}\three{}\one}
\quad,\\
\end{array}
\]
where the mapping is indicated by small numerals.
%-------------------
\item for each inference step of\/ $\Phi$ of kind
\[\hss
\begin{array}{@{}r@{}l@{}}
\vlinf{\swi}{}{\xi\vlscn[(\alpha.\beta).\gamma]}
              {\xi\vlscn(\alpha.[\beta.\gamma])}           \quad,&\qquad
\vlinf{\med}{}{\xi\vlscn([\alpha.\gamma].[\beta.\delta])}
              {\xi\vlscn[(\alpha.\beta).(\gamma.\delta)]}  \quad,      \\
\noalign{\smallskip}
\vlinf={}{\xi\vlscn[\beta.\alpha]}{\xi\vlscn[\alpha.\beta]}\quad,&\qquad
\vlinf={}{\xi\vlscn(\beta.\alpha)}{\xi\vlscn(\alpha.\beta)}\quad,      \\
\noalign{\smallskip}
\vlinf={}{\xi\vlscn[\alpha.[\beta.\gamma]]}
         {\xi\vlscn[[\alpha.\beta].\gamma]}                \quad,&\qquad
\vlinf={}{\xi\vlscn[[\alpha.\beta].\gamma]}
         {\xi\vlscn[\alpha.[\beta.\gamma]]}                \quad,      \\
\noalign{\smallskip}
\vlinf={}{\xi\vlscn(\alpha.(\beta.\gamma))}
         {\xi\vlscn((\alpha.\beta).\gamma)}                \quad,&\qquad
\vlinf={}{\xi\vlscn((\alpha.\beta).\gamma)}
         {\xi\vlscn(\alpha.(\beta.\gamma))}                \quad,      \\
\noalign{\smallskip}
\vlinf={}{\xi\{\alpha\}}{\xi\vlscn[\alpha.\fff]}           \quad,\qquad
\vlinf={}{\xi\vlscn[\alpha.\fff]}{\xi\{\alpha\}}           \quad,&\qquad
\vlinf={}{\xi\{\alpha\}}{\xi\vlscn(\alpha.\ttt)}        \qquad\hbox{and\/}\qquad
\vlinf={}{\xi\vlscn(\alpha.\ttt)}{\xi\{\alpha\}}
\end{array}
\]
all the atom occurrences in $\xi\vlhole$, $\alpha$, $\beta$, $\gamma$ and $\delta$ in the premiss are respectively mapped to the same edges of $A$ as the atom occurrences in $\xi\vlhole$, $\alpha$, $\beta$, $\gamma$ and $\delta$ in the conclusion.
\end{enumerate}
\end{pro}

%---------------------------------------
% TODO: this is now talking about flows, how about subflows?
\begin{defi}
Given a derivation $\Phi$, we say that the unique atomic flow $A$ defined in Proposition~\ref{PropUnFl} is the atomic flow \emph{associated with} the derivation $\Phi$. Sometimes, when an atom occurrence $a$ in $\Phi$ maps to an edge $\epsilon$ in $A$, we decorate $\epsilon$ with the label $a$. Similarly, if an atom occurrence $a$ maps to all the edges in the atomic flow $A$, we decorate $A$ with the label $a$.
\end{defi}

%---------------------------------------
\begin{exa}
Figure~\ref{FigExAF} has some examples of atomic flows associated with derivations.
\end{exa}

\newcommand{\RD}[1]{#1}
\newcommand{\GR}[1]{#1}
\newcommand{\DO}[1]{#1}
\newcommand{\PB}[1]{#1}
\newcommand{\MG}[1]{#1}
\newcommand{\SG}[1]{#1}
\newcommand{\RS}[1]{#1}
\newcommand{\YO}[1]{#1}
\newcommand{\PW}[1]{#1}
%---------------------------------------
\begin{figure}[tbp]
\[
\begin{array}{@{}c@{}c@{}c@{}}
\vlderivation                                                  {
\vlin{=   }{}{\ttt                                  }         {
\vlin{\aiu}{}{\vls[\fff.\ttt]                       }        {
\vlin{=   }{}{\vls[(\GR{a}.\RD{\bar a}).\ttt]       }       {
\vlin{\swi}{}{\vls[[(\RD{\bar a}.\GR{a}).\ttt].\ttt]}      {
\vlin{=   }{}{\vls[(\RD{\bar a}.[\GR{a}.\ttt]).\ttt]}     {
\vlin{\swi}{}{\vls[([\GR{a}.\ttt].\RD{\bar a}).\ttt]}    {
\vlin{=   }{}{\vls([\GR{a}.\ttt].[\RD{\bar a}.\ttt])}   {
\vlin{\med}{}{\vls([\GR{a}.\ttt].[\ttt.\RD{\bar a}])}  {
\vlin{=   }{}{\vls[(\GR{a}.\ttt).(\ttt.\RD{\bar a})]} {
\vlin{\aid}{}{\vls[\GR{a}.\RD{\bar a}]              }{
\vlhy        {\ttt                                  }}}}}}}}}}}}
\qquad&
\vlderivation                                                              {
\vlin{\aiu}{}
   {\vls(\DO{a}.\fff)                                            }        {
\vlin{=   }{}
   {\vls(\DO{a}.(\PB{a}.\MG{\bar a}))                            }       {
\vlin{\acu}{}
   {\vls((\DO{a}.\PB{a}).\MG{\bar a})                            }      {
\vlin{=   }{}
   {\vls(\SG{a}.\MG{\bar a})                                     }     {
\vlin{\aiu}{}
   {\vls([\fff.\SG{a}].\MG{\bar a})                              }    {
\vlin{\acd}{}
   {\vls([(\RD{a}.\RS{\bar a}).\SG{a}].\MG{\bar a})              }   {
\vlin{\swi}{}
   {\vls([(\RD{a}.[\GR{\bar a}.\YO{\bar a}]).\SG{a}].\MG{\bar a})}  {
\vlin{=   }{}
   {\vls((\RD{a}.[[\GR{\bar a}.\YO{\bar a}].\SG{a}]).\MG{\bar a})} {
\vlin{\aid}{}
   {\vls(\RD{a}.[\GR{\bar a}.[\YO{\bar a}.\SG{a}]].\MG{\bar a})  }{
\vlhy        
   {\vls(\RD{a}.[\GR{\bar a}.\ttt].\MG{\bar a})                  }}}}}}}}}}}
\qquad&
\vlderivation                                                              {
\vlin{=   }{}{\vls(([\RS{a}.\YO{b}].\PW{c}).([\GR{a}.\DO{b}].\SG{c}))}    {
\vlin{\med}{}{\vls(([\RS{a}.\YO{b}].[\GR{a}.\DO{b}]).(\PW{c}.\SG{c}))}   {
\vlin{\acu}{}{\vls([(\RS{a}.\GR{a}).(\YO{b}.\DO{b})].(\PW{c}.\SG{c}))}  {
\vlin{\acu}{}{\vls([(\RS{a}.\GR{a}).(\YO{b}.\DO{b})].\MG{c})         } {
\vlin{\acu}{}{\vls([(\RS{a}.\GR{a}).\PB{b}].\MG{c})                  }{
\vlhy        {\vls([\RD{a}.\PB{b}].\MG{c})                           }}}}}}}\\
\atomicflow{
(0,0)*{\afaiucol{}{}{}{}{}{}{Green}{Red}{}};
(0,4)*{\afaidnw{}{}}}
\qquad&
\atomicflow{
( 2,14)*{\afvjcol4{Green}};
( 0,10)*{\afvjcol{12}{Red}};
(16,10)*{\afvjcol{12}{Magenta}};
( 4, 8)*{\afacdcol{}{}{}{}{}{}{Green}{YellowOrange}{RawSienna}};
(10, 8)*{\afacucol{}{}{}{}{}{}{DarkOrchid}{ProcessBlue}{SpringGreen}};
( 2, 2)*{\afaiunw{}{}};
( 8, 2)*{\afvjcol4{DarkOrchid}};
(14, 2)*{\afaiunw{}{}};
( 8,12)*{\afaidnw{}{}}}
\qquad&
\atomicflow{
( 0,0)*{\afacucol{}{}{}{}{}{}{RawSienna}{Green}{Red}};
(10,0)*{\afacucol{}{}{}{}{}{}{YellowOrange}{DarkOrchid}{ProcessBlue}};
(20,0)*{\afacucol{}{}{}{}{}{}{Periwinkle}{SpringGreen}{Magenta}}}
\end{array}
\]
\caption{Examples of atomic flows associated with derivations.}
\label{FigExAF}
\end{figure}

%---------------------------------------
\begin{defi}
Given an atomic flow $(V,E,\eta,\up,\lo)$ and $\epsilon_1,\dots,\epsilon_h\in E$ such that, for $1\le i<h$, we have $\lo(\epsilon_i)=\up(\epsilon_{i+1})$, $\up(\epsilon_1)=\nu$ and $\lo(\epsilon_h)=\nu'$, we say that $\epsilon_1,\dots,\epsilon_h$ is a \emph{path from $\nu$ to $\nu'$} and that $\epsilon_h,\dots,\epsilon_1$ is a \emph{path from $\nu'$ to $\nu$}.
\end{defi}

\newcommand{\mac}{\mathsf{ac}}

\begin{defi}\label{DefModuloContr}
Let $=_\mac$ be the equivalence relation generated by the following flow rewriting system:
\[
\atomicflow
{
(-2,2)*{\afacdnw{\one}{}{\two}{}};
(0,-2)*{\afacd{}{}{}{}{\four}{}};
(2,4)*{\afvju4{\three}{}}
}\quad\rightarrow\quad
\atomicflow
{
(2,2)*{\afacdnw{\two}{}{\three}{}};
(0,-2)*{\afacd{}{}{}{}{\four}{}};
(-2,4)*{\afvju4{\one}{}}
}\quad,\qquad
\atomicflow
{
(-2,-4)*{\afacunw{\two}{}{\three}{}};
(0,2)*{\afacu{}{}{}{}{\one}{}};
(2,-4)*{\afvju4{\four}{}}
}\quad\rightarrow\quad
\atomicflow
{
(2,-4)*{\afacunw{\three}{}{\four}{}};
(0,2)*{\afacu{}{}{}{}{\one}{}};
(-2,-4)*{\afvju4{\two}{}}
}\quad,
\]
then we say two atomic flows, $A$, $B$ are \emph{equal modulo associativity of contraction} if $A=_\mac B$.
\end{defi}

% from what i understand an equivalence relation generated from a rewriting system is the reflexive, transitive, symmetric closure of the system

\begin{rem}
Any two atomic flows containing only contraction (resp., cocontraction) vertices, with one lower (resp., upper) edge and the same number of upper (resp., lower) edges are equal modulo associativity of contraction:
\[
\atomicflow{
(-6,0)*{\invisiblemark};
( 0,6)*{\afvjum4{\epsilon_1}{\epsilon_n}};
( 0,0)*{\affr88};
( 0,0)*{\copy\contrdown};
( 0,-6)*{\afvj4};
( 6,0)*{\invisiblemark}
}=_\mac
\atomicflow{
(-6,0)*{\invisiblemark};
( 0,6)*{\afvjum4{\hat\epsilon_1}{\hat\epsilon_n}};
( 0,0)*{\affr88};
( 0,0)*{\copy\contrdown};
( 0,-6)*{\afvj4};
( 6,0)*{\invisiblemark}
}\quad,\quad
\atomicflow{
(-6,0)*{\invisiblemark};
( 0,6)*{\afvj4};
( 0,0)*{\affr88};
( 0,0)*{\copy\contrup};
( 0,-6)*{\afvjdm4{\epsilon_1}{\epsilon_n}};
( 6,0)*{\invisiblemark}
}=_\mac
\atomicflow{
(-6,0)*{\invisiblemark};
( 0,6)*{\afvj4};
( 0,0)*{\affr88};
( 0,0)*{\copy\contrup};
( 0,-6)*{\afvjum4{\hat\epsilon_1}{\hat\epsilon_n}};
( 6,0)*{\invisiblemark}
}\quad.
\]
\end{rem}

\begin{rem}\label{RemUniquGenContr}
For the purposes of this paper we will assume that the atomic flows associated with any two derivations of the form $\vlder{}{\{\acd,\med\}}{\alpha}{\bigvee_{i=1}^{n}\alpha}$ (resp., $\vlder{}{\{\acu,\med\}}{\bigwedge_{i=1}^{n}\alpha}{\alpha}$) are equal modulo associativity of contraction. This follows from the previous remark if we consider all the atoms occurring in $\alpha$ to be distinct.
\end{rem}

\begin{pro}
Given a derivation $\Phi$, let $\hat\Phi$ be the derivation obtained from $\Phi$ by Lemma~\ref{LemDecompInt}, then the atomic flow associated with $\Phi$ is isomorphic to the atomic flow associated with $\hat\Phi$.
\end{pro}

%===============================================================================
\section{Strongly Normalising Streamlining}

Streamlining is an up-down symmetric generalisation of cut-elimination which applies to derivations as well as proofs. We recall the definition from \cite{GuglGund:07:Normalis:lr}:

%---------------------------------------
\begin{defi}
An $\SKS$ derivation is \emph{streamlined} if, in its associated atomic flow, there are no paths from interaction or weakening vertices to cointeraction or coweakening vertices.
\end{defi}

%---------------------------------------
\begin{rem}\label{RemStr}
It immediately follows from the definition that the diagram below describes the shape of a streamlined derivation:
\[
\atomicflow{
(-10,11)*{\afvjm4};
%---
(-15, 5)*{\copy\contrup};
(-10, 5)*{\affr{28}8};
( -5, 5)*{\copy\contrdown};
( 10, 5)*{\copy\interdown};
( 10, 5)*{\affr88};
( 20, 5)*{\copy\weakdown};
( 20, 5)*{\affr88};
%---
(-20, 0)*{\afvjm2};
(-10, 0)*{\afvjm2};
(  0, 0)*{\afvjm2};
( 10, 0)*{\afvjm2};
( 20, 0)*{\afvjm2};
%---
(-20,-5)*{\copy\weakup};
(-20,-5)*{\affr88};
(-10,-5)*{\copy\interup};
(-10,-5)*{\affr88};
(  5,-5)*{\copy\contrup};
( 10,-5)*{\affr{28}8};
( 15,-5)*{\copy\contrdown};
%---
(  10,-11)*{\afvjm4};
}\quad.
\]
\end{rem}

From our point of view, the main challenge in streamlining a derivation is to make sure there are no paths from axioms to cuts. Once this is achieved it is straightforward to use (confluent and strongly normalising) weakening reductions to obtain a streamlined derivation. This motivates the following definition:

%---------------------------------------
\begin{defi}
An $\SKS$ derivation is \emph{weakly streamlined} if, in its associated atomic flow, there are no paths from interaction vertices to cointeraction vertices.
\end{defi}

%---------------------------------------
\begin{rem}\label{RemStr}
It immediately follows from the definition that the diagram below describes the shape of a weakly streamlined derivation:
\[
\atomicflow{
(-5, 11)*{\afvjm4};
%---
( -5, 5)*{\affr{18}8};
(-10, 5)*{\copy\contrup};
( -5, 5)*{\copy\weakdown};
(  0, 5)*{\copy\contrdown};
( 10, 5)*{\affr88};
( 10, 5)*{\copy\interdown};
%---
(-10, 0)*{\afvjm2};
(  0, 0)*{\afvjm2};
( 10, 0)*{\afvjm2};
%---
(-10,-5)*{\affr88};
(-10,-5)*{\copy\interup};
(  5,-5)*{\affr{18}8};
(  0,-5)*{\copy\contrup};
(  5,-5)*{\copy\weakup};
( 10,-5)*{\copy\contrdown};
%---
(  5,-11)*{\afvjm4};
}\quad.
\]
\end{rem}

\subsection{The Core}

As a consequence of having atomic structural inference rules, deep inference allows us to trivially assume that all axioms happen in the premiss and all cuts happen in the conclusion of the derivation. Furthermore, we can (co)contract axioms and cuts so that every atom occurs in at most one axiom and at most one cut. If a derivation, $\Phi$, has this shape we can obtain a weakly streamlined derivation simply by considering all the atoms which occur in both an axiom and a cut and replacing the axiom and the cut by their conclusion and premiss respectively. This weakly streamlined derivation, clearly does not have the same premiss and conclusion as $\Phi$, but, as will be made precise later, their atomic flows are almost the same and for this reason we call this the \emph{core of $\Phi$}. The core will be the building block we will use to build a weakly streamlined derivation with the same premiss and conclusion as $\Phi$.

\newcommand{\Core}{\mathsf{Core}}

\begin{defi}\label{DefCore}
Given a derivation $\vlder{\Phi}{}{\beta}{\alpha}$, consider the derivation
\[
\vlder{\Phi'}
{\SKS\setminus\{\aid,\aiu\}}
{\vls[\beta.\vlinf{\aiu}{}{\fff}{\vls(c_l.\bar c_l)}.\cdots.\vlinf{\aiu}{}{\fff}{\vls(c_1.\bar c_1)}.\vlinf{\aiu}{}{\fff}{\vls(a_n.\bar a_n)}.\cdots.\vlinf{\aiu}{}{\fff}{\vls(a_n.\bar a_n)}.\cdots.\vlinf{\aiu}{}{\fff}{\vls(a_1.\bar a_1)}.\cdots.\vlinf{\aiu}{}{\fff}{\vls(a_1.\bar a_1)}]}
{\vls(\vlinf{\aid}{}{\vls[a_1.\bar a_1]}{\ttt}.\cdots.\vlinf{\aid}{}{\vls[a_1.\bar a_1]}{\ttt}.\cdots.\vlinf{\aid}{}{\vls[a_n.\bar a_n]}{\ttt}.\cdots.\vlinf{\aid}{}{\vls[a_n.\bar a_n]}{\ttt}.\vlinf{\aid}{}{\vls[b_1.\bar b_1]}{\ttt}.\cdots.\vlinf{\aid}{}{\vls[b_k.\bar b_k]}{\ttt}.\alpha)}
\quad,
\]
with the same atomic flow as $\Phi$, which exists by Lemma~\ref{LemDecompInt}, where $a_1,\dots,a_n$ are distinct and pairwise non-dual atoms and $b_1,\dots,b_k$ has no atoms in common with $c_1,\dots,c_l$. A core of $\Phi$, denoted $\Core(\Phi)$, is defined to be any derivation of the form
\[
\Core(\Phi)=\vlderivation
{
 \vlde{\Psi_2}{\{\acd,\med\}}{\vls[\beta.(a_n.{\bar a_n}).\cdots.(a_1.{\bar a_1})]}
 {
  \vlde{\Phi'}{\SKS\setminus\{\aid,\aiu\}}{{\vls[\beta.\vlinf{\aiu}{}{\fff}{\vls(c_l.\bar c_l)}.\cdots.\vlinf{\aiu}{}{\fff}{\vls(c_1.\bar c_1)}.(a_n.\bar a_n).\cdots.(a_n.\bar a_n).\cdots.(a_1.\bar a_1).\cdots.(a_1.\bar a_1)]}}
  {
   \vlde{\Psi_1}{\{\acu,\med\}}{{\vls([a_1.\bar a_1].\cdots.[a_1.\bar a_1].\cdots.[a_n.\bar a_n].\cdots.[a_n.\bar a_n].\vlinf{\aid}{}{\vls[b_1.\bar b_1]}{\ttt}.\cdots.\vlinf{\aid}{}{\vls[b_k.\bar b_k]}{\ttt}.\alpha)}}
   {
    \vlhy{\vls([a_1.{\bar a_1}].\cdots.[a_n.{\bar a_n}].\alpha)}
   }
  }
 }
}\quad,
\]
where $\Psi_1$ and $\Psi_2$ exist by Lemma~\ref{LemGenericContraction}.
\end{defi}

\begin{pro}\label{PropUniqueCore}
Given a derivation $\Phi$ with atomic flow
\[
A=\atomicflow
{
(-21, 8.5)*{\afvjm{9}};
(-13, 8)*{\afaidm{}{}{}{}{}{}};
( -5, 8.5)*{\afvjm{9}};
(-18, 0)*{\affr{8}{8}};
(-16, 2)*{a_1};
( -8, 0)*{\affr{8}{8}};
( -6, 2)*{\bar a_1};
( -5,-8.5)*{\afvjm{9}};
(-13,-8)*{\afaium{}{}{}{}{}{}};
(-21,-8.5)*{\afvjm{9}};
%------------
(0,0)*{\cdots};
%------------
(21, 8.5)*{\afvjm{9}};
(13, 8)*{\afaidm{}{}{}{}{}{}};
( 5, 8.5)*{\afvjm{9}};
( 8, 0)*{\affr{8}{8}};
(10, 2)*{a_n};
(18, 0)*{\affr{8}{8}};
(20, 2)*{\bar a_n};
( 5,-8.5)*{\afvjm{9}};
(13,-8)*{\afaium{}{}{}{}{}{}};
(21,-8.5)*{\afvjm{9}};
%------------
(33, 11)*{\afvjm4};
%---
( 33, 5)*{\affr{18}8};
( 28, 5)*{\copy\contrup};
( 33, 5)*{\copy\weakdown};
( 38, 5)*{\copy\contrdown};
( 48, 5)*{\affr88};
( 48, 5)*{\copy\interdown};
%---
( 28, 0)*{\afvjm2};
( 38, 0)*{\afvjm2};
( 48, 0)*{\afvjm2};
%---
( 28,-5)*{\affr88};
( 28,-5)*{\copy\interup};
( 43,-5)*{\affr{18}8};
( 38,-5)*{\copy\contrup};
( 43,-5)*{\copy\weakup};
( 48,-5)*{\copy\contrdown};
%---
( 43,-11)*{\afvjm4};
}\quad,
\]
the atomic flow associated with $\Core(\Phi)$ is
\[
\Core(A)=
\atomicflow
{
(-21,10)*{\afvjm{12}};
(-17,15)*{\afvj2};
(-17,10)*{\affr{6}{8}};
(-17,10)*{\copy\contrup};
(-17, 5)*{\afvjm{2}};
(-18, 0)*{\affr{8}{8}};
(-16, 2)*{a_1};
(-21,-10)*{\afvjm{12}};
(-17,-15)*{\afvj2};
(-17,-10)*{\affr{6}{8}};
(-17,-10)*{\copy\contrdown};
(-17, -5)*{\afvjm{2}};
%
( -9,15)*{\afvj2};
( -9,10)*{\affr{6}{8}};
( -9,10)*{\copy\contrup};
( -9, 5)*{\afvjm{2}};
( -5,10)*{\afvjm{12}};
( -8, 0)*{\affr{8}{8}};
( -6, 2)*{\bar a_1};
( -9,-15)*{\afvj2};
( -9,-10)*{\affr{6}{8}};
( -9,-10)*{\copy\contrdown};
( -9, -5)*{\afvjm{2}};
( -5,-10)*{\afvjm{12}};
( -8, 0)*{\affr{8}{8}};
%------------
(0,0)*{\cdots};
%------------
( 9,15)*{\afvj2};
( 9,10)*{\affr{6}{8}};
( 9,10)*{\copy\contrup};
( 9, 5)*{\afvjm{2}};
( 5,10)*{\afvjm{12}};
( 8, 0)*{\affr{8}{8}};
(10, 2)*{a_n};
( 9,-15)*{\afvj2};
( 9,-10)*{\affr{6}{8}};
( 9,-10)*{\copy\contrdown};
( 9, -5)*{\afvjm{2}};
( 5,-10)*{\afvjm{12}};
( 8, 0)*{\affr{8}{8}};
%
(21,10)*{\afvjm{12}};
(17,15)*{\afvj2};
(17,10)*{\affr{6}{8}};
(17,10)*{\copy\contrup};
(17, 5)*{\afvjm{2}};
(18, 0)*{\affr{8}{8}};
(20, 2)*{\bar a_n};
(21,-10)*{\afvjm{12}};
(17,-15)*{\afvj2};
(17,-10)*{\affr{6}{8}};
(17,-10)*{\copy\contrdown};
(17, -5)*{\afvjm{2}};
%---------
(33, 12.5)*{\afvjm7};
%---
( 33, 5)*{\affr{18}8};
( 28, 5)*{\copy\contrup};
( 33, 5)*{\copy\weakdown};
( 38, 5)*{\copy\contrdown};
( 48, 5)*{\affr88};
( 48, 5)*{\copy\interdown};
%---
( 28, 0)*{\afvjm2};
( 38, 0)*{\afvjm2};
( 48, 0)*{\afvjm2};
%---
( 28,-5)*{\affr88};
( 28,-5)*{\copy\interup};
( 43,-5)*{\affr{18}8};
( 38,-5)*{\copy\contrup};
( 43,-5)*{\copy\weakup};
( 48,-5)*{\copy\contrdown};
%---
( 43,-12.5)*{\afvjm7};
}\quad,
\]
where the subflow of $A$ labelled $a_i$ (resp., $\bar a_i$) is isomorphic to the sublfow of $\Core(A)$ labelled $a_i$ (resp., $\bar a_i$) for every $1\leq i\leq n$ and the rightmost subflow of $A$ is isomorphic to the rightmost sublfow of $\Core(A)$.
\end{pro}

In other words, $\Core(\Phi)$ is not unique, but the atomic flow associated with it is unique modulo associativity of contraction.

\subsection{The Normaliser}

\newcommand{\Norm}{\mathsf{Norm}}

\begin{defi}
The \emph{normaliser}, $\Norm(\Phi,a_1,\dots,a_n)$, is an operator taking as input a sequence of atoms and a derivation of the form
\[
\vlder{\Phi}{}{\vls[\beta.(a_n.{\bar a_n}).\cdots.(a_1.{\bar a_1})]}{\vls([a_1.{\bar a_1}].\cdots.[a_n.{\bar a_n}].\alpha)}\quad,
\]
where $\alpha$ and $\beta$ are formulae and returning a derivation of the form
\[
\vlder{\Norm(\Phi,a_1,\dots,a_n)}{}{\beta}{\alpha}\quad.
\]

We define $\Norm$ inductively on the number of arguments. Let $\Norm(\Phi)=\Phi$ and for $n>0$ let $\Norm(\Phi,a_1,\dots,a_n)$ be
\newbox\DeltaTopK
\setbox\DeltaTopK=
\hbox{$
\vlderivation
{
 \vlde{\Norm(\Phi,a_1,\dots,a_{n-1})}{}{\vls[\beta.(\vlinf{\awu}{}{\ttt}{a_n}.\bar a_n)]}
 {
  \vlhy{\vls(\vlinf{\aid}{}{\vls[a_n.\bar a_n]}{\ttt}.\alpha)}
 }
}$
}
\newbox\DeltaBotK
\setbox\DeltaBotK=
\hbox{
$\vlderivation
{
 \vlde{\Norm(\Phi,a_1,\dots,a_{n-1})}{}{\vls[\beta.\vlinf{\aiu}{}{\fff}{\vls(a_n.\bar a_n)}]}
 {
  \vlhy{\vls([a_n.\vlinf{\awd}{}{\bar a_n}{\fff}].\alpha)}
 }
}$
}
\newbox\DeltaK
\setbox\DeltaK=
\hbox{$
\vlderivation
{
 \vlde{\Norm(\Phi,a_1,\dots,a_{n-1})}{}{\vls[\beta.(a_n.\vlinf{\awu}{}{\ttt}{\bar a_n})]}
 {
  \vlhy{\vls([\vlinf{\awd}{}{a_n}{\fff}.\bar a_n].\alpha)}
 }
}$
}
\[
\vlderivation
{
 \vlin{\cod}{}{\beta}
 {
  \vlin{\swi}{}{\vls[\vlinf{\cod}{}{\beta}{\vls[\beta.\beta]}.\box\DeltaBotK]}
  {
   \vlin{\swi}{}{\vls([\beta.\box\DeltaK].\alpha)}
   {
    \vlin{\cou}{}{\vls(\box\DeltaTopK.\vlinf{\cou}{}{\vls(\alpha.\alpha)}{\alpha})}
    {
     \vlhy{\alpha}
    }
   }
  }
 }
}\quad.
\]
\end{defi}

\begin{thm}
Given a derivation $\Phi$ from $\alpha$ to $\beta$, where the distinct and non-dual atoms $a_1,\dots,a_n$ and their duals are all the atoms that appear in both interaction and cointeraction instances then $\Norm(\Core(\Phi),a_1,\dots,a_n)$ is weakly streamlined.
\end{thm}

% TODO: check for style

\begin{proof}
We prove the slightly stronger claim: ``$\Norm(\Core(\Phi),a_1,\dots,a_k)$ for $0\leq k \leq n$, is weakly streamlined and $a_i$ does not occur in (co)interaction instances for $k< i \leq n$'', by induction on $k$. The base case, $\Norm(\Core(\Phi))=\Core(\Phi)$, follows by Proposition~\ref{PropUniqueCore}.

Consider the atomic flow associated with $\Norm(\Core(\Phi),a_1,\dots,a_{k-1})$ where the edges mapped to by $a_k$, $\bar a_k$ instances in the premiss and conclusion, but not in $\alpha$ or $\beta$ are singled out. Since, by the inductive hypothesis, $a_k$ does not occur in (co)interaction instances the atomic flow can be represented as follows:

\[
\atomicflow
{
(-8, 6)*{\afvjm{4}};
(-2, 6)*{\afvju{4}{a_k}{}};
( 2, 6)*{\afvju{4}{}{\bar a_k}};
( 8, 6)*{\afvjm{4}};
(-5, 0)*{\affr{8}{8}};
(-3, 2)*{A};
( 5, 0)*{\affr{8}{8}};
( 7, 2)*{B};
( 8,-6)*{\afvjm{4}};
(-2,-6)*{\afvjd{4}{a_k}{}};
( 2,-6)*{\afvjd{4}{}{\bar a_k}};
(-8,-6)*{\afvjm{4}};
}\quad.
\]

Now consider the atomic flow associated with $\Norm(\Core(\Phi),a_1,\dots,a_k)$,
\[
\atomicflow
{
% cocontractions
%  outer
(-13.5,36.5)*{\afacumexsqcol{}{}{}{}{}{}{33}{4}{}{Green}{Green}};
(  2.5,36.5)*{\afacumexsqcol{}{}{}{}{}{}{33}{4}{}{Green}{Green}};
%  inner
( -8, 13)*{\afvjmcol{18}{Green}};
( 14,  0)*{\afvjmcol{44}{Green}};
(  3, 26)*{\afacumnwexsqcol{}{}{}{}{11}{2}{Green}{Green}};
(  8, 13)*{\afvjm{18}};
( 30, 0)*{\afvjmcol{44}{Green}};
( 19, 26)*{\afacumnwexsqcol{}{}{}{}{11}{2}{}{Green}};
% top boxes
(-22, 34)*{\afaidcol{}{}{}{}{}{}{Red}{Red}};
(-27, 26)*{\affr{8}{8}};
(-25, 28)*{A_1};
(-17, 26)*{\affr{8}{8}};
(-15, 28)*{B_1};
(-24, 18)*{\afawucol{}{}{}{}{}{Red}};
( -9, 13)*{\afcjlcol{22}{18}{Red}};
% middle boxes
( -2,  8)*{\afawdcol{}{}{}{}{}{Green}};
(-5, 0)*{\affr{8}{8}};
(-3, 2)*{A_2};
( 5, 0)*{\affr{8}{8}};
( 7, 2)*{B_2};
(  2, -8)*{\afawucol{}{}{}{}{}{Red}};
% bottom boxes
( 22,-34)*{\afaiucol{}{}{}{}{}{}{Green}{Green}};
( 17,-26)*{\affr{8}{8}};
( 19,-24)*{A_3};
( 27,-26)*{\affr{8}{8}};
( 29,-24)*{B_3};
( 24,-18)*{\afawdcol{}{}{}{}{}{Green}};
(  9,-13)*{\afcjlcol{22}{18}{Green}};
% contractions
%  inner
( -8,-12.75)*{\afvjm{17.5}};
(-30,0.25)*{\afvjmcol{43.5}{Red}};
(-19,-27.5)*{\afacdmnwexsqcol{}{}{}{}{11}{2}{Red}{}};
(  8,-12.75)*{\afvjmcol{17.5}{Red}};
(-14,0.25)*{\afvjmcol{43.5}{Red}};
( -3,-27.5)*{\afacdmnwexsqcol{}{}{}{}{11}{2}{Red}{Red}};
%  outer
( 13.5,-36)*{\afacdmexsqcol{}{}{}{}{}{}{33}{4}{Red}{}{Red}};
( -2.5,-36)*{\afacdmexsqcol{}{}{}{}{}{}{33}{4}{Red}{}{Red}};
}\quad,
\]
where $A_1,A_2,A_3$ are isomorphic to $A$ and $B_1,B_2,B_3$ are isomorphic to $B$.

With the assistance of the atomic flow observe the following:
\begin{itemize}
\item If $\epsilon$ is an edge connecting two of $A_1,A_2,A_3,A_4,B_1,B_2,B_3$ or $B_4$ then $a_k$ or $\bar a_k$ maps to $\epsilon$, so since $\Norm(\Core(\Phi),a_1,\dots,a_{k-1})$ is weakly streamlined and contains no (co)interaction instance where $a_k$ or $\bar a_k$ occurs, there is no edge $\epsilon'$ in a path from an interaction vertex to a cointeraction vertex, such that one of $a_1,\dots,a_{n-1}$ maps to $\epsilon'$.
\item None of the edges that could be in a path from the interaction vertex (red) coincide with any of the edges that could be in a path from the cointeraction vertex (green).
\end{itemize}

Since there are no paths from interaction vertices to cointeraction vertices, $\Norm(\Core(\Phi),a_1,\dots,a_k)$ is weakly streamlined. Furthermore, the only atoms which occur in (co)interaction instances in $\Norm(\Core(\Phi),a_1,\dots,a_k)$ which did not in $\Norm(\Core(\Phi),a_1,\dots,a_{k-1})$ are $a_k$ and $\bar a_k$.
\end{proof}

%===========================================

\section{Confluent Cut-elimination}

\begin{rem}\label{RemUglyHack}
The challenge when performing cut-elimination is to deal with the situation where an atom occurs in both interaction and cointeraction instances. Since this is the case we are interested in, we will assume, without loss of generality, that every atom in an $\SKS$ proof occurs in both interaction and cointeraction instances. The assumption should be uncontroversial since any proof $\vlproof{\Phi}{\SKS}{\beta}$ which contains the atom $a$, but $a$ does not occur in both an interaction and a cointeraction instance, we can consider the proof
\[
\vls[(\vlproof{\Phi}{\SKS}{\beta}.\vlinf{\aid}{}{\vls[\vlinf{\awu}{}{\ttt}{a}.\vlinf{\awu}{}{\ttt}{\bar a}]}{\ttt}).\vlinf{\aiu}{}{\fff}{\vls(\vlinf{\awd}{}{a}{\fff}.\vlinf{\awd}{}{\bar a}{\fff})}]
\]
instead.
\end{rem}

The following substitution is at the core of our cut-elimination procedure. It amounts to giving a truth value assignment to an atom. We substitute $a$ with $\fff$ and then implicitly force $\bar a$ to be $\ttt$. The important point to notice here is that this is the most intrusive transformation we will perform and from the point of view of atomic flows it consists of removing the box containing the atom we are substituting.

\begin{defi}
Given a derivation $\vlder{\Phi}{}{\beta}{\alpha}$ and an atom $a$, we define $\vlder{\Phi\{a\ot\fff\}}{}{\beta\{a\ot\fff\}}{\alpha\{a\ot\fff\}}$:
\begin{enumerate}
\item if $\Phi$ is in $\SKS\setminus\{\aid,\aiu\}$, substitute each occurrence of $a$ with $\fff$ and each structural inference rule where $a$ occurred with $=$,
\item otherwise, $\Psi$ exists by Lemma~\ref{LemDecompInt}, so that we can define
\[
\Phi\{a\ot\fff\}=\vlder{\Psi\{a\ot\fff\}}
{\SKS\setminus\{\aid,\aiu\}}
{\vls[\beta\{a\ot\fff\}.\vlinf{\aiu}{}{\fff}{\vls(b_m.\bar b_m)}.\cdots.\vlinf{\aiu}{}{\fff}{\vls(b_{l+1}.\bar b_{l+1})}.(\fff.\bar a).\vldots.(\fff.\bar a)]}
{\vls(\bar a.\vldots.\bar a.\vlinf{\aid}{}{\vls[a_{k+1}.\bar a_{k+1}]}{\ttt}.\cdots.\vlinf{\aid}{}{\vls[a_n.\bar a_n]}{\ttt}.\alpha\{a\ot\fff\})}\quad,
\]
where $a=a_1=\dots=a_k=b_1=\dots=b_l$.
\end{enumerate}
We write $\Phi\{a,b\ot\fff\}$ as a shorthand for $\Phi\{a\ot\fff\}\{b\ot\fff\}$.
\end{defi}

\begin{pro}
Given a derivation $\Phi$ containing an atom $a$, $\Phi\{a\ot\fff\}$ is a valid derivation with a unique atomic flow.
\end{pro}


\newcommand{\Exp}{\mathsf{Exp}}

\begin{defi}\label{DefExperiment}
Given a proof, $\vlproof{\Phi}{\SKS}{\beta}$, where the distinct and non-dual atoms $a_1,\dots,a_n$ and their duals are all the atoms that occur, an \emph{experiment on $\Phi$ with respect to $a_1,\dots,a_n$}, denoted $\Exp(\Phi,a_1,\dots,a_n)$, is defined to be
\[
\vlder{\Phi\{\bar a_1,\dots,\bar a_n\ot\fff\}}{\SKS\setminus\{\aid,\aiu\}}{\vls[\vlder{}{\{\awd\}}{\beta}{\beta\{\bar a_1,\dots,\bar a_n\ot\fff\}}.(\vlinf{\awu}{}{\ttt}{a_1}.\fff).\dots.(\vlinf{\awu}{}{\ttt}{a_1}.\fff).\dots.(\vlinf{\awu}{}{\ttt}{a_n}.\fff).\dots.(\vlinf{\awu}{}{\ttt}{a_n}.\fff)]}{\vls(\vlder{}{\{\acu\}}{\vls(a_1.\dots.a_1)}{a_1}.\dots.\vlder{}{\{\acu\}}{\vls(a_n.\dots.a_n)}{a_n})}\quad.
\]
\end{defi}

Note that Remark~\ref{RemUglyHack} ensures that there is at least one of each of $a_1,\dots,a_n$ in both the premiss and the conclusion of $\Phi\{\bar a_1,\dots,\bar a_n\ot\fff\}$.

\begin{rem}
Given a derivation $\Phi$, there are $2^n$ different ways of choosing $a_1,\dots,a_n$.
\end{rem}

\begin{pro}
Given a proof, $\Phi$, with atomic flow
\[
A=
\atomicflow
{
(-18, 0)*{\affr{8}{8}};
(-16, 2)*{a_1};
(-21,-6)*{\afvjm4};
%
(-13,8)*{\afaidm{}{}{}{}{}{}};
(-13,-8)*{\afaium{}{}{}{}{}{}};
%
( -8, 0)*{\affr{8}{8}};
( -6, 2)*{\bar a_1};
( -5,-6)*{\afvjm4};
%------------
(0,0)*{\cdots};
%------------
( 8, 0)*{\affr{8}{8}};
(10, 2)*{a_n};
( 5,-6)*{\afvjm4};
%
(13,8)*{\afaidm{}{}{}{}{}{}};
(13,-8)*{\afaium{}{}{}{}{}{}};
%
(18, 0)*{\affr{8}{8}};
(20, 2)*{\bar a_n};
(21,-6)*{\afvjm4};
}\quad,
\]
the atomic flow associated with an experiment on $\Phi$ with respect to $a_1,\dots,a_n$ is
\[
\Exp(A)=
\atomicflow
{
( -8,16)*{\afvj4};
( -8,10)*{\affr{8}{8}};
( -8,10)*{\copy\contrup};
( -8, 5)*{\afvjm2};
( -8, 0)*{\affr{8}{8}};
( -6, 2)*{a_1};
(-11,-6)*{\afvjm4};
( -5,-8)*{\afawum{}{}{}{}};
%------------
(0,5)*{\cdots};
%------------
( 8,16)*{\afvj4};
( 8,10)*{\affr{8}{8}};
( 8,10)*{\copy\contrup};
( 8, 5)*{\afvjm2};
( 8, 0)*{\affr{8}{8}};
(10, 2)*{a_n};
( 5,-8)*{\afawum{}{}{}{}};
(11,-6)*{\afvjm4};
%------------
(18,-4)*{\afawdm{}{}{}{\bar a_1}};
%------------
(22,-5)*{\cdots};
%------------
(26,-4)*{\afawdm{}{}{}{\bar a_n}};
}\quad,
\]
where the subflow of $A$ labelled $a_i$ is isomorphic to the subflow of\/ $\Exp(A)$ labelled $a_i$ for every $1\leq i\leq n$.
\end{pro}

In other words, $\Exp(\Phi,a_1,\dots,a_n)$ is not unique, but the atomic flow associated with it is unique modulo associativity of contraction.

\begin{rem}\label{RemExperimentExistence}
The weakening reductions presented in \cite{GuglGund:07:Normalis:lr} gives us another approach to obtaining an experiment on $\Phi$ with respect to $a_1,\dots,a_n$:

Simply consider the derivation
\[
\vlder{\Core(\Phi)}{}{\vls[\beta.\vlinf{\aiu}{}{\fff}{\vls(a_1.\bar a_1)}.\cdots.\vlinf{\aiu}{}{\fff}{\vls(a_n.\bar a_n)}]}{\vls([a_1.\vlinf{\awd}{}{\bar a_1}{\fff}].\cdots.[a_n.\vlinf{\awd}{}{\bar a_n}{\fff}])}\quad,
\]
with atomic flow
\[
\atomicflow
{
(-18,16)*{\afvj4};
(-18,10)*{\affr{8}{8}};
(-18,10)*{\copy\contrup};
(-18, 5)*{\afvjm{2}};
(-18, 0)*{\affr{8}{8}};
(-16, 2)*{a_1};
(-21,-12)*{\afvjm{16}};
(-17,-10)*{\affr{6}{8}};
(-17,-10)*{\copy\contrdown};
(-17, -5)*{\afvjm{2}};
%
(-13,-18)*{\afaiu{}{}{}{}{}{}};
%
( -8,18)*{\afawd{}{}{}{}};
( -8,10)*{\affr{8}{8}};
( -8,10)*{\copy\contrup};
( -8, 5)*{\afvjm{2}};
( -8, 0)*{\affr{8}{8}};
( -6, 2)*{{\bar a}_1};
( -9,-10)*{\affr{6}{8}};
( -9,-10)*{\copy\contrdown};
( -9, -5)*{\afvjm{2}};
( -5,-12)*{\afvjm{16}};
%------------
(0,0)*{\cdots};
%------------
( 8,16)*{\afvj4};
( 8,10)*{\affr{8}{8}};
( 8,10)*{\copy\contrup};
( 8, 5)*{\afvjm{2}};
( 8, 0)*{\affr{8}{8}};
( 6, 2)*{a_n};
( 9,-10)*{\affr{6}{8}};
( 9,-10)*{\copy\contrdown};
( 9, -5)*{\afvjm{2}};
( 5,-12)*{\afvjm{16}};
%
(13,-18)*{\afaiu{}{}{}{}{}{}};
%
(18,18)*{\afawd{}{}{}{}};
(18,10)*{\affr{8}{8}};
(18,10)*{\copy\contrup};
(18, 5)*{\afvjm{2}};
(18, 0)*{\affr{8}{8}};
(16, 2)*{{\bar a}_n};
(21,-12)*{\afvjm{16}};
(17,-10)*{\affr{6}{8}};
(17,-10)*{\copy\contrdown};
(17, -5)*{\afvjm{2}};
}\quad,
\]
and apply weakening reductions until a derivation with the desired atomic flow is obtained.
\end{rem}

% TODO: big remark or section on philosophy
% TODO: remark on symmetry/confluence

\newcommand{\Assignments}{\mathcal A}
\newcommand{\Sym}{\mathsf{Sym}}

\begin{defi}\label{DefSymmetricProof}
Given distinct and pairwise non-dual atoms, $a_1,\dots,a_n$, define
\begin{itemize}
\item the set $\Assignments_k=\{\{b_1,\dots,b_k\}|b_i\in\{a_i,\bar a_i\}\}$ for $1\leq k\leq n$ and
\item a \emph{symmetric proof of }$\bigvee_{\{b_1,\dots,b_k\}\in\Assignments_k}\vlsbr(b_1.\cdots.b_n)$, denoted $\Sym(a_1,\dots,a_k)$, by induction on $k$:

The base case is
\[
\Sym(a_1)=\vlinf{\aid}{}{\vls[a_1.\bar a_1]}{\ttt}\quad,
\]
and the inductive case is
\[
\newbox\DerCap
\setbox\DerCap=
\hbox{$
\vlderivation
{
 \vlde{}{\{\acu,\med\}}{\bigwedge_{i=1}^{2^{k-1}}[b_k.\bar b_k]}
 {
  \vlin{\aid}{}{\vls[b_k.\bar b_k]}
  {
   \vlhy{\ttt}
  }
 }
}$
}
\newbox\DerCap
\setbox\DerCap=
\hbox{$
\vlderivation
{
 \vlde{}{\{\acu,\med\}}{\bigwedge_{i=1}^{2^{k-1}}\vls[b_k.\bar b_k]}
 {
  \vlin{\aid}{}{\vls[b_k.\bar b_k]}
  {
   \vlhy{\ttt}
  }
 }
}$
}
\Sym(a_1,\dots,a_k)\quad=\quad
\vlderivation
{
 \vlin{=}{}{\bigvee_{\{b_1,\dots,b_k\}\in \Assignments_k}\vlsbr(b_1.\cdots.b_k)}
 {
  \vlde{}{\{\swi\}}{\bigvee_{\{b_1,\dots,b_{k-1}\}\in \Assignments_{n-1}}\vlsbr[(b_1.\cdots.b_{k-1}.b_n).(b_1.\cdots.b_{k-1}.\bar b_k)]}
  {
  \vlpr{\Sym(a_1,\dots,a_{k-1})}{\{\aid,\acu,\swi,\med\}}{\vlsbr(\box\DerCap.\bigvee_{\{b_1,\dots,b_{k-1}\}\in \Assignments_{k-1}}(\vlinf{\acu}{}{\vls(b_1.b_1)}{b_1}.\cdots.\vlinf{\acu}{}{\vls(b_{k-1}.b_{k-1})}{b_{k-1}}))}
  }
 }
}\quad,
\]
for $1 < k \leq n$.
\end{itemize}
\end{defi}

\begin{pro}
The atomic flow associated with $\Sym(a_1,\dots,a_n)$ is
\[
\atomicflow
{
(-13, 8)*{\afaid{}{}{}{}{}{}};
(-18, 0)*{\affr{8}{8}};
(-18, 0)*{\copy\contrup};
(-16, 2)*{a_1};
( -8, 0)*{\affr{8}{8}};
( -8, 0)*{\copy\contrup};
( -6, 2)*{\bar a_1};
(-18,-6)*{\afvjm{4}};
( -8,-6)*{\afvjm{4}};
%------------
(0,0)*{\cdots};
%------------
(13, 8)*{\afaid{}{}{}{}{}{}};
( 8, 0)*{\affr{8}{8}};
( 8, 0)*{\copy\contrup};
(10, 2)*{a_n};
(18, 0)*{\affr{8}{8}};
(18, 0)*{\copy\contrup};
(20, 2)*{\bar a_n};
( 8,-6)*{\afvjm{4}};
(18,-6)*{\afvjm{4}};
}\quad.
\]
\end{pro}

In other words, $\Sym(a_1,\dots,a_n)$ is not unique, but the atomic flow associated with it is unique modulo associativity of contraction.

\begin{defi}
Given a proof, $\vlproof{\Phi}{}{\beta}$, where the distinct and non-dual atoms $a_1,\dots,a_n$ and their duals are all the atoms that occur, \emph{a symmetric cut-free proof obtained from $\Phi$} is:
\[
\vlderivation
{
 \vlin{(2^n-1)\times\cod}{}{\beta}
 {
  \vlpr{\Sym(a_1,\dots,a_n)}{\{\aid,\acu,\swi,\med\}}{\bigvee_{\{b_1,\dots,b_n\}\in\Assignments_n}\left(\vlder{\Exp(\Phi,b_1,\dots,b_n)}{\SKS\setminus\{\aid,\aiu\}}{\beta}{\vls(b_1.\cdots.b_n)}\right)}
 }
}\quad.
\]
\end{defi}

\begin{pro}
Given a proof $\Phi$ with atomic flow
\[
A=
\atomicflow
{
(-18, 0)*{\affr{8}{8}};
(-16, 2)*{a_1};
(-21,-6)*{\afvjm4};
%
(-13,8)*{\afaidm{}{}{}{}{}{}};
(-13,-8)*{\afaium{}{}{}{}{}{}};
%
( -8, 0)*{\affr{8}{8}};
( -6, 2)*{\bar a_1};
( -5,-6)*{\afvjm4};
%------------
(0,0)*{\cdots};
%------------
( 8, 0)*{\affr{8}{8}};
(10, 2)*{a_n};
( 5,-6)*{\afvjm4};
%
(13,8)*{\afaidm{}{}{}{}{}{}};
(13,-8)*{\afaium{}{}{}{}{}{}};
%
(18, 0)*{\affr{8}{8}};
(20, 2)*{\bar a_n};
(21,-6)*{\afvjm4};
}\quad,
\]
the atomic flow associated with a symmetric cut-free proof obtained from $\Phi$ is
\[
\atomicflow
{
(-27,18)*{\afaid{}{}{}{}{}{}};
%----
(27,18)*{\afaid{}{}{}{}{}{}};
%--------
(-38,10)*{\affr{20}8};
(-38,10)*{\copy\contrup};
(-16,10)*{\affr{20}8};
(-16,10)*{\copy\contrup};
%----
(16,10)*{\affr{20}8};
(16,10)*{\copy\contrup};
(38,10)*{\affr{20}8};
(38,10)*{\copy\contrup};
%--------
(-44,5)*{\afvjm2};
(-32,5)*{\afvjm2};
(-22,5)*{\afvjm2};
(-10,5)*{\afvjm2};
%----
(10,5)*{\afvjm2};
(22,5)*{\afvjm2};
(33,5)*{\afvjm2};
(44,5)*{\afvjm2};
%--------
(-44,0)*{\affr88};
(-42,2)*{a_1};
(-38,0)*{\vldots};
(-32,0)*{\affr88};
(-30,2)*{a_1};
(-22,0)*{\affr88};
(-20,2)*{\bar a_1};
(-16,0)*{\vldots};
(-10,0)*{\affr88};
(-8,2)*{\bar a_1};
%----
(0,0)*{\vldots};
%----
(10,0)*{\affr88};
(12,2)*{a_n};
(16,0)*{\vldots};
(22,0)*{\affr88};
(24,2)*{a_n};
(32,0)*{\affr88};
(34,2)*{\bar a_n};
(38,0)*{\vldots};
(44,0)*{\affr88};
(46,2)*{\bar a_n};
%--------
(-50,-2)*{\afawdm{}{}{}{}};
(-44,-5)*{\afvjm2};
(-32,-5)*{\afvjm2};
(-22,-5)*{\afvjm2};
(-10,-5)*{\afvjm2};
(-4,-2)*{\afawdm{}{}{}{}};
%----
(4,-2)*{\afawdm{}{}{}{}};
(10,-5)*{\afvjm2};
(22,-5)*{\afvjm2};
(32,-5)*{\afvjm2};
(44,-5)*{\afvjm2};
(50,-2)*{\afawdm{}{}{}{}};
%--------
(-40,-10)*{\affr{24}8};
(-40,-10)*{\copy\contrdown};
(-14,-10)*{\affr{24}8};
(-14,-10)*{\copy\contrdown};
%----
(14,-10)*{\affr{24}8};
(14,-10)*{\copy\contrdown};
(40,-10)*{\affr{24}8};
(40,-10)*{\copy\contrdown};
%--------
(-40,-16)*{\afvjm4};
(-14,-16)*{\afvjm4};
%----
(14,-16)*{\afvjm4};
(40,-16)*{\afvjm4};
}\quad,
\]
where the subflow of the former atomic flow labelled $a_i$ (resp., $\bar a_i$) is isomorphic to the subflow of the latter atomic flow labelled $a_i$ (resp., $\bar a_i$) for every $1\leq i\leq n$ and the subflows labelled with contraction vertices are unique modulo associativity of contraction by Remark~\ref{RemUniquGenContr}.
\end{pro}

%===============================================================================
\section{Conclusion}


\bibliographystyle{alpha}
\bibliography{di-biblio}

\end{document}