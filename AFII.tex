\documentclass[a4paper]{amsart}

\newif\iflmcs\lmcsfalse % <--------------- TOGGLE THIS FOR FINAL VERSION OF LMCS
                        %                  Trash .aux file after toggling
\usepackage{stmaryrd}
\usepackage{graphicx}
\usepackage[lutzsyntax]{virginialake}\vlsmallbrackets\aftrianglefalse
\iflmcs\def\url #1#2{\relax}\else\usepackage{hyperref}\fi

%--------- Theorem etc
\newtheorem{thm}{Theorem}[section]
\newtheorem{cor}[thm]{Corollary}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{pro}[thm]{Proposition}

\theoremstyle{remark}
\newtheorem{rem}[thm]{Remark}

\theoremstyle{definition}
\newtheorem{defi}[thm]{Definition}
%---------

%-------------------------------------------------------- REMOVE WHEN PAPER DONE
\newcommand{\Ale}[1]{{\color{NavyBlue}\noindent {\bf A:} #1}}
\newcommand{\Tom}[1]{{\color{PineGreen}\noindent {\bf T:} #1}}
\newcount\todocount\todocount=0
\newcommand{\TODO}[1]{\global\advance\todocount by1%
            {\color{Red}\noindent{\bf\the\todocount\ TODO:} #1}}\vlupdate{\TODO}
%\renewcommand{\Ale}[1]{\relax}  % Comment/uncomment these three lines
%\renewcommand{\Tom}[1]{\relax}  % in order to display/hide inline comments
%\renewcommand{\TODO}[1]{\relax} %
%-------------------------------------------------------- REMOVE WHEN PAPER DONE

\begin{document}

\title[Normalisation Control in Deep Inference   via Atomic Flows II]
      {Normalisation Control in Deep Inference\\ via Atomic Flows II}

\author{Alessio Guglielmi}
\address{University of Bath, Bath BA2 7AY, UK}

\author{Tom Gundersen}
\iflmcs\address{University of Bath, Bath BA2 7AY, UK}\fi

\thanks{This work was in part funded by an Overseas Research Scholarship and a Research Studentship, both from the University of Bath, and by the British Council Alliance Programme.}

\keywords{Normalisation, deep inference, cut elimination, atomic flows}

\subjclass{F.4.1 Mathematical Logic---Proof theory}

\begin{abstract}
\end{abstract}

\maketitle

%===============================================================================
\section{Introduction}
\newcommand{\ot}{\mathbin\shortleftarrow}
\newcommand{\fff}{\mathsf f}
\newcommand{\ttt}{\mathsf t}
\newcommand{\ai}{\mathsf{ai}}
\newcommand{\aw}{\mathsf{aw}}
\newcommand{\ac}{\mathsf{ac}}
\newcommand{\aid}{{\ai{\downarrow}}}
\newcommand{\awd}{{\aw{\downarrow}}}
\newcommand{\acd}{{\ac{\downarrow}}}
\newcommand{\aiu}{{\ai{\uparrow}}}
\newcommand{\awu}{{\aw{\uparrow}}}
\newcommand{\acu}{{\ac{\uparrow}}}
\newcommand{\swi}{\mathsf{s}}
\newcommand{\med}{\mathsf{m}}
\newcommand{\sus}{\mathsf{ss}}
\newcommand{\said}{\mathsf{s}\aid}
\newcommand{\contr}{\mathsf{c}}
\newcommand{\cod}{{\contr{\downarrow}}}
\newcommand{\cou}{{\contr{\uparrow}}}
\newcommand{\SKS}{\mathsf{SKS}}
\newcommand{\ppl  }{{\mathchoice{\scriptstyle+}
                                {\scriptstyle+}
                                {\scriptstyle+}
                                {\scriptscriptstyle+}}}
\newcommand{\pmi  }{{\mathchoice{\scriptstyle-}
                                {\scriptstyle-}
                                {\scriptstyle-}
                                {\scriptscriptstyle-}}}

In \cite{GuglGund:07:Normalis:lr} we introduced \emph{atomic flows} as a tool to study normalisation. In this paper we focus on global normalisation procedures and show how they provide for more general and principled tools than what we studied before. The paper is inn two parts, the first part gives a \emph{confluent} cut-elimination procedure for propositional classical logic and the second part gives a generalisation of the \emph{streamlinig} procedure described in \cite{GuglGund:07:Normalis:lr}.

Atomic flows are graphical representations of derivations conserving their size as well as the causal relationship between the structural inference rules. All information about logical connectives and logical inference rules are disregarded. The crucial property of atomic flows is that they contain all the information necessary to perform normalisation. We can either just normalise the atomic flows, or use the atomic flows to decide how to normalise the derivations.

A streamlined derivation is a derivation whose atomic flow has a speciﬁc shape, in particular this shape entails that

\begin{enumerate}
\item a streamlined derivation contains no causal relationship between an axiom and a cut; and
\item in the special case where the premiss of a streamlined derivation is $\ttt$, the derivation is cut-free.
\end{enumerate}

Given the atomic flow of a derivation we can tell what the atomic flow of the streamlined derivation would be. This is of particular interest because the atomic flows do not have access to any information about logical inference rules, which are usually considered to be important in performing cut-elimination.

The novelty of this work is to only use global proof transformations when performing normalisation. We single out axioms and cuts and consider the rest of the atomic flow to be inside ``black boxes'' which we do not need to look inside. Then by knowing which axioms are connected with which cuts we can normalise the derivation without having any more information about its internal structure. The streamlining procedures presented in \cite{GuglGund:07:Normalis:lr} had two sources of exponential growth, it was not strongly normalising and the proof of termination was not very intuitive. With the new methods we have removed one source of exponential growth and both termination and strong normalisation are immediate.

\section{Deep Inference and Atomic Flows}

Deep inference is a relatively new proof-theoretic methodology developed over the past ten years. Deep inference differs from the traditional Gentzen-style methodologies in that it allows inference at any level of formulae, not only at the root connective. This allows for much greater freedom in designing formalisms and logical systems, but it also makes normalisation theory much more challenging.

In this paper we are working in the deep-inference formalism calculus of structures\cite{Gugl:06:A-System:kl}, but the results here are not specific to this formalism as we will discuss later.

The system we use for propositional classical logic is system $\SKS$\cite{BrunTiu:01:A-Local-:mz}:

\begin{figure}[h]
\begin{center}
\begin{tabular}{ccc}
$\vlinf{\aid}{}{\vls[a.\bar{a}]}{\ttt}$ & $\vlinf{\acd}{}{a}{\vls[a.a]}$ & $\vlinf{\awd}{}{a}{\fff}$ \\
interaction (axiom) & contraction & weakening \\
$\vlinf{\aiu}{}{\fff}{\vls(\bar{a}.a)}$ & $\vlinf{\acu}{}{\vls(a.a)}{a}$ & $\vlinf{\awd}{}{\ttt}{a}$ \\
cointeraction (cut) & cocontraction & coweakening
\end{tabular}
\begin{tabular}{cc}
$\vlinf{\swi}{}{\vls([\alpha.\beta].\gamma)}{\vls[\alpha.(\beta.\gamma)]}$ & $\vlinf{\med}{}{\vls([\alpha.\beta].[\gamma.\delta])}{\vls[(\alpha.\gamma).(\beta.\delta)]}$ \\
switch & medial
\end{tabular}
\end{center}
\end{figure}

Furmulae are considered equal modulo associativity and commutativity of $\wedge$ and $\vee$; and idempotency and identity of $\ttt$ and $\fff$. Furthermore, negation is only allowed on atoms which is possible due to DeMorgan's Laws.

In this paper we will mainly concern ourselves with the structural rules.
%===============================================================================
\section{Confluent Cut-Elimination For Proofs}

In this section we describe a confluent cut-elimination procedure using atomic flows. It is confluent in the sense that given the atomic flow of any proof, the atomic flow of the resulting cut-free proof is unique.

Take any proof with cuts, if we know the truth value of the atoms involved in the cuts we can eliminate the cuts to obtain a smaller derivation. In other words given $\vlproof{}{\SKS}{\alpha}$ we can obtain $\vlder{}{\SKS\setminus\{\aid\}}{\alpha}{\gamma}$ where $\gamma$ is a truth value assignment represented as the conjunction of atoms or their negations. Obviously we want a proof for all truth value assignments, and not just one. Since there is a finite number of possible truth value assignments and we can construct one derivation for each one. We can therefore plug all these derivaitons together in a big disjunction and obtain a proof $\vlproof{}{\SKS\setminus\{\aid\}}{\alpha}$ as desired.

Each of the derivaitons obtained as described above, are a special case of what we call \emph{experiments}, we will now give their formal definition.

\begin{defi}\label{DefExperiment}
Given a derivation $\Phi$ from $\alpha$ to $\beta$ with atomic flow $C$, a polarity assignment $\pi$ to $C$ and a derivation $\Phi'$ from $\vls(\alpha'.\gamma)$ to $\vls[\beta'.\delta]$ with atomic flow $C'$, together with a subflow $B$ of $C$ as indicated in the diagram below
\begin{center}
\begin{tabular}{ccc}
$\vlder{\Phi}{}{\beta}{\alpha}$ & $\qquad\rightarrow\qquad$ &
$
C=\atomicflow{
%boxes
(-13,0)*{\affr{24}{8}};
(13,0)*{\affr{24}{8}};
%top edges
(-24,9)*{\afvj{10}};
(-22,9)*{\cdots};
(-20,9)*{\afvj{10}};
(20,9)*{\afvj{10}};
(22,9)*{\cdots};
(24,9)*{\afvj{10}};
%axioms
(0,8)*{\afaid{}{\ppl}{\pmi}{}{}{}};
(-4,6)*{\cdots};
(4,6)*{\cdots};
(0,10)*{\afaidex{}{\ppl}{\pmi}{}{}{}{3}{1}};
(-6,5)*{\afvj{2}};
(6,5)*{\afvj{2}};
(0,12)*{\afaidex{}{\pmi}{\ppl}{}{}{}{5}{1}};
(-10,6)*{\afvj{4}};
(10,6)*{\afvj{4}};
(-12,8)*{\cdots};
(12,8)*{\cdots};
(0,14)*{\afaidex{}{\pmi}{\ppl}{}{}{}{7}{1}};
(-14,7)*{\afvj{6}};
(14,7)*{\afvj{6}};
%bottom edges
(-24,-9)*{\afvj{10}};
(-22,-9)*{\cdots};
(-20,-9)*{\afvj{10}};
(20,-9)*{\afvj{10}};
(22,-9)*{\cdots};
(24,-9)*{\afvj{10}};
%cuts
(0,-8)*{\afaiu{}{\ppl}{\pmi}{}{}{}};
(-4,-6)*{\cdots};
(4,-6)*{\cdots};
(0,-10)*{\afaiuex{}{\ppl}{\pmi}{}{}{}{3}{1}};
(-6,-5)*{\afvj{2}};
(6,-5)*{\afvj{2}};
(0,-12)*{\afaiuex{}{\pmi}{\ppl}{}{}{}{5}{1}};
(-10,-6)*{\afvj{4}};
(10,-6)*{\afvj{4}};
(-12,-8)*{\cdots};
(12,-8)*{\cdots};
(0,-14)*{\afaiuex{}{\pmi}{\ppl}{}{}{}{7}{1}};
(-14,-7)*{\afvj{6}};
(14,-7)*{\afvj{6}};
%labels
(-4,2)*{A};
(22,2)*{B};
}
$ \\
                                &                           & $\downarrow$ \\
$\vlder{\Phi'}{}{\vls[\beta'.\delta]}{\vls(\alpha'.\gamma)}$ & $\rightarrow$ &
$
C'=\atomicflow{
%boxes
(-13,0)*{\affr{24}{8}};
%top edges
(-24,6)*{\afvj{4}};
(-22,6)*{\cdots};
(-20,6)*{\afvj{4}};
%axioms
(-2,8)*{\afawd{}{}{}{}};
(-4,6)*{\cdots};
(-6,8)*{\afawd{}{}{}{}};
(-10,6)*{\afvj{4}};
(-12,6)*{\cdots};
(-14,6)*{\afvj{4}};
%bottom edges
(-24,-6)*{\afvj{4}};
(-22,-6)*{\cdots};
(-20,-6)*{\afvj{4}};
%cuts
(-2,-6)*{\afvj{4}};
(-4,-6)*{\cdots};
(-6,-6)*{\afvj{4}};
(-10,-8)*{\afawu{}{}{}{}};
(-12,-6)*{\cdots};
(-14,-8)*{\afawu{}{}{}{}};
%labels
(-4,2)*{A};
}\quad,
$\\
\end{tabular}
\end{center}
we say that
\begin{itemize}
\item $C'$ is an \emph{experiment on $C$ with respect to $B$ under $\pi$}; and
\item $\Phi'$ is an \emph{experiment on $\Phi$ with respect to $B$ under $\pi$} if
\begin{itemize}
 \item $\alpha'$ and $\beta'$ are obtained from $\alpha$ and $\beta$ respectively by substituting all the atoms mapping to positive (resp.\ negative) edges of $B$ with $\ttt$ (resp.\ $\fff$); and
 \item $\gamma$ (resp.\ $\delta$) is a conjuncton (resp.\ disjunction) of all the atoms mapping to top (resp.\ bottom) edges in $C'$, but not in $C$.
% TODO define ``top edge'' and ``bottom edge''
% \item $\gamma$ (resp.\ $\delta$) is a conjunction (resp.\ disjunction) of all the atoms mapping to edges adjacent to $\top$ (resp.\ $\bot$) in $C'$, but not in $C$.
\end{itemize}
\end{itemize}
\end{defi}

\begin{defi}
Given a derivation $\Phi$ with atomic flow $C$ as in Definition~\ref{DefExperiment}. The (co)interaction nodes in $C$ which are not in $A$ nor $B$ we call \emph{evidenced (co)interaction nodes} and the inference rules corresponding to evidenced nodes we call \emph{evidenced (co)interaction rulse}.
\end{defi}


Given an atomic flow $C$ as described above, it is obvious that we can create the atomic flow $C'$. We now need to show that we can always obtain the corresponding derivation $\Phi'$, so in this sense making experiments is a ``sound'' operation.

\begin{lem}
Given any derivation $\Phi$ with atomic flow $C$, an atomic subflow $B$ of $C$ and a polarity assignment $\pi$, such that there exists an experiment on $C$ with respect to $B$ under $\pi$ then there exists a derivation $\Phi'$ such that $\Phi'$ is an experiment on $\Phi$ with respect to $B$ under $\pi$.
\end{lem}
\begin{proof}
Let $\Phi$ have premiss $\alpha$ and conclusion $\beta$, let $C'$ be an experiment on $C$ and let $\alpha'$, $\beta'$, $\xi'$ and $\zeta'$ denote the formulae obtained from $\alpha$, $\beta$, $\xi$ and $\zeta$ by substituting atoms mapping to positive (resp.\ negative) edges which occur in $C$ but not in $C'$ with $\ttt$ (resp.\ $\fff$).

We then obtain $\Phi'$ from $\Phi$ by substituting each formula $\xi$ with $\vls[(\xi'.\gamma_i).\delta_j]$; where $i$ (resp.\ $j$) is the number of evidenced interactions (resp.\ cointeractions) below (resp.\ above) $\xi$ in $\Phi$ such that the edge connecting the corresponding node to $A$ is positive (resp.\ negative) under $\pi$, $\gamma_0=\ttt$, $\gamma_{i}=\vls(\gamma_{i-1}.a_i)$, $\delta_0=\fff$ and $\delta_{j}=\vls[\delta_{j-1}.a_j]$; where $a_i$ (resp.\ $a_j$) is the atom, mapping to a positive edge, taking part in interaction (resp.\ cointeraction) number $i$ (resp.\ $j$) from the top (resp.\ bottom) in $\Phi$.

It is now straight forward to check that the following substitutions of inference rules gives a derivation with the right atomic flow:
\begin{itemize}
 \item Let $\vlinf{\rho}{}{\zeta}{\xi}$ be a linear inference rule or a structural inference rule mapping to a node in $A$, then it is substituted with $\vlinf{\rho}{}{\vls[(\zeta'.\gamma_i).\delta_j]}{\vls[(\xi'.\gamma_i).\delta_j]}$;
 \item let $\vlinf{\rho}{}{\zeta}{\xi}$ be a structural inference rule mapping to a node in $B$, then it is substituted with $\vlinf{=}{}{\vls[(\zeta'.\gamma_i).\delta_j]}{\vls[(\xi'.\gamma_i).\delta_j]}$\footnote{we might need a special case for $\vlinf{\rho}{}{\xi'\{\ttt\}}{\xi'\{\fff\}}$ where $\rho\in\{\awd,\awu\}$};
 \item let $\vlinf{\aid}{}{\xi\{\vls[a^\ppl.{\bar a}^\pmi]\}}{\xi\{\ttt\}}$ be an evidenced interaction rule, then if the edge connecting the node to $A$ is positive under $\pi$ it is substituted with $\vlinf{\sus}{}{\vls[(\xi'\{\vls[a^\ppl.\fff]\}.\gamma_i).\delta_j]}{\vls[(\xi'\{\ttt\}.\gamma_{i+1}).\delta_j]}$ otherwise it is substituted with $\vlinf{\awd}{}{\vls[(\xi'\{\vls[\ttt.{\bar a}^\pmi]\}.\gamma_i).\delta_j]}{\vls[(\xi'\{\ttt\}.\gamma_i).\delta_j]}$; and
 \item let $\vlinf{\aiu}{}{\xi\{\fff\}}{\xi\{\vls(a^\ppl.{\bar a}^\pmi)\}}$ be an evidenced cointeraction rule, then if the edge connecting the node to $A$ is negative under $\pi$ it is substituted with $\vlinf{\sus}{}{\vls[(\xi'\{\fff\}.\gamma_i).\delta_{j+1}]}{\vls[(\xi'\{\vls(\ttt.{\bar a}^\pmi)\}.\gamma_i).\delta_j]}$ otherwise it is substituted with $\vlinf{\awd}{}{\vls[(\xi'\{\vls[\ttt.{\bar a}^\pmi]\}.\gamma_i).\delta_j]}{\vls[(\xi'\{\ttt\}.\gamma_i).\delta_j]}$\footnote{note that there is no correspondence between negative and positive atoms and negative and positive polarities, the roles could be reversed. Alternatively we could do this without showing the atoms, but that might be too obfuscated?}.
\end{itemize}
The derivation $\Phi'$ we have obtained is a derivation from $\vls[(\alpha'.\gamma_k).\delta_0]$ to $\vls[(\beta'.\gamma_0).\delta_l]$ for some $k,l$, notice that $\gamma_0=\ttt$ and $\delta_0=\fff$, so we get $\Phi'$ from $\vls(\alpha'.\gamma_k)$ to $\vls[\beta'.\delta_l]$ as we want.
\end{proof}

When performing cut-elimination the experiments we need are of a specific form; we need to preserve the conclusion, so we cannot create any new bottom edges. This is the motivation for the following definition.

\begin{defi}
Let $C$ be an atomic flow and $\pi$ a polarity assignment to $C$. If $B$ is the subflow of $C$ containing only negative (resp.\ positive) nodes and $A$ is the subflow of $C$ containing only positive (resp.\ negative) nodes, then the experiment on $C$ with respect to $B$ under $\pi$ is called the \emph{$\fff$-experiment (resp.\ $\ttt$-experiment) on $C$ under $\pi$}. The definition extends to derivations in the obvious way.
\end{defi}

We now observe that an $\fff$-experiment indeed gives us the what we want. The observant reader might note that instead of the original conclusion, $\beta$, we get $\beta'$, which in this case is $\beta$ with some atom occurences substituted with $\fff$, as we shall se later, this is not a problem. We could indeed fix this straight away by applying $\awd$'s.

\begin{pro}\label{PropExperimentShapeBot}
For any proof\/ $\vlproof{\Pi}{\SKS}{\beta}$ and any polarity assignment to its atomic  flow, $\pi$, the $\fff$-experiment on $\Pi$ under $\pi$ is of the form $\vlder{}{\SKS\setminus\{\aid,\aiu\}}{\beta'}{\gamma}$. Where $\beta'$ and $\gamma$ are given by Definition~\ref{DefExperiment}.
\end{pro}

We have seen how we can generate one derivation for each polarity assignment, now we will see how we can glue all of them together to obtain the cut-free proof.

The disjunction of all the possible truth value assignments is obviously a tautology. We now show that we can construct a \emph{canonical} proof of this tautology. By ``canonical'' we mean that we can do it in such a way that there is no arbitrary choice involved. In particular this entails that the atomic flow of all the different atoms will be the same.

\begin{lem}\label{LemGlueTop}
Let $\Pi$ be a proof, let $\mathcal{P}$ be the set of all the polarity assignments to the atomic flow of $\Pi$ and for each $\pi\in\mathcal{P}$ let the $\fff$-experiment on $\Pi$ under $\pi$ have premiss $\gamma_\pi$. Then there exist \emph{canonical} proofs $\vlproof{}{\{\aid,\acu,\swi,\med\}}{\bigvee_{\pi\in\mathcal{P}}\gamma_\pi}$ and $\vlproof{}{\{\aid,\acd,\swi,\med\}}{\bigvee_{\pi\in\mathcal{P}}\gamma_\pi}$ of size $O(|\mathcal{P}|)$.
\end{lem}

\begin{proof}
Enumerate the atoms occurring in $\gamma_\pi$ for any $\pi$: $a_1,\dots,a_n$. Let $\pi_i$ be $\pi_{i+1}$ restricted to the subflow mapped to by $a_1,\dots,a_i$, let $\mathcal{P}_i$ be the set of all the possible $\pi_i$ and let $\gamma_{\pi_i}=\gamma_\pi\{a_{i+1}\leftarrow\ttt,\dots,a_n\leftarrow\ttt\}$.

We induct on $i$. The base case is trivial:
\[
\vlinf{=}{}{\bigvee_{\pi\in\mathcal{P}_{0}}\gamma_\pi}{\ttt}
\]


The inductive case is:

\[
\vlderivation
{
\vlin{=}{}{\bigvee_{\pi\in\mathcal{P}_{i+1}}\gamma_\pi}
 {
 \vlde{}{\{\swi\}}{\bigvee_{\pi\in\mathcal{P}_i}\vls[(\gamma_\pi.a_{i+1}).(\gamma_\pi.\bar{a}_{i+1})]}
  {
  \vlde{}{\{\med,\acu\}}{\vls(\bigvee_{\pi\in\mathcal{P}_i}\vlsbr(\gamma_\pi.\gamma_\pi).\bigwedge_{\pi\in\mathcal{P}_i}\vlsbr[a_{i+1}.\bar{a}_{i+1}])}
   {
   \vlin{\aid}{}{\vls(\bigvee_{\pi\in\mathcal{P}_i}\gamma_\pi.\vlsbr[a_{i+1}.\bar{a}_{i+1}])}
    {
    \vlpr{IH}{\{\aid,\acu,\swi,\med\}}{\bigvee_{\pi\in\mathcal{P}_i}\gamma_\pi}
    }
   }
  }
 }
}
\]

Notice that there is the same number of occurances of each atom and that the atomic flow of each atom only contains one axiom, so the number of cocontractions must be the same. Hence the atomic flow of each of the atoms are the same modulo associativity of (co)contraction; and in this sense the proofs are canonical.
\end{proof}

\begin{lem}\label{LemGlueBottom}
Let $\Phi$ be a derivation from $\alpha$ to $\beta$, let $\mathcal{P}$ be the set of all the polarity assignments to the atomic flow of $\Phi$ and for each $\pi\in\mathcal{P}$ let the $\fff$-experiment on $\Phi$ under $\pi$ have conclusion $\beta_\pi$. Then there exists a derivation $\vlder{}{\{\acd,\med\}}{\beta}{\bigvee_{\pi\in\mathcal{P}}\beta_\pi}$.
\end{lem}

\begin{proof}
It is trivial to observe that there exists
\[
\vlderivation{
\vlde{}{\{\acd,\med\}}{\beta}
 {
  \vlde{}{\{\awd\}}{\bigvee_{\pi\in\mathcal{P}}\beta}
  {
   \vlhy{\bigvee_{\pi\in\mathcal{P}}\beta_\pi}
  }
 }
}
\]
Furthermore, observe that there is a path from every atom occurance in the conclusion to an atom occurence in the premise. Hence, all the $\awd$ rules are eliminate by applying weakening reductions to the derivaiton, giving us $\vlder{}{\{\acd,\med\}}{\beta}{\bigvee_{\pi\in\mathcal{P}}\beta_\pi}$ as required.
\end{proof}


\begin{thm}
Given a proof $\vlproof{\Pi}{\SKS}{\beta}$ there exists a canonical cut-free proof $\vlproof{}{\SKS\setminus\{\aiu\}}{\beta}$.
\end{thm}
\begin{proof}
Let $\mathcal{P}$ be the set of all the polarity assignments to the atomic flow of $\Pi$ and for each $\pi\in\mathcal{P}$ let the experiment on $\Pi$ under $\pi$ be $\vlder{\Pi_\pi}{\SKS\setminus\{\aid,\aiu\}}{\beta_\pi}{\gamma_\pi}$. Then by Lemma~\ref{LemGlueTop} and Lemma~\ref{LemGlueBottom} we can build the following proof:
\[
\vlderivation{
\vlde{}{\{\acd,\med\}}{\beta                                  } {
\vlde{\bigvee_{\pi\in\mathcal{P}}\Pi_\pi}
       {\SKS\setminus\{\aid,\aiu\}}{\bigvee_{\pi\in\mathcal{P}}\beta_\pi}{
\vlpr{}{\{\aid,\acu,\swi\}}{\bigvee_{\pi\in\mathcal{P}}\gamma_\pi       }}}
}\quad.
\]
There is only one way of building such a proof in the sense that the atomic flow of the proof will be unique (modulo associativity of contraction).
\end{proof}

%%===============================================================================
%\section{Interpolation}

%\begin{defi}\label{DefExperiment2}
%Let $\vlder{\Psi}{\{\aid,\aiu,\swi,\med\}}{\beta}{\alpha}$ be a streamlined derivation, then we call $\vlder{\Psi_p}{\{\aid,\aiu,\swi,\med\}}{\beta_p}{\alpha_p}$ an \emph{experiment on $\Psi$ under polarity assignment $\pi_p$ with respect to atomic flow $A$} if $\Psi_p$ is obtained from $\Psi$ by
%\begin{itemize}
%\item replacing each $\vlinf{\aid}{}{\xi\{\vls[a_i^\ppl.{\bar a_i^\pmi}]\}}{\xi\{\ttt\}}$ mapping to a node in $A$ by $\vlinf{=}{}{\xi_p\vlsbr[\ttt.\fff]}{\xi_p\{\ttt\}}$, for some $0 \leq i \leq n$;
%\item replacing each $\vlinf{\aiu}{}{\xi\{\fff\}}{\xi\{\vls(a_i^\ppl.{\bar a_i^\pmi})\}}$ mapping to a node in $A$ by $\vlinf{=}{}{\xi_p\{\fff\}}{\xi_p\vlsbr(\ttt.\fff)}$, for some $0 \leq i \leq n$; and
%\item replacing each other rule instance $\vlinf{\rho}{}{\xi}{\zeta}$ by $\vlinf{\rho}{}{\xi_p}{\zeta_p}$,
%\end{itemize}
%where $\rho\in\{\swi,\med\}$ and $\alpha_p,\beta_p,\xi_p,\zeta_p$ denote the formulae obtained from $\alpha,\beta,\xi,\zeta$, respectively, by replacing atom occurrences mapped to edges of $A$. Atoms mapping to positive (resp.\ negative) edges under $\pi_p$ are replaced with $\ttt$ (resp.\ $\fff$).
%\end{defi}

%\begin{rem}
%If we define a $\top$-experiment to be the dual of a $\bot$-experiment in the usual way, then an \emph{experiment} on $\Psi$ is exactly a $\top$-experiment on a $\bot$-experiment on $\Psi$ (or the other way around) (under the same polarity assignment, with respect to the same atomic flow).
%\end{rem}

%\begin{pro}
%If $\Psi_p$ is an experiment on $\Psi$ with respect to the atomic flow containing all the $\aid$ nodes of $\Psi$, then $\Psi_p$ is a valid derivation.
%\end{pro}

%\begin{pro}\label{PropExperimentShape}
%An experiment under polarity assignment $\pi_p$ on a streamlined derivation\/ $\vlder{\Psi}{\{\aid,\aiu,\swi,\med\}}{\beta}{\alpha}$ with respect to an atomic flow containing all the $\aid$ nodes of $\Psi$ is of the form $\vlder{}{\{\aiu,\swi,\med\}}{\beta_p}{\alpha}$. Where $\beta_p$ is given by Definition~\ref{DefExperiment2}.
%\end{pro}

%\begin{lem}\label{LemGlue}
%Given a derivation $\vlder{\Psi}{}{\beta}{\alpha}\ $, and all the experiments on $\Pi$ with respect to a given atomic flow there exists a derivation $\vlder{}{\{\aid,\swi\}}{\bigvee_{p=1}^{2^n}\beta_p^\bot}{\bigwedge_{p=1}^{2^n}\beta_p}$, where $\beta^\bot_p$ is given by Definition~\ref{DefExperiment}.
%\end{lem}

%\begin{lem}\label{LemInterpolant}
%Given a streamlined derivation of the form
%\[
%\vlder{\Psi}{\{\aid,\aiu,\swi,\med\}}{\beta}{\alpha}
%\]
%there is a derivation, $\Psi'$, of the form
%\[
%\vlderivation{
%\vlde{}{\{\aid,\acd,\swi,\med\}}{\beta} {
%\vlde{}{\{\aiu,\acu,\swi,\med\}}{\gamma}{
%\vlhy{\alpha}}}
%}
%\]
%\end{lem}

%\begin{proof}
%Consider all the experiments on $\Psi$; $\Psi_1,\dots,\Psi_{2^n}$. Using these derivations and Lemma~\ref{LemGlueBottom} and Lemma~\ref{LemGlue} we can build:
%\[
%\vlderivation{
%\vlde{}{\{\acd,\med\}}     {\beta                          }   {
%\vlde{}{\{\aid,\swi\}}     {\bigvee_{p=1}^{2^n}\beta^\bot_p}  {
%\vlde{\bigwedge_{p=1}^{2^n}\Psi_p}{\{\aiu,\swi,\med\}}
%                           {\bigwedge_{p=1}^{2^n}\beta_p   } {
%\vlde{}{\{\acu,\med\}}     {\bigwedge_{p=1}^{2^n}\alpha    }{
%\vlhy                      {\alpha                         }}}}}
%}\quad,
%\]
%Where $\gamma=\bigwedge_{p=1}^{2^n}\beta_p$.
%\end{proof}

%\begin{pro}
%If there exists a derivation like $\Psi'$ in Lemma~\ref{LemInterpolant}, then $\gamma$ is an interpolant of $\alpha$ and $\beta$.
%\end{pro}

%===============================================================================
\section{Streamlining}

The idea behind the streamlining procedures we show here is to substitute units in place of atoms to eliminate axiom-cut pairs. These kind of substitutions are only possible if we can find ``closed'' subflows which are not connected to the premiss nor conclusion of the derivation.

We first show how we can always \emph{prenormalise} a derivation, this takes a derivation and splits it in two parts one which is streamlined and one which is not directly connected to the premiss nor the conclusion. We then show how to streamline the latter part of the atomic flow.

\begin{defi}
An atomic flow with the following shape under polarity assignment $\pi$ is said to be \emph{$\ppl$-prenormalised under $\pi$}
\[
\atomicflow{
%boxes
(-20,8)*{\affr{14}{8}};
(-15,10)*{\ppl};
(-20,-8)*{\affr{14}{8}};
(-15,-6)*{\ppl};
(-28,20)*{\affr{14}{8}};
(-23,22)*{\ppl};
(-28,-20)*{\affr{14}{8}};
(-23,-18)*{\ppl};
(0,0)*{\affr{22}{8}};
(9,2)*{\pmi};
(16,0)*{\affr{6}{8}};
(17,2)*{\ppl};
%axioms
(6,5)*{\afvj{2}};
(8,6)*{\cdots};
(12,8)*{\afaid{}{}{}{}{}{}};
(12,10)*{\afaidex{}{}{}{}{}{}{3}{1}};
(16,6)*{\cdots};
(18,5)*{\afvj{2}};
%
(-12,16)*{\afaid{}{}{}{}{}{}};
(-18,13)*{\afvj{2}};
(-16,14)*{\cdots};
(-8,10)*{\cdots};
(-12,18)*{\afaidex{}{}{}{}{}{}{3}{1}};
(-10,8)*{\afvj{8}};
(-6,9)*{\afvj{10}};
%cuts
(6,-5)*{\afvj{2}};
(8,-6)*{\cdots};
(12,-8)*{\afaiu{}{}{}{}{}{}};
(12,-10)*{\afaiuex{}{}{}{}{}{}{3}{1}};
(16,-6)*{\cdots};
(18,-5)*{\afvj{2}};
%
(-12,-16)*{\afaiu{}{}{}{}{}{}};
(-18,-13)*{\afvj{2}};
(-16,-14)*{\cdots};
(-8,-10)*{\cdots};
(-12,-18)*{\afaiuex{}{}{}{}{}{}{3}{1}};
(-10,-8)*{\afvj{8}};
(-6,-9)*{\afvj{10}};
%top edges
(-2,16)*{\afvj{24}};
(0,16)*{\cdots};
(2,16)*{\afvj{24}};
(-26,14)*{\afvj{4}};
(-24,14)*{\cdots};
(-22,14)*{\afvj{4}};
(-24,0)*{\afcjl{12}{8}};
(-28,0)*{\afcjl{12}{8}};
(-34,10)*{\afvj{12}};
(-32,6)*{\cdots};
(-30,10)*{\afvj{12}};
(-30,26)*{\afvj{4}};
(-28,26)*{\cdots};
(-26,26)*{\afvj{4}};
%bottom edges
(-2,-16)*{\afvj{24}};
(0,-16)*{\cdots};
(2,-16)*{\afvj{24}};
(-26,-14)*{\afvj{4}};
(-24,-14)*{\cdots};
(-22,-14)*{\afvj{4}};
(-24,0)*{\afcjr{12}{8}};
(-28,0)*{\afcjr{12}{8}};
(-34,-10)*{\afvj{12}};
(-32,-6)*{\cdots};
(-30,-10)*{\afvj{12}};
(-30,-26)*{\afvj{4}};
(-28,-26)*{\cdots};
(-26,-26)*{\afvj{4}};
}\quad,
\]
where the boxes represent any atomic flow not containing axioms nor cuts and the labels indicate the polarity of all the edges in the respective boxes. We call an atomic flow \emph{$\pmi$-prenormalised under $\pi$} if it is $\ppl$-prenormalised under the dual of $\pi$ and \emph{prenormalised} if it is both $\ppl$-prenormalised and $\pmi$-prenormalised under any polarity assignment. The definitions extend to derivations in the obvious way.
\end{defi}

\begin{pro}
If $\Phi$ is prenormalised and contains no isolated subflows then $\Phi$ is streamlined.
\end{pro}

\begin{lem}\label{LemPreNor}
Given a derivation $\Phi$ from $\alpha$ to $\beta$, there exist a $\ppl$-prenormalised derivation $\Phi^+$ and a $\pmi$-prenormalised derivation $\Phi^-$ from $\alpha$ to $\beta$ such that $|\Phi^+|,|\Phi^-|\in O(|\Phi|)$.
\end{lem}
\begin{proof}
We prove the case for $\ppl$-prenormalised, $\pmi$-prenormalised trivially follows.

The atomic flow of any derivation is of the form
\[
\atomicflow{
(-14,7)*{\afvj{6}};
(-12,7)*{\cdots};
(-10,7)*{\afvj{6}};
%
(-14,-7)*{\afvj{6}};
(-12,-7)*{\cdots};
(-10,-7)*{\afvj{6}};
%
(-6,5)*{\afvj{2}};
(0,8)*{\afaid{}{}{}{}{}{}};
(-4,6)*{\cdots};
(4,6)*{\cdots};
(0,10)*{\afaidex{}{}{}{}{}{}{3}{1}};
(6,5)*{\afvj{2}};
%
(-6,-5)*{\afvj{2}};
(0,-8)*{\afaiu{}{}{}{}{}{}};
(-4,-6)*{\cdots};
(4,-6)*{\cdots};
(0,-10)*{\afaiuex{}{}{}{}{}{}{3}{1}};
(6,-5)*{\afvj{2}};
%
(-8,0)*{\affr{14}{8}};
(-2,2)*{A};
(8,0)*{\affr{14}{8}};
(14,2)*{B};
%
(14,7)*{\afvj{6}};
(12,7)*{\cdots};
(10,7)*{\afvj{6}};
%
(14,-7)*{\afvj{6}};
(12,-7)*{\cdots};
(10,-7)*{\afvj{6}};
}\quad,
\]
where $A$ and $B$ do not contain any interaction nor cointeraction nodes, all the edges in $A$ are negative and all the edges in $B$ are positive.

We will now show how we can build the required derivation with atomic flow
\[
\atomicflow{
%boxes
(-36,0)*{\affr{14}{8}};
(-31,2)*{B_1};
(-12,12)*{\affr{14}{8}};
(-7,14)*{B_2};
(-12,-12)*{\affr{14}{8}};
(-7,-10)*{B_3};
(5,0)*{\affr{16}{8}};
(11,2)*{A};
(25,0)*{\affr{14}{8}};
(30,2)*{B_4};
%contractions
(5,14.5)*{\afvj{5}};
(8,8)*{\afacdex{}{}{}{}{}{}{3}{2}};
(10,6)*{\cdots};
(9,16.5)*{\afvj{1}};
(11,14)*{\afvj{5}};
(12,12)*{\afacdex{}{}{}{}{}{}{3}{2}};
(12,6)*{\afvj{4}};
%weakenings
(-42,8)*{\afawd{}{}{}{}};
(-40,6)*{\cdots};
(-38,8)*{\afawd{}{}{}{}};
%
(-18,-4)*{\afawd{}{}{}{}};
(-16,-6)*{\cdots};
(-14,-4)*{\afawd{}{}{}{}};
%
(-10,20)*{\afawd{}{}{}{}};
(-8,18)*{\cdots};
(-6,20)*{\afawd{}{}{}{}};
%
(31,8)*{\afawd{}{}{}{}};
(29,6)*{\cdots};
(27,8)*{\afawd{}{}{}{}};
%axioms
(17,16)*{\afaidnw{}{}};
(17,18)*{\afaidex{}{}{}{}{}{}{3}{1}};
(23,10)*{\afvj{12}};
(21,8)*{\cdots};
(19,10)*{\afvj{12}};
%
(-12,25)*{\afaidnw{}{}};
(-18,22.5)*{\afvj{13}};
(-16,22)*{\cdots};
(-14,20.5)*{\afvj{9}};
(-12,29)*{\afaidex{}{}{}{}{}{}{3}{1}};
%cocontractions
(-30,12)*{\afacuex{}{}{}{}{}{}{2}{1}};
%(-32,6)*{\cdots};
(-26,12)*{\afacuex{}{}{}{}{}{}{2}{1}};
%top edges
(-30,23)*{\afvj{14}};
(-28,21)*{\cdots};
(-26,23)*{\afvj{14}};
%
(-2,16.5)*{\afvj{25}};
(0,16.5)*{\cdots};
(2,16.5)*{\afvj{25}};
%
(-14,0)*{\afcjl{16}{16}};
(-18,0)*{\afcjl{16}{16}};
%
(-34,6)*{\afvj{4}};
(-32,6)*{\cdots};
(-30,6)*{\afvj{4}};
%
(-2.5,21)*{\afcjl{15}{8}};
(1.5,21)*{\afcjl{15}{8}};
%% INVERSE
%cocontractions
(5,-14.5)*{\afvj{5}};
(8,-8)*{\afacuex{}{}{}{}{}{}{3}{2}};
(10,-6)*{\cdots};
(9,-16.5)*{\afvj{1}};
(11,-14)*{\afvj{5}};
(12,-12)*{\afacuex{}{}{}{}{}{}{3}{2}};
(12,-6)*{\afvj{4}};
%coweakenings
(-42,-8)*{\afawu{}{}{}{}};
(-40,-6)*{\cdots};
(-38,-8)*{\afawu{}{}{}{}};
%
(-18,4)*{\afawu{}{}{}{}};
(-16,6)*{\cdots};
(-14,4)*{\afawu{}{}{}{}};
%
(-10,-20)*{\afawu{}{}{}{}};
(-8,-18)*{\cdots};
(-6,-20)*{\afawu{}{}{}{}};
%
(31,-8)*{\afawu{}{}{}{}};
(29,-6)*{\cdots};
(27,-8)*{\afawu{}{}{}{}};
%cuts
(17,-18)*{\afaiunw{}{}};
(17,-18)*{\afaiuex{}{}{}{}{}{}{3}{1}};
(23,-10)*{\afvj{12}};
(21,-8)*{\cdots};
(19,-10)*{\afvj{12}};
%
(-12,-27)*{\afaiunw{}{}};
(-18,-22.5)*{\afvj{13}};
(-16,-22)*{\cdots};
(-14,-20.5)*{\afvj{9}};
(-12,-29)*{\afaiuex{}{}{}{}{}{}{3}{1}};
%contractions
(-30,-12)*{\afacdex{}{}{}{}{}{}{2}{1}};
%(-32,6)*{\cdots};
(-26,-12)*{\afacdex{}{}{}{}{}{}{2}{1}};
%bottom edges
(-30,-23)*{\afvj{14}};
(-28,-21)*{\cdots};
(-26,-23)*{\afvj{14}};
%
(-2,-16.5)*{\afvj{25}};
(0,-16.5)*{\cdots};
(2,-16.5)*{\afvj{25}};
%
(-14,0)*{\afcjr{16}{16}};
(-18,0)*{\afcjr{16}{16}};
%
(-34,-6)*{\afvj{4}};
(-32,-6)*{\cdots};
(-30,-6)*{\afvj{4}};
%
(-2.5,-21)*{\afcjr{15}{8}};
(1.5,-21)*{\afcjr{15}{8}};
}\quad,
\]
where $B_1,B_2,B_3,B_4$ are all isomorphic to $B$. It is straightforward to observe that this atomic flow is $\ppl$-prenormalised.

We build $\Phi^+$ by applying substitutions to $\Phi$. Let $a$ be an atom occurence which maps to an edge in $B$. We substitute $a$ with the formula $\vls([a_1.a_2].[a_3.a_4])$, where $a=a_1=a_2=a_3=a_4$ and the subscripts denote which of the $B_1,B_2,B_3,B_4$ the atom maps to. Rule instances $\vlinf{\aid}{}{\vls[\bar{a}.a]}{\ttt}$ and $\vlinf{\aiu}{}{\fff}{\vls(\bar{a}.a)}$ are substituted with derivations
\[
\vlderivation
{
\vlin{\awd\times2}{}{\vls[\bar{a}.([a_1.a_2].[a_3.a_4])]}
 {
 \vlin{\acd}{}{\vls[\bar{a}.(a_2.a_4)]}
  {
  \vlin{\swi\times2}{}{\vls[\bar{a}.\bar{a}.(a_2.a_4)]}
   {
   \vlin{\aid\times2}{}{\vls([\bar{a}.a_2].[\bar{a}.a_4])}
    {
    \vlhy{\ttt}
    }
   }
  }
 }
}\qquad
\vlderivation
{
\vlin{\aiu\times2}{}{\fff}
 {
 \vlin{\swi\times2}{}{\vls[(\bar{a}.a_3).(\bar{a}.a_4)]}
  {
  \vlin{\acu}{}{\vls(\bar{a}.\bar{a}.[a_3.a_4])}
   {
   \vlin{\awu\times2}{}{\vls(\bar{a}.[a_3.a_4])}
    {
    \vlhy{\vls(\bar{a}.[a_1.a_2].[a_3.a_4])}
    }
   }
  }
 }
}\quad,
\]
respectively. Rule instances $\acd,\acu,\awd,\awu$ which apply to $a$ are substituted with their generic counterparts applied to $\vls([a_1.a_2].[a_3.a_4])$. Finally any occurance of $\vls([a_1.a_2].[a_3.a_4])$ in the premiss or conclusion are substituted with the derivations
\[
\vlderivation
{
 \vlin{\awd\times2}{}{\vls([a_1.a_2].[a_3.a_4])}
 {
  \vlin{\acu}{}{\vls(a_1.a_3)}
  {
   \vlhy{a}
  }
 }
}\qquad
\vlderivation
{
 \vlin{\acd}{}{a}
 {
  \vlin{\awu\times2}{}{\vls[a_1.a_2]}
  {
   \vlhy{\vls([a_1.a_2].[a_3.a_4])}
  }
 }
}\quad,
\]
respectively. It is now straightforward to verify that the derivation so obtained has the aforementioned atomic flow and the result follows.
\end{proof}

\begin{lem}
If the $\pmi$-prenormalisd derivation $\Psi$ from $\alpha$ to $\beta$ is obtained from $\Phi$ as described in Lemma~\ref{LemPreNor} and $\Phi$ is $\ppl$-prenormalised and contains no positive isolated subflows then $\Psi$ is prenormalised and contains no positive isolated subflows.
\end{lem}

\begin{defi}\label{DefRedIS}
We define the reduction $\rightarrow_{is}$ (where $is$ stands for \emph{isolated subflow}) as follows, for all atomic flows $A$ and $B$, where $B$ is connected and flows $\tilde{A},\hat{A}$ are both isomorphic to $A$.
\[
\atomicflow{
(-14,7)*{\afvj{6}};
(-12,7)*{\cdots};
(-10,7)*{\afvj{6}};
%
(-14,-7)*{\afvj{6}};
(-12,-7)*{\cdots};
(-10,-7)*{\afvj{6}};
%
(-6,5)*{\afvj{2}};
(0,8)*{\afaid{}{}{}{}{}{}};
(-4,6)*{\cdots};
(4,6)*{\cdots};
(0,10)*{\afaidex{}{}{}{}{}{}{3}{1}};
(6,5)*{\afvj{2}};
%
(-6,-5)*{\afvj{2}};
(0,-8)*{\afaiu{}{}{}{}{}{}};
(-4,-6)*{\cdots};
(4,-6)*{\cdots};
(0,-10)*{\afaiuex{}{}{}{}{}{}{3}{1}};
(6,-5)*{\afvj{2}};
%
(-8,0)*{\affr{14}{8}};
(-2,2)*{A};
(4,0)*{\affr{6}{8}};
(6,2)*{B};
}\quad\rightarrow_{is}\quad
\atomicflow{
(-14,16)*{\afvj{24}};
(-12,16)*{\cdots};
(-10,16)*{\afvj{24}};
%
(-14,-6)*{\afvj{4}};
(-12,-6)*{\cdots};
(-10,-6)*{\afvj{4}};
%
(-4,8)*{\afacu{}{}{}{}{}{}};
(-4,5)*{\cdots};
%
(-2,-8)*{\afawu{}{}{}{}};
(-4,-6)*{\cdots};
(-6,-8)*{\afawu{}{}{}{}};
%
(-8,0)*{\affr{14}{8}};
(-2,2)*{\hat{A}};
%
(-2,-12)*{\afacdex{}{}{}{}{}{}{4}{1}};
(-4,-15)*{\cdots};
(-6,-12)*{\afacdex{}{}{}{}{}{}{4}{1}};
%-------------
(-2,32)*{\afacuex{}{}{}{}{}{}{4}{1}};
(-4,35 )*{\cdots};
(-6,32)*{\afacuex{}{}{}{}{}{}{4}{1}};
%
(2,26)*{\afvj{4}};
(4,27)*{\cdots};
(6,26)*{\afvj{4}};
%
(2,4)*{\afvj{24}};
(4,4)*{\cdots};
(6,4)*{\afvj{24}};
%
(-4,11.5)*{\afacdnw{}{}{}{}};
(-4,15)*{\cdots};
%
(-6,28)*{\afawd{}{}{}{}};
(-4,26)*{\cdots};
(-2,28)*{\afawd{}{}{}{}};
%
(0,20)*{\affr{14}{8}};
(6,22)*{\tilde{A}};
}\quad.
\]
\end{defi}

\begin{thm}
Reduction $\rightarrow_{is}$ is sound.
\end{thm}
\begin{proof}
Let $\Phi$ be a derivation with flow $C$, such that $C\rightarrow_{si} D$. We show that there exists a derivation $\Psi$ with flow $D$ and with the same premiss and conclusion as $\Phi$. In the following we refer to the figure in Definition~\ref{DefRedIS}. We assume that $\Phi$ has premiss $\xi$ and conclusion $\zeta$. Now we will conduct experiments with respect to $B$. Since $B$ is connected we know that it has two polarity assignments $\pi_+$ and $\pi_-$, where each polarity assignment assigns the given polarity to all the edges in $B$. Now let $\Phi_+^\top$ be the $\top$-experiment under $\pi_+$ and let $\Phi_-^\bot$ be the $\bot$-experiment under $\pi_-$ both with respect to $B$. Then we have:
\[
\vlder{\Phi_+^\top}{}{\vls[\zeta.{\bar a}.\cdots.{\bar a}]}{\xi}
\quad,\quad
\vlder{\Phi_-^\bot}{}{\zeta}{\vls({\bar a}.\cdots.{\bar a}.\xi)}
\]
We can now connect the two experiments to get the desired derivation:
\[
\vlderivation{
\vlin{\cod}{}{\zeta}{
\vlde{\vls[\zeta.\Phi_-^\bot]}{}{\vls[\zeta.\zeta]}{
\vlin{\acu^\star}{}{\vls[\zeta.({\bar a}.\cdots.{\bar a}.\xi)]}{
\vlin{\swi}{}{\vls[\zeta.({\bar a}.\xi)]}{
\vlin{\acd^\star}{}{\vls([\zeta.{\bar a}].\xi)}{
\vlde{\vls(\Phi_+^\top.\xi)}{}{\vls([\zeta.{\bar a}.\cdots.{\bar a}].\xi)}{
\vlin{\cou}{}{\vls(\xi.\xi)}{
\vlhy{\xi}}}}}}}}
}
\]
\end{proof}

\begin{lem}\label{LemExOneISF}
If $\Phi$ from $\alpha$ to $\beta$ is $\ppl$-prenormalised with at least one isolated subflow then there exist $\Phi'$
\[
\Phi' =
\vlderivation
{
 \vlde{}{\{\aiu\}}{\beta}
 {
  \vlde{\Psi}{}{\beta'}
  {
   \vlde{}{\{\aid\}}{\alpha'}
   {
    \vlhy{\alpha}
   }
  }
 }
}\quad,
\]
with the same atomic flow as $\Phi$ such that $\Psi$ is $\ppl$-prenormalised and has exactly one isolated subflow.
\end{lem}
\begin{proof}
Any $\aid$ (resp. $\aiu$) can be permuted above (resp. below) any other rule at the cost of $\swi$ and $=$ rules. So the unwanted $\aid$ and $\aiu$ rules can be permuted out of the way leaving $\Psi$ in the middle without changing the atomic flow.
\end{proof}

\begin{lem}\label{LemRemoveISF}
If
\[
\Phi'=\vlderivation
{
 \vlde{}{\{\aiu\}}{\beta}
 {
  \vlde{\Psi}{}{\beta'}
  {
   \vlde{}{\{\aid\}}{\alpha'}
   {
    \vlhy{\alpha}
   }
  }
 }
}
\]
is as in Lemma~\ref{LemExOneISF}, it contains $n$ isolated subflows and $\Psi\rightarrow_{is}\Psi'$ then
\[
\vlderivation
{
 \vlde{}{\{\aiu\}}{\beta}
 {
  \vlde{\Psi'}{}{\beta'}
  {
   \vlde{}{\{\aid\}}{\alpha'}
   {
    \vlhy{\alpha}
   }
  }
 }
}
\]
is $\ppl$-prenormalised and contains $n-1$ isolated subflows.
\end{lem}

\begin{lem}
If $\Phi$ from $\alpha$ to $\beta$ is $\ppl$-prenormalised then there exists $\Psi$ from $\alpha$ to $\beta$ with no isolated subflows.
\end{lem}
\begin{proof}
Corollary of Lemmata~\ref{LemExOneISF} and \ref{LemRemoveISF}.
\end{proof}

\newcommand{\Mik}{\mathsf{Mik}}
\begin{defi}
For every $\SKS$ derivation $\Phi_0$, algorithm $\Mik$ performs the following steps
\begin{itemize}
  \item $\Phi_0$ is turned into $\Phi_1$ which is $\ppl$-prenormalised;
  \item all the isolated subflows are removed from $\Phi_1$ to create $\Phi_2$;
  \item $\Phi_2$ is turned into $\Phi_3$ which is prenormalised;
  \item all the isolated subflows are removed from $\Phi_3$ to create the output of the algorithm, $\Phi_4$.
\end{itemize}

\end{defi}


\iflmcs\else\let\oldurl\url\renewcommand{\url}[1]{\hfill\break\oldurl{#1}}\fi

\bibliographystyle{alpha}
\bibliography{di-biblio}

\end{document}