\documentclass[a4paper]{amsart}

\newif\iflmcs\lmcsfalse % <--------------- TOGGLE THIS FOR FINAL VERSION OF LMCS
                        %                  Trash .aux file after toggling
\usepackage{stmaryrd}
\usepackage{graphicx}
\usepackage[lutzsyntax]{virginialake}\vlsmallbrackets\aftrianglefalse
\iflmcs\def\url #1#2{\relax}\else\usepackage{hyperref}\fi

%--------- Theorem etc
\newtheorem{thm}{Theorem}[section]
\newtheorem{cor}[thm]{Corollary}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{pro}[thm]{Proposition}

\theoremstyle{remark}
\newtheorem{rem}[thm]{Remark}

\theoremstyle{definition}
\newtheorem{defi}[thm]{Definition}
%---------

%-------------------------------------------------------- REMOVE WHEN PAPER DONE
\newcommand{\Ale}[1]{{\color{NavyBlue}\noindent {\bf A:} #1}}
\newcommand{\Tom}[1]{{\color{PineGreen}\noindent {\bf T:} #1}}
\newcount\todocount\todocount=0
\newcommand{\TODO}[1]{\global\advance\todocount by1%
            {\color{Red}\noindent{\bf\the\todocount\ TODO:} #1}}\vlupdate{\TODO}
%\renewcommand{\Ale}[1]{\relax}  % Comment/uncomment these three lines
%\renewcommand{\Tom}[1]{\relax}  % in order to display/hide inline comments
%\renewcommand{\TODO}[1]{\relax} %
%-------------------------------------------------------- REMOVE WHEN PAPER DONE

\begin{document}

\title[Normalisation Control in Deep Inference   via Atomic Flows II]
      {Normalisation Control in Deep Inference\\ via Atomic Flows II}

\author{Alessio Guglielmi}
\address{University of Bath, Bath BA2 7AY, UK}

\author{Tom Gundersen}
\iflmcs\address{University of Bath, Bath BA2 7AY, UK}\fi

\thanks{This work was in part funded by an Overseas Research Scholarship and a Research Studentship, both from the University of Bath, and by the British Council Alliance Programme.}

\keywords{Normalisation, deep inference, cut elimination, atomic flows}

\subjclass{F.4.1 Mathematical Logic---Proof theory}

\begin{abstract}
\end{abstract}

\maketitle

%===============================================================================
\section{Introduction}
\newcommand{\ot}{\mathbin\shortleftarrow}
\newcommand{\fff}{\mathsf f}
\newcommand{\ttt}{\mathsf t}
\newcommand{\ai}{\mathsf{ai}}
\newcommand{\aw}{\mathsf{aw}}
\newcommand{\ac}{\mathsf{ac}}
\newcommand{\aid}{{\ai{\downarrow}}}
\newcommand{\awd}{{\aw{\downarrow}}}
\newcommand{\acd}{{\ac{\downarrow}}}
\newcommand{\aiu}{{\ai{\uparrow}}}
\newcommand{\awu}{{\aw{\uparrow}}}
\newcommand{\acu}{{\ac{\uparrow}}}
\newcommand{\swi}{\mathsf{s}}
\newcommand{\med}{\mathsf{m}}
\newcommand{\sus}{\mathsf{ss}}
\newcommand{\said}{\mathsf{s}\aid}
\newcommand{\contr}{\mathsf{c}}
\newcommand{\cod}{{\contr{\downarrow}}}
\newcommand{\cou}{{\contr{\uparrow}}}
\newcommand{\SKS}{\mathsf{SKS}}
\newcommand{\ppl  }{{\mathchoice{\scriptstyle+}
                                {\scriptstyle+}
                                {\scriptstyle+}
                                {\scriptscriptstyle+}}}
\newcommand{\pmi  }{{\mathchoice{\scriptstyle-}
                                {\scriptstyle-}
                                {\scriptstyle-}
                                {\scriptscriptstyle-}}}
Here we need to define all the things we use later on\dots
%===============================================================================
\section{Cut Elimination For Proofs}

The important notion in this paper is the notion of \emph{experiments}. An experiment is basically a truth value assignment to an atom in a derivation. We will have the need for partial assignment, meaning that we assign a value to an atom $a$, but not to its dual $\bar a$. We call this partial assignment a \emph{$\bot$-experiment} if we assign $\fff$ and a \emph{$\top$-experiment} if we assign $\ttt$.

\begin{defi}\label{DefExperiment}
Let $\vlder{\Psi}{}{\beta}{\alpha}$ be a derivation and $A$ a subflow of its atomic flow, containing $k$ instances of $\aid$ and $n$ connected components, then we call $\vlder{\Psi^\bot_p}{}{\vls(\beta^\bot_p.\gamma^0_p)}{\vls(\alpha^\bot_p.\gamma^k_p)}$ a \emph{$\bot$-experiment on $\Psi$ under polarity assignment $\pi_p$ with respect to $A$} if $\Psi_p$ is obtained from $\Psi$ by
\begin{itemize}
\item replacing each $\vlinf{\aid}{}{\xi\{\vls[a_i^\ppl.{\bar a_i^\pmi}]\}}{\xi\{\ttt\}}$ mapping to a node in $A$ by $\vlinf{\sus}{}{\vls(\xi^\bot_p\vlsbr[a_i^\ppl.\fff].\gamma^j_p)}{\vls(\xi^\bot_p\{\ttt\}.\gamma^{j+1}_p)}$ where $\gamma^{j+1}_p=\vls(a_i^\ppl.\gamma^j_p)$ for some $0\leq j \leq k$, $0 \leq i \leq n$;
\item replacing each $\vlinf{\aiu}{}{\xi\{\fff\}}{\xi\vlsbr(a_i^\ppl.{\bar a_i^\pmi})}$ mapping to a node in $A$ by $\vlinf{\awu}{}{\vls(\xi_p\{\fff\}.\gamma^j_p)}{\vls(\xi_p\vlsbr(a_i^\ppl.\fff).\gamma^j_p)}$ for some $0\leq j \leq k$, $0 \leq i \leq n$; and
\item replacing each other inference rule $\vlinf{\rho}{}{\xi}{\zeta}$ by $\vlinf{\rho}{}{\vls(\xi^\bot_p.\gamma^j_p)}{\vls(\zeta^\bot_p.\gamma^j_p)}$ for some $0\leq j \leq k$ ,
\end{itemize}
where $\alpha^\bot_p,\beta^\bot_p,\xi^\bot_p,\zeta^\bot_p$ denote formulae obtained from $\alpha,\beta,\xi,\zeta$, respectively, by replacing atom occurrences mapping to edges in $A$ with a negative polarity assignment under $\pi_p$, with $\fff$; and where $\gamma^0_p=\ttt$. We sometimes refer to $\gamma^k_p$ as $\gamma_p$.
\end{defi}

\begin{pro}
If $\Psi^\bot_p$ is a $\bot$-experiment on $\Psi$ with respect to some atomic flow $A$ then $\Psi^\bot_p$ is a valid derivation.
\end{pro}

\begin{pro}\label{PropExperimentShapeBot}
A $\bot$-experiment under polarity assignment $\pi_p$ on a proof\/ $\vlproof{\Pi}{\SKS}{\beta}$ with respect to an atomic flow containing all the (co)interaction nodes of $\Pi$ is of the form $\vlder{}{\SKS\setminus\{\aid,\aiu\}}{\beta_p}{\gamma_p}$. Where $\beta_p$ and $\gamma_p$ are given by Definition~\ref{DefExperiment}.
\end{pro}

\begin{lem}\label{LemGlueTop}
The disjunction of the premises of all the $\bot$-experiments on a given proof is a tautology with a proof of the form $\vlproof{}{\{\aid,\acu,\swi\}}{\bigvee_{p=1}^{2^n}\gamma_p}$
\end{lem}

\begin{lem}\label{LemGlueBottom}
Given all the $\bot$-experiments on a derivation $\vlder{}{}{\beta}{\alpha}\ $ with respect to any atomic flow, there exists a derivation $\vlder{}{\{\acd,\med\}}{\beta}{\bigvee_{p=1}^{2^n}\beta^\bot_p}$.
\end{lem}

\begin{thm}
Given a proof $\vlproof{\Pi}{\SKS}{\beta}$ there exists a cut-free proof $\vlproof{}{\SKS\setminus\{\aiu\}}{\beta}$.
\end{thm}
\begin{proof}
Consider all the possible experiments on $\Pi$; $\Pi_1,\dots,\Pi_{2^n}$. By Lemma~\ref{LemGlueTop} and Lemma~\ref{LemGlueBottom} we can build the following proof:
\[
\vlderivation{
\vlde{}{\{\acd,\med\}}{\beta                                  } {
\vlde{\bigvee_{p=1}^{2^n}\Pi_p}
       {\SKS\setminus\{\aid,\aiu\}}{\bigvee_{p=1}^{2^n}\beta^p}{
\vlpr{}{\{\aid,\acu,\swi\}}{\bigvee_{p=1}^{2^n}\gamma_p       }}}
}
\]
\end{proof}

%===============================================================================
\section{Interpolation}

\begin{defi}\label{DefExperiment2}
Let $\vlder{\Psi}{\{\aid,\aiu,\swi,\med\}}{\beta}{\alpha}$ be a streamlined derivation, then we call $\vlder{\Psi_p}{\{\aid,\aiu,\swi,\med\}}{\beta_p}{\alpha_p}$ an \emph{experiment on $\Psi$ under polarity assignment $\pi_p$ with respect to atomic flow $A$} if $\Psi_p$ is obtained from $\Psi$ by
\begin{itemize}
\item replacing each $\vlinf{\aid}{}{\xi\{\vls[a_i^\ppl.{\bar a_i^\pmi}]\}}{\xi\{\ttt\}}$ mapping to a node in $A$ by $\vlinf{=}{}{\xi_p\vlsbr[\ttt.\fff]}{\xi_p\{\ttt\}}$, for some $0 \leq i \leq n$;
\item replacing each $\vlinf{\aiu}{}{\xi\{\fff\}}{\xi\{\vls(a_i^\ppl.{\bar a_i^\pmi})\}}$ mapping to a node in $A$ by $\vlinf{=}{}{\xi_p\{\fff\}}{\xi_p\vlsbr(\ttt.\fff)}$, for some $0 \leq i \leq n$; and
\item replacing each other rule instance $\vlinf{\rho}{}{\xi}{\zeta}$ by $\vlinf{\rho}{}{\xi_p}{\zeta_p}$,
\end{itemize}
where $\rho\in\{\swi,\med\}$ and $\alpha_p,\beta_p,\xi_p,\zeta_p$ denote the formulae obtained from $\alpha,\beta,\xi,\zeta$, respectively, by replacing atom occurrences mapped to edges of $A$. Atoms mapping to positive (resp. negative) edges under $\pi_p$ are replaced with $\ttt$ (resp. $\fff$).
\end{defi}

\begin{rem}
If we define a $\top$-experiment to be the dual of a $\bot$-experiment in the usual way, then an \emph{experiment} on $\Psi$ is exactly a $\top$-experiment on a $\bot$-experiment on $\Psi$ (or the other way around) (under the same polarity assignment, with respect to the same atomic flow).
\end{rem}

\begin{pro}
If $\Psi_p$ is an experiment on $\Psi$ with respect to the atomic flow containing all the $\aid$ nodes of $\Psi$, then $\Psi_p$ is a valid derivation.
\end{pro}

\begin{pro}\label{PropExperimentShape}
An experiment under polarity assignment $\pi_p$ on a streamlined derivation\/ $\vlder{\Psi}{\{\aid,\aiu,\swi,\med\}}{\beta}{\alpha}$ with respect to an atomic flow containing all the $\aid$ nodes of $\Psi$ is of the form $\vlder{}{\{\aiu,\swi,\med\}}{\beta_p}{\alpha}$. Where $\beta_p$ is given by Definition~\ref{DefExperiment2}.
\end{pro}

\begin{lem}\label{LemGlue}
Given a derivation $\vlder{\Psi}{}{\beta}{\alpha}\ $, and all the experiments on $\Pi$ with respect to a given atomic flow there exists a derivation $\vlder{}{\{\aid,\swi\}}{\bigvee_{p=1}^{2^n}\beta_p^\bot}{\bigwedge_{p=1}^{2^n}\beta_p}$, where $\beta^\bot_p$ is given by Definition~\ref{DefExperiment}.
\end{lem}

\begin{lem}\label{LemInterpolant}
Given a streamlined derivation of the form
\[
\vlder{\Psi}{\{\aid,\aiu,\swi,\med\}}{\beta}{\alpha}
\]
there is a derivation, $\Psi'$, of the form
\[
\vlderivation{
\vlde{}{\{\aid,\acd,\swi,\med\}}{\beta} {
\vlde{}{\{\aiu,\acu,\swi,\med\}}{\gamma}{
\vlhy{\alpha}}}
}
\]
\end{lem}

\begin{proof}
Consider all the experiments on $\Psi$; $\Psi_1,\dots,\Psi_{2^n}$. Using these derivations and Lemma~\ref{LemGlueBottom} and Lemma~\ref{LemGlue} we can build:
\[
\vlderivation{
\vlde{}{\{\acd,\med\}}     {\beta                          }   {
\vlde{}{\{\aid,\swi\}}     {\bigvee_{p=1}^{2^n}\beta^\bot_p}  {
\vlde{\bigwedge_{p=1}^{2^n}\Psi_p}{\{\aiu,\swi,\med\}}
                           {\bigwedge_{p=1}^{2^n}\beta_p   } {
\vlde{}{\{\acu,\med\}}     {\bigwedge_{p=1}^{2^n}\alpha    }{
\vlhy                      {\alpha                         }}}}}
}\quad, 
\]
Where $\gamma=\bigwedge_{p=1}^{2^n}\beta_p$.
\end{proof}

\begin{pro}
If there exists a derivation like $\Psi'$ in Lemma~\ref{LemInterpolant}, then $\gamma$ is an interpolant of $\alpha$ and $\beta$.
\end{pro}

%===============================================================================
\section{Streamlining}

We want to show two things in this section. Firstly that any subflow with no path to either $\top$ nor $\bot$ can be eliminated (at the expense of copying the rest of the flow). Secondly that we can transform an atomic flow in such a way that every path from an interaction to a cointeraction node is in a subflow which is not connected to $\top$ nor $\bot$. We do the latter first.

\begin{defi}
We call an atomic flow \emph{ambiguous} for polarity assignment $\pi_p$ if there exist an interaction (resp. cointeraction) node with a positive path from the interaction (resp. cointeraction) to $\bot$ (resp. $\top$) and a positive path from the interaction (resp. cointeraction) node to a cointeraction (resp. interaction node). If an atomic flow is not ambiguous for plority assignment $\pi_p$ we say that it is \emph{unambiguous}.
\end{defi}

\begin{lem}
Given a derivation $\Delta$ from $\alpha$ to $\beta$ with atomic flow $A$ there exists a derivation $\Delta'$ from $\alpha$ to $\beta$ with unambiguous atomic flow $A'$ for some polarity assignment $\pi_p$ such that $|A'|/|A|\in O(1)$.
\end{lem}

\begin{proof}[Proof (Sketch)]
{\footnotesize\begin{verbatim}
Here is the picture. In constructions 1-3, a,b,c,d (which are just labels, and
not atom names) are supposed to represent groups of wires (but I have drawn only
one for simplicity).

1) The construction Alessio found when there is one group of top wires, and two
groups of bottom wires. In the derivation this is obtained by substituting "a
\leftarrow a \land a".

2) The dual of 1.

3) Consider group a and b as one group and apply (1). Now consider c and d as
one group and apply (2). Finally apply some weakening reductions. The result is
four boxes, one with paths from a to c, one with path from a to d, one with
paths from b to c and one with paths from a to d.

4) (3) applied to the case we are interested in, where a go to interactions and
c to cuts. I labelled the four boxes, to show that I shuffled them around a bit
for readability. Box 1 is eliminated and 2-4 kept.
\end{verbatim}}

\[
\atomicflow{
(-2,8)*{\afvj4};
(0,8)*{\cdots};
(2,8)*{\afvj4};
(0,0)*{\affr{12}{12}};
(-5,-8)*{\afvj4};
(-3,-8)*{\cdots};
(-1,-8)*{\afvj4};
(5,-8)*{\afvj4};
(3,-8)*{\cdots};
(1,-8)*{\afvj4};
}\quad\rightarrow\quad
\atomicflow{
(-2,12)*{\afacuexsq{}{}{}{}{}{}{4}{1}};
(0,16)*{\cdots};
(2,12)*{\afacuexsq{}{}{}{}{}{}{4}{1}};
(-8,0)*{\affr{12}{12}};
(8,0)*{\affr{12}{12}};
(-13,-8)*{\afvj4};
(-11,-8)*{\cdots};
(-9,-8)*{\afvj4};
(-3,-10)*{\afawu{}{}{}{}};
(-5,-8)*{\cdots};
(-7,-10)*{\afawu{}{}{}{}};
(13,-8)*{\afvj4};
(11,-8)*{\cdots};
(9,-8)*{\afvj4};
(3,-10)*{\afawu{}{}{}{}};
(5,-8)*{\cdots};
(7,-10)*{\afawu{}{}{}{}};
}
\]

\[
\atomicflowinv{
(-2,8)*{\afvj4};
(0,8)*{\cdots};
(2,8)*{\afvj4};
(0,0)*{\affr{12}{12}};
(-5,-8)*{\afvj4};
(-3,-8)*{\cdots};
(-1,-8)*{\afvj4};
(5,-8)*{\afvj4};
(3,-8)*{\cdots};
(1,-8)*{\afvj4};
}\quad\rightarrow\quad
\atomicflow{
(-2,-12)*{\afacdexsq{}{}{}{}{}{}{4}{1}};
(0,-16)*{\cdots};
(2,-12)*{\afacdexsq{}{}{}{}{}{}{4}{1}};
(-8,0)*{\affr{12}{12}};
(8,0)*{\affr{12}{12}};
(-13,8)*{\afvj4};
(-11,8)*{\cdots};
(-9,8)*{\afvj4};
(-3,10)*{\afawd{}{}{}{}};
(-5,8)*{\cdots};
(-7,10)*{\afawd{}{}{}{}};
(13,8)*{\afvj4};
(11,8)*{\cdots};
(9,8)*{\afvj4};
(3,10)*{\afawd{}{}{}{}};
(5,8)*{\cdots};
(7,10)*{\afawd{}{}{}{}};
}
\]

\[
\atomicflowinv{
(-5,8)*{\afvj4};
(-3,8)*{\cdots};
(-1,8)*{\afvj4};
(5,8)*{\afvj4};
(3,8)*{\cdots};
(1,8)*{\afvj4};
(0,0)*{\affr{12}{12}};
(-5,-8)*{\afvj4};
(-3,-8)*{\cdots};
(-1,-8)*{\afvj4};
(5,-8)*{\afvj4};
(3,-8)*{\cdots};
(1,-8)*{\afvj4};
}\quad\rightarrow\quad
\atomicflow{
(-21,16)*{\afacuexsq{}{}{}{}{}{}{4}{1}};
(-19,20)*{\cdots};
(-17,16)*{\afacuexsq{}{}{}{}{}{}{4}{1}};
%---
(21,16)*{\afacuexsq{}{}{}{}{}{}{4}{1}};
(19,20)*{\cdots};
(17,16)*{\afacuexsq{}{}{}{}{}{}{4}{1}};
%---
(-25,8)*{\afvj4};
(-29,8)*{\afvj4};
%---
(-19,10)*{\afawd{}{}{}{}};
(-21,8)*{\cdots};
(-23,10)*{\afawd{}{}{}{}};
%---
(-9,8)*{\afvj4};
(-13,8)*{\afvj4};
%---
(-3,10)*{\afawd{}{}{}{}};
(-5,8)*{\cdots};
(-7,10)*{\afawd{}{}{}{}};
%---
(3,10)*{\afawd{}{}{}{}};
(5,8)*{\cdots};
(7,10)*{\afawd{}{}{}{}};
%---
(9,8)*{\afvj4};
(13,8)*{\afvj4};
%---
(19,10)*{\afawd{}{}{}{}};
(21,8)*{\cdots};
(23,10)*{\afawd{}{}{}{}};
%---
(25,8)*{\afvj4};
(29,8)*{\afvj4};
%---
(-24,0)*{\affr{12}{12}};
(-8,0)*{\affr{12}{12}};
(8,0)*{\affr{12}{12}};
(24,0)*{\affr{12}{12}};
%---
(-25,-8)*{\afvj4};
(-29,-8)*{\afvj4};
%---
(-19,-10)*{\afawu{}{}{}{}};
(-21,-8)*{\cdots};
(-23,-10)*{\afawu{}{}{}{}};
%---
(-9,-10)*{\afawu{}{}{}{}};
(-11,-8)*{\cdots};
(-13,-10)*{\afawu{}{}{}{}};
%---
(-3,-8)*{\afvj4};
(-7,-8)*{\afvj4};
%---
(3,-8)*{\afvj4};
(7,-8)*{\afvj4};
%---
(9,-10)*{\afawu{}{}{}{}};
(11,-8)*{\cdots};
(13,-10)*{\afawu{}{}{}{}};
%---
(19,-10)*{\afawu{}{}{}{}};
(21,-8)*{\cdots};
(23,-10)*{\afawu{}{}{}{}};
%---
(25,-8)*{\afvj4};
(29,-8)*{\afvj4};
%---
(-13,-16)*{\afacdexsq{}{}{}{}{}{}{8}{1}};
(-11,-20)*{\cdots};
(-9,-16)*{\afacdexsq{}{}{}{}{}{}{8}{1}};
%---
(13,-16)*{\afacdexsq{}{}{}{}{}{}{8}{1}};
(11,-20)*{\cdots};
(9,-16)*{\afacdexsq{}{}{}{}{}{}{8}{1}};
}
\]
\end{proof}

\begin{defi}\label{DefRedIS}
We define the reduction $\rightarrow_{is}$ (where $is$ stands for \emph{isolated subflow}) as follows, for all atomic flows $A$ and $B$:

where $h,k\geq0$, edges have been renamed with accents, flows $\tilde{A}$ and $\hat{A}$ are both isomorphic to $A$ and $B$ is connected.
\end{defi}

\begin{thm}
Reduction $\rightarrow_{is}$ is sound.
\end{thm}
\begin{proof}
Let $\Phi$ be a derivation with flow $C$, such that $C\rightarrow_{si} D$. We show that there exists a derivation $\Psi$ with flow $D$ and with the same premiss and conclusion as $\Phi$. In the following we refer to the figure in Definition~\ref{DefRedIS}. We assume that $\Phi$ has premiss $\xi$ and conclusion $\zeta$. Now we will conduct experiments with respect to $B$. Since $B$ is connected we know that it has two polarity assignments $\pi_+$ and $\pi_-$, where each polarity assignment assigns the given polarity to all the edges in $B$. Now let $\Phi_+^\top$ be the $\top$-experiment under $\pi_+$ and let $\Phi_-^\bot$ be the $\bot$-experiment under $\pi_-$ both with respect to $B$. Then we have:
\[
\vlder{\Phi_+^\top}{}{\vls[\zeta.{\bar a}.\cdots.{\bar a}]}{\xi}
,\quad
\vlder{\Phi_-^\bot}{}{\zeta}{\vls({\bar a}.\cdots.{\bar a}.\xi)}
\]
We can now connect the two experiments to get the desired derivation:
\[
\vlderivation{
\vlin{\cod}{}{\zeta}{
\vlde{\vls[\zeta.\Phi_+^\top]}{}{\vls[\zeta.\zeta]}{
\vlin{\acu^\star}{}{\vls[\zeta.({\bar a}.\cdots.{\bar a}.\xi)]}{
\vlin{\swi}{}{\vls[\zeta.({\bar a}.\xi)]}{
\vlin{\acd^\star}{}{\vls([\zeta.{\bar a}].\xi)}{
\vlde{\vls(\Phi_-^\bot.\xi)}{}{\vls([\zeta.{\bar a}.\cdots.{\bar a}].\xi)}{
\vlin{\cou}{}{\vls(\xi.\xi)}{
\vlhy{\xi}}}}}}}}
}
\]
\end{proof}

\iflmcs\else\let\oldurl\url\renewcommand{\url}[1]{\hfill\break\oldurl{#1}}\fi

%\bibliographystyle{alpha}
%\bibliography{biblio}

\end{document}